(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[1954],{71954:(rr,jt,v)=>{v.r(jt),v.d(jt,{BaseDataGridActionsPreprocessor:()=>Mt,ChartWidgetAdaptAxesFormattingPreprocessor:()=>Ge,ChartWidgetPreprocessor:()=>ke,ComboboxPreprocessor:()=>Z,ComponentsPreprocessorsModule:()=>vt,DISABLE_CHART_WIDGET_AXES_FORMATTING_ADAPTATION:()=>ii,DataGridActionsPreprocessor:()=>Y,DataGridActiveRowPreprocessor:()=>le,DataGridBulkActionsPreprocessor:()=>$,DataGridBulkActionsPreprocessorsModule:()=>Q,DataGridCancelItemsChangesPreprocessor:()=>ie,DataGridColumnsPreprocessor:()=>G,DataGridCreateItemPreprocessor:()=>re,DataGridDeleteItemPreprocessor:()=>ae,DataGridEditingCellViewPreprocessor:()=>X,DataGridFilterOptionsBackwardCompatibilityPreprocessor:()=>K,DataGridFilterOptionsPostprocessorsModule:()=>Pt,DataGridFilterOptionsPreprocessor:()=>ee,DataGridFilterOptionsPreprocessorsModule:()=>Rt,DataGridHeaderToolbarPreprocessor:()=>te,DataGridPagingPreprocessor:()=>oe,DataGridPlaceholderPreprocessor:()=>ce,DataGridPreprocessorsModule:()=>Ce,DataGridReloadItemsPreprocessor:()=>se,DataGridRestrictionsPreprocessor:()=>he,DataGridRowDoubleClickPreprocessor:()=>ue,DataGridRowsSelectionPreprocessor:()=>de,DataGridSaveItemsChangesPreprocessor:()=>ne,DataGridSelectionOptionsBackwardCompatibilityPreprocessor:()=>L,DataGridSelectionOptionsPostprocessorsModule:()=>Ot,DataGridSelectionOptionsPreprocessorsModule:()=>pe,DataGridStageCellViewPreprocessor:()=>ge,DataSourceUtils:()=>F,SearchFilterPreprocessor:()=>De,SearchFilterPreprocessorService:()=>k,SelectionOptionsPreprocessor:()=>me,SelectionOptionsPreprocessorService:()=>O,SelectionOptionsPreprocessorsModule:()=>fe,ShellHeaderPreprocessor:()=>Tt,WidgetDataProvidingPostprocessor:()=>Le,WidgetDataProvidingPostprocessorModule:()=>xe,WidgetDataProvidingPreprocessor:()=>je,WidgetDataProvidingPreprocessorModule:()=>w,WidgetPreprocessorsModule:()=>q,findViewModelAttributeByModelPath:()=>Dt,getDataSourceFilterAttribute:()=>Ut,getDefaultPagingConfig:()=>$t,getPaginationChange:()=>wt,getSearchFilterAttributeName:()=>Wt});var Et=v(31134),D=v(33177),y=v(41307),u=v(34038),R=v(46338),U=v(75621),m=v(49475),f=v(24709),l=v(8239),_=v(21322);function wt(T){return{request:"crt.LoadDataRequest",params:{dataSourceName:T,parameters:[]}}}function $t(){return{rowCount:30}}var h=v(75378);class F{static#e=this._recordSchemaNameColumnName="RecordSchemaName";static _getMasterRecordEntitySchemaName(e,t,i){if(!e?.startsWith("$"))return Promise.resolve(null);const r=e.substring(1),a=t.viewModelConfig.attributes?.[r];if(!a)return Promise.resolve(null);let n="";a&&(0,f.isModelAttributeConfig)(a)&&(n=a.modelConfig?.path??"");const s=n?.split("."),c=s?.shift()??"",d=s?.pop()??"";return F.getDataSchemaName({models:i,schema:t,dataSourceName:c,attributeName:d})}static _findRelatedPath(e,t){const i=e.split(".");if(i.length!==2)return;const r=i[0],a=i[1],d=t.modelConfig?.dataSources?.[r]?.config?.attributes?.[a];if(!!d?.path)return`${r}.${d.path}`}static _getRelativeAttributePath(e,t){const r=(t.viewModelConfig.attributes??{})[e]??{};if(!(0,f.isModelAttributeConfig)(r)||!r.modelConfig?.path)return;const a=r.modelConfig.path;return this._findRelatedPath(a,t)??a}static _createDependency(e,t){return[{attributePath:t,relationPath:e}]}static _getReferenceColumnName(e){return e.masterRecordColumnName??e.recordColumnName}static getDataSchemaName(e){var t=this;return(0,l.Z)(function*(){const i=yield t.getDataSchema(e.models,e.dataSourceName);return i?e.attributeName?i?.attributes.find(a=>a.name===e.attributeName)?.referenceSchemaName??i?.name:i?.name:e.schema.modelConfig?.dataSources?.[e.dataSourceName]?.config?.entitySchemaName})()}static getDataSchema(e,t){const i=e.find(r=>r.getDataSource()?.dataSourceName===t);return(0,_.firstValueFrom)(i?.getSchema()??(0,_.of)(null))}static getDataSourcePrimaryAttribute(e,t="Id"){const i=e.modelConfig?.primaryDataSourceName;if(!i)return"";const r=e.viewModelConfig?.attributes;return r&&!r[t]&&(r[t]={modelConfig:{path:`${i}.${t}`}}),t}static getDataSourceNameByAttribute(e){if(!e?.startsWith("$"))return null;const t=e.substring(1);return this.getAttributeDSName(t)}static getAttributeDSName(e){return`${e}${f.DATA_SOURCE_PREFIX}`}static createDataSourceConfig(e){return{type:"crt.EntityDataSource",scope:h.DataSourceScope.ViewElement,config:{entitySchemaName:e}}}static getRecordEntitySchemaName(e,t,i,r){var a=this;return(0,l.Z)(function*(){const n=F.getDataSourceNameByAttribute(e);return!n||!!!(yield F.getDataSchema(r,n))?.findAttributeByName(a._recordSchemaNameColumnName)?Promise.resolve(null):a._getMasterRecordEntitySchemaName(t,i,r)})()}static addDependencies(e,t,i){const r=e.modelConfig?.dependencies??{};if(!r[i]&&t.masterRecordColumnValue){const a=t.masterRecordColumnValue.split("$")[1];if(!a)return;const n=this._getRelativeAttributePath(a,e);if(!n)return;const s=this._getReferenceColumnName(t);if(!s)return;r[i]=this._createDependency(n,s),e.modelConfig=e.modelConfig??{},e.modelConfig.dependencies=r}}}const kt="SysFile";function ni(T){const e=[];return T.forEach(t=>{const i={expressionType:2,parameter:{dataValueType:10,value:{Id:t,value:t}}};e.push(i)}),e}function qt(T){const e=[],t={expressionType:2,parameter:{dataValueType:1,value:T}};return e.push(t),e}function Ut(T,e,t,i){const r={};if(T?.length){const a=(0,h.generateGuid)(),n={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"FileGroup"},isAggregative:!1,dataValueType:10,referenceSchemaName:"FileGroup",rightExpressions:ni(T)};r[a]=n}if(e?.trim()){const a=(0,h.generateGuid)(),n={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"Tag"},isAggregative:!1,dataValueType:2,rightExpressions:qt(e)};r[a]=n}if(i&&t===kt){const a=(0,h.generateGuid)(),n={filterType:4,comparisonType:3,isEnabled:!0,trimDateTimeParameterToDate:!1,leftExpression:{expressionType:0,columnPath:"RecordSchemaName"},isAggregative:!1,dataValueType:2,rightExpressions:qt(i)};r[a]=n}return Object.getOwnPropertyNames(r).length?{value:{items:r,logicalOperation:0,isEnabled:!0,filterType:6,rootSchemaName:t||kt}}:null}function Wt(T,e){return`${T}_${e}`}function Dt(T,e){let t="";return e&&Object.keys(T).forEach(i=>{const r=T[i];r&&(0,f.isModelAttributeConfig)(r)&&r.modelConfig?.path===e&&(t=i)}),t}var o=v(94450);class qe{get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._actionDashboardPreprocessingDisableFeature))}constructor(e,t){this._featureService=e,this._dcmSettingsService=t,this._actionDashboardPreprocessingDisableFeature="DisableActionDashboardPreprocessing"}_addStageAttribute(e,t,i){const r=e.viewModelConfig.attributes||{},a=`${i}.${t}`;if(!Dt(r,a)){const n=`LookupAttribute_${t}`;r[n]={modelConfig:{path:a}},e.viewModelConfig.attributes=r}}_extendWithDcmStageAttribute(e,t){var i=this;return(0,l.Z)(function*(){const r=yield(0,_.lastValueFrom)(i._dcmSettingsService.getStageColumnName(t.viewConfig.entitySchemaName),{defaultValue:null});r&&i._addStageAttribute(e,r,t.viewConfig.dataSourceName)})()}_extendWithPrimaryValueAttribute(e,t,i,r){const a=e.viewModelConfig.attributes||{},n=`${i}.${r}`;let s=Dt(a,n);s||(s=`ActionDashboard_${r}`,a[s]={modelConfig:{path:n}},e.viewModelConfig.attributes=a),t.viewConfig.primaryColumnValue=`$${s}`}processItemsAsync(e,t,i){var r=this;return(0,l.Z)(function*(){if(!t)return;const a=e.map(function(){var n=(0,l.Z)(function*(s){const c=t.getDataSource(),d=yield(0,_.lastValueFrom)(t.getSchema());s.viewConfig.dataSourceName=c.dataSourceName,s.viewConfig.entitySchemaName=d.name,s.viewConfig.primaryDisplayColumnValue=`$${d.primaryDisplayAttributeName}`,yield r._extendWithDcmStageAttribute(i,s),r._extendWithPrimaryValueAttribute(i,s,c.dataSourceName,d.primaryAttributeName||"Id")});return function(s){return n.apply(this,arguments)}}());yield Promise.all(a)})()}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(yield t.isProcessingDisabled)return e;const i=e;return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ActionDashboard",i.viewConfig).forEach(a=>{a.viewConfig.allowedActions||(a.viewConfig.allowedActions=(0,u.getDefaultDashboardActions)())}),e})()}crtOnModelInit(e,t){var i=this;return(0,l.Z)(function*(){if((yield i.isProcessingDisabled)||t.length===0)return e;const r=e,a=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ActionDashboard",r.viewConfig),n=r.modelConfig?.primaryDataSourceName,s=t.find(c=>c.name===n);return yield i.processItemsAsync(a,s,r),e})()}static#e=this.\u0275fac=function(t){return new(t||qe)(o.\u0275\u0275inject(y.FeatureService),o.\u0275\u0275inject(y.DcmSettingsService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:qe,factory:qe.\u0275fac})}var W=v(34617);class Ue{_getMenuItem(e,t,i){return{type:"crt.MenuItem",caption:e.caption||e.captionLcz,clicked:{request:"crt.CreateRecordRequest",params:{entityName:t,defaultValues:i}}}}_getDefaultValues(e,t,i){const r=i?[{attributeName:i,value:e.UId}]:[];return t.length&&r.splice(0,0,...t),r}_getEntityName(e,t){const i=e.viewConfig.clicked.params;let r=i.entityName||"";if(!r){const a=i.itemsAttributeName;if(a){const n=t.getBoundDataSourceNameByAttributePath(a);r=t.dataSchemas[n]?.name}}return r}_getButtonsWithCreateRecordRequest(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig).filter(i=>{const r=i.viewConfig.clicked;return r?.params&&r.request==="crt.CreateRecordRequest"})}_fillMenuItems(e,t){const i=this._getEntityName(e,t);if(!i)return;const r=W.NavigationUtils.getEntityStructure(i,W.UITypePriority.PreferFreedomUI);if(!r)return;const a=W.NavigationUtils.getPagesForAddAction(r.pages);if(!a?.length)return;const n=r.attribute,s=e.viewConfig.clicked.params?.defaultValues||[];if(!s.find(d=>d.attributeName===n)?.value){if(a.length>1){e.viewConfig.clickMode="menu";const d=a.map(p=>{const g=this._getDefaultValues(p,s,n);return this._getMenuItem(p,i,g)});e.viewConfig.menuItems??=[],e.viewConfig.menuItems.splice(0,0,...d)}else if(n){const d=this._getDefaultValues(a[0],s,n);e.viewConfig.clicked.params.defaultValues=d}}}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){return r._getButtonsWithCreateRecordRequest(e).forEach(a=>{r._fillMenuItems(a,i)}),e})()}static#e=this.\u0275fac=function(t){return new(t||Ue)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ue,factory:Ue.\u0275fac})}var A=v(52045),S=v(97600);class We{constructor(e){this.crtRoute=e}_getButtonsWithDefaultPageRequest(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Button",e.viewConfig).filter(i=>i?.viewConfig?.clicked?.request==="crt.ContinueInOtherPageRequest")}_prepareButton(e,t){const i=e.viewConfig;(0,S.isString)(i.visible)||(i.visible=t)}_getEntityNavigationOptions(e){const t=(0,A.resolveSchemaPrimaryEntityName)(e),i=this.crtRoute.getState(),r=(0,S.last)(i?.children),a=(0,S.last)(r?.modelInitConfigs),n=(0,S.last)(i?.modelInitConfigs);return{defaultValues:a?.defaultValues||n?.defaultValues||[],entityName:t,recordId:a?.recordId}}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){const i=e,r=t._getEntityNavigationOptions(i);if(!r.entityName)return Promise.resolve(e);const a=t._getButtonsWithDefaultPageRequest(i),n=yield W.NavigationUtils.getPageForActionAsync({action:h.ModelInPageAction.Edit,...r}),s=yield W.NavigationUtils.getPageForActionAsync({action:h.ModelInPageAction.Add,...r}),c=n?.cardSchema===s?.cardSchema,d=n?.cardSchema===i.name,p=Boolean(!c&&!d&&s&&n?.cardSchema);return a.forEach(g=>{t._prepareButton(g,p)}),Promise.resolve(e)})()}static#e=this.\u0275fac=function(t){return new(t||We)(o.\u0275\u0275inject(W.LocationStrategy))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:We,factory:We.\u0275fac})}const Zt="Telephony.Use",Ht="MailboxSynchronization.Use",zt="Chats.Use",si="SelectedItem";class Ze{constructor(e,t,i){this._userInfo=e,this._profileAttributeService=t,this._licenseOperationValues=i}_getButtonToggleGroups(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ButtonToggleGroup",e.viewConfig).filter(i=>i.viewConfig.for)}_getDefaultSelectedTabValue(e){return e.selectedTab?{value:e.selectedTab}:{}}_removeTab(e,t){const i=e.findIndex(r=>r.name===t);i!==-1&&e.splice(i,1)}_isRemoveTab(e){return!this._licenseOperationValues[e]}_getLicenseOperations(){const e=new Map;return e.set(Zt,"CtiTab"),e.set(Ht,"EmailsTab"),e.set(zt,"ChatsTab"),e}_filterTabs(e){return this._userInfo.isSSP?e.filter(i=>i.name==="FeedsTab"):(this._getLicenseOperations().forEach((i,r)=>{this._isRemoveTab(r)&&this._removeTab(e,i)}),e)}crtOnModelInit(e){var t=this;return(0,l.Z)(function*(){const i=e,r=i?.viewModelConfig?.attributes,a=t._getButtonToggleGroups(i);for(const n of a){const s=n.viewConfig,c=s.for,p=m.MetadataSchemaUtils.getViewConfigInfoByFilter(E=>E.name===c,i.viewConfig)?.[0]?.viewConfig,g=`${c}_Items`;s.items=`$${g}`;let b=p?.items??[];p.name==="CommunicationsPanelItemsTabPanel"&&(b=t._filterTabs(b));const C=(0,u.mapTabItemsToToggleValues)(b);r[g]={value:C};const I=`${c}_${si}`;r[I]=r[I]||t._getDefaultSelectedTabValue(p),s.value=`$${I}`,p.selectedTab=`$${I}`,p.visible=`$${I} | crt.ToBoolean`,yield t._profileAttributeService.prepareAttributeWithFeatureCheck(i,p,"selectedTab",I,"DisableSaveToProfileToggleGroupSelectedTab"),p?.allowToggleClose!==void 0&&(s.allowUntoggle=p?.allowToggleClose)}return Promise.resolve(e)})()}static#e=this.\u0275fac=function(t){return new(t||Ze)(o.\u0275\u0275inject(m.UserInfo),o.\u0275\u0275inject(u.ProfileAttributeService),o.\u0275\u0275inject(y.LICENSE_RESTRICTION_OPERATION_VALUES))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ze,factory:Ze.\u0275fac})}class Z{constructor(e){this._comboboxPreprocessorService=e}_getComboboxesViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ComboBox",e.viewConfig).map(t=>t.viewConfig)}crtOnMetaDataInit(e){const t=e,i=t.viewModelConfig.attributes,r=this._getComboboxesViewConfigs(t);return this._comboboxPreprocessorService.crtOnMetaDataInit(r,i),Promise.resolve(e)}crtOnModelInit(e,t){var i=this;return(0,l.Z)(function*(){const r=e,a=r.viewModelConfig.attributes,n=i._getComboboxesViewConfigs(r);return yield i._comboboxPreprocessorService.crtOnModelInit(n,a,t),e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){const a=e,n=a.viewModelConfig.attributes,s=r._getComboboxesViewConfigs(a);return yield r._comboboxPreprocessorService.crtOnViewModelInit(s,n,i),e})()}static#e=this.\u0275fac=function(t){return new(t||Z)(o.\u0275\u0275inject(U.ComboboxPreprocessorService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Z,factory:Z.\u0275fac})}var M=v(77207);class Ft{constructor(e){this.translateService=e,this.translatePrefix="CommunicationOptions"}translate(e){return this.translateService.instant(`${this.translatePrefix}.${e}`)}}var oi=v(72856),ci=v(54514),li=v(6523);class H extends Ft{constructor(e,t,i,r,a){super(e),this.translateService=e,this._queryExecutor=t,this._domSanitizer=i,this._matIconRegistry=r,this._rightsService=a,this._addCommunicationOptionsRequestName="crt.AddCommunicationOptionsRequest"}_getMenuItemClickRequest(e,t,i,r,a,n){return{request:"crt.CreateCommunicationOptionRequest",params:{componentName:e,indexToInsert:"@event.index",masterRecordColumnName:a,values:{CommunicationType:t,[a]:r,CommunicationTypeName:n,CommunicationTypeDisplayFormat:i}},useRelativeContext:!0}}_getSubMenuItem(e,t,i,r,a,n,s){return{type:"crt.MenuItem",caption:e,clicked:this._getMenuItemClickRequest(t,i,r,a,n,e),...s&&{icon:`${s}`}}}_getMenuItem(e,t){return{type:"crt.MenuItem",caption:t,items:[],...e&&{icon:`${e}`}}}_registerIcon(e){if(!e)return;const t=this._domSanitizer.bypassSecurityTrustResourceUrl(window.location.origin+(0,m.getImageFullUrlById)(e));this._matIconRegistry.addSvgIcon(e,t)}_getAddOptionItems(e,t,i,r){var a=this;return(0,l.Z)(function*(){const n=[],s=yield a.getCommTypes(r),c=[...new Set(s.map(d=>d.typeOrGroupId))];for(const d of c){const p=s.filter(C=>C.typeOrGroupId===d),g=p[0],b=g?.groupIcon?.value;if(p.length>1){const C=a._getMenuItem(b,g.groupName);C.items=p.map(I=>a._getSubMenuItemFromType(I,e,t,i)),n.push(C)}else{const C=a._getSubMenuItemFromType(g,e,t,i);n.push(C)}}return n})()}_getSubMenuItemFromType(e,t,i,r){const a=this._getSubMenuItem(e.displayValue,t,e.value,e.displayFormat,i,r,e.typeIcon?.value);return this._registerIcon(e?.typeIcon?.value),this._registerIcon(e?.groupIcon?.value),a}_getValidationResult(e,t=""){return{success:e,errorMessage:t}}_validateComponentState(e,t){var i=this;return(0,l.Z)(function*(){const r=i._getValidationResult(!0);if(!e.masterRecordColumnName||!e.masterRecordColumnValue)return i._getValidationResult(!1,i.translate("Validations.IncorrectSetupComponentMessage"));if(e.readonly)return i._getValidationResult(!1,i.translate("Validations.ReadOnlyStateMessage"));const a={isNew:!0,schemaName:t},n=yield(0,_.lastValueFrom)(i._rightsService.getCanEdit(a));return n&&!n.result?i._getValidationResult(!1,n.message):r})()}_applyAddButtonState(e,t,i,r){var a=this;return(0,l.Z)(function*(){const n=yield a._validateComponentState(t,r);if(!n.success){e.forEach(s=>{s.clicked={request:"crt.NotificationRequest",params:{message:n.errorMessage,duration:1e4}},s.clickMode="default",s.menuItems=[]});return}e.forEach(s=>{s.clickMode="menu",s.menuItems=[...i,...s.menuItems||[]]})})()}_selectCommTypesFromDB(e){const t=new h.EntitySchemaQuery("CommunicationType");return t.addMacrosFunctionColumn(h.QueryMacrosType.PrimaryColumn,"typeId"),t.addMacrosFunctionColumn(h.QueryMacrosType.PrimaryDisplayColumn,"typeName"),t.addSchemaColumn("ImageLink","typeIcon"),t.addSchemaColumn("DisplayFormat","displayFormat"),t.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.Id","groupId"),t.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.Name","groupName"),t.addSchemaColumn("[ComTypebyCommunication:CommunicationType:Id].Communication.ImageLink","groupIcon"),t.filters.addSchemaColumnFilterWithParameter(h.ComparisonType.Not_equal,"[ComTypebyCommunication:CommunicationType:Id].Communication",u.CommunicationEnum.SMS),e==="ContactCommunication"&&t.filters.addSchemaColumnFilterWithParameter(h.ComparisonType.Equal,"UseforContacts",!0),e==="AccountCommunication"&&t.filters.addSchemaColumnFilterWithParameter(h.ComparisonType.Equal,"UseforAccounts",!0),this._queryExecutor.executeSelectQuery(t).pipe((0,_.share)(),(0,_.map)(i=>i.map(r=>({typeOrGroupId:r.groupId||r.typeId,value:r.typeId,displayValue:r.typeName,groupName:r.groupName,typeIcon:r.typeIcon,groupIcon:r.groupIcon,displayFormat:r.displayFormat}))),(0,_.catchError)(i=>(0,_.of)([])))}_getAddCommOptionsButtonsConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.Button","crt.MenuItem"],e.viewConfig).filter(t=>t.viewConfig.clicked?.request===this._addCommunicationOptionsRequestName).map(t=>t.viewConfig)}getCommTypes(e){return(0,_.lastValueFrom)(this._selectCommTypesFromDB(e))}processAddButton(e,t,i){var r=this;return(0,l.Z)(function*(){const a=r._getAddCommOptionsButtonsConfigs(t),n=t?.modelConfig?.dataSources,s=n&&n[i]?.config?.entitySchemaName||"",c=yield r._getAddOptionItems(e.name,e.masterRecordColumnValue,e.masterRecordColumnName,s),d=a.filter(p=>e.name===p.clicked?.params?.viewElementName);yield r._applyAddButtonState(d,e,c,s)})()}static#e=this.\u0275fac=function(t){return new(t||H)(o.\u0275\u0275inject(M.TranslateService),o.\u0275\u0275inject(li.QueryExecutor),o.\u0275\u0275inject(ci.DomSanitizer),o.\u0275\u0275inject(oi.MatIconRegistry),o.\u0275\u0275inject(y.RightsService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac})}class z extends Ft{constructor(e){super(e),this.translateService=e}_setSortingConfig(e,t){const i=e.items.slice(1),r=`${i}_Sorting`,a=t.viewModelConfig.attributes;a[r]={isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}};const n=a[i];n.modelConfig={...n.modelConfig,sortingConfig:{...n.modelConfig?.sortingConfig,attributeName:r,default:[{columnName:"CreatedOn",direction:"asc"}]}}}_initTypeNameAttribute(e,t){const i=`${t}_CommunicationTypeName`,r=`${t}_Primary`,a=`${t}_NonActual`,n=" \u2022 "+this.translate("Primary"),s=" \u2022 "+this.translate("Invalid"),c=`${i}_Extended`,d=e?.viewModelConfig.attributes??{};d[c]={from:[i,r,a],converter:`crt.AppendConditionalParts : '${n}' : '${s}'`}}_prepareAttributes(e,t,i,r){(0,f.isModelAttributeConfig)(i)&&!i.modelConfig?.sortingConfig?.attributeName&&this._setSortingConfig(e,t),this._initTypeNameAttribute(i,r)}processAttributes(e,t,i,r){this._prepareAttributes(e,t,i,r)}static#e=this.\u0275fac=function(t){return new(t||z)(o.\u0275\u0275inject(M.TranslateService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:z,factory:z.\u0275fac})}class J extends Ft{constructor(e){super(e),this.translateService=e}_getActionClickedRequest(e,t,i){return{request:e,params:{recordId:`$${t}.${i}_Id`,collectionAttributeName:t}}}_getDefaultOptionActions(e,t){const i=`${e}.${t}_Primary`,r=`${e}.${t}_NonActual`,a=this.translate("MarkAsPrimary"),n=this.translate("MarkAsValid"),s=this.translate("MarkAsInvalid"),c=this.translate("DeleteOption");return[{type:"crt.MenuItem",caption:a,icon:"flag-button-icon",visible:`$${i} | crt.NorCondition : $${r}`,clicked:this._getActionClickedRequest("crt.MakeCommunicationOptionPrimaryRequest",e,t)},{type:"crt.MenuItem",caption:`$${r}
					| crt.BooleanToStringValue : '${n}' : '${s}'`,icon:`$${r}
					| crt.BooleanToStringValue : 'valid-circle' : 'invalid-circle'`,clicked:this._getActionClickedRequest("crt.ChangeCommunicationInvalidStateRequest",e,t)},{type:"crt.MenuItem",caption:c,icon:"delete-button-icon",clicked:this._getActionClickedRequest("crt.RemoveCommunicationOptionRequest",e,t)}]}_getOptionActions(e,t,i){const r=this._getDefaultOptionActions(t,i),a=e.optionActions??[];return[...r,...a]}_extendViewConfig(e,t,i){e.primaryColumnName=`${i}_Id`,e.numberColumnName=`${i}_Number`,e.typeColumnName=`${i}_CommunicationType`,e.displayFormatColumnName=`${i}_CommunicationTypeDisplayFormat`,e.optionActions=this._getOptionActions(e,t,i)}_getDefaultOptionConfig(e,t,i){return{label:`$${`${`${e}.${t}_CommunicationTypeName`}_Extended`}`,control:`$${e}.${t}_Number`,labelPosition:i}}_applyReadonlyState(e,t){Object.entries(e).forEach(([,i])=>{t.readonly&&(i.readonly=t.readonly),i.bindTo=`$${(0,m.generatePropertiesAttributeName)(t.name)}`})}_getToolsTemplate(e){return[{type:"crt.Button",icon:"actions-button-icon",iconPosition:"only-icon",color:"default",size:"none",clickMode:"menu",displayType:"text",classes:["actions-btn"],menuItems:e.optionActions}]}_extendWithProperties(e,t){Object.keys(e).forEach(i=>{e[i]={...t,...e[i]}})}_initTemplates(e,t,i){const r=this._getDefaultOptionConfig(t,i,e.labelPosition??"auto"),a=e.templates??{},n=this._getToolsTemplate(e),s={[u.CommunicationOptionTypeEnum.Email]:{type:"crt.EmailInput"},[u.CommunicationOptionTypeEnum.Phone]:{type:"crt.PhoneInput",phoneAsLink:!0,displayAsPhone:!1,displayPhoneMask:!1},[u.CommunicationOptionTypeEnum.Web]:{type:"crt.WebInput"},[u.CommunicationOptionTypeEnum.Google]:{type:"crt.WebInput",icon:"google-web-icon"},[u.CommunicationOptionTypeEnum.Facebook]:{type:"crt.WebInput",icon:"facebook-web-icon"},[u.CommunicationOptionTypeEnum.LinkedIn]:{type:"crt.WebInput",icon:"linkedin-web-icon"},[u.CommunicationOptionTypeEnum.Twitter]:{type:"crt.WebInput",icon:"twitter-web-icon"},[u.CommunicationOptionTypeEnum.Skype]:{type:"crt.WebInput",icon:"skype-web-icon"},[u.CommunicationOptionTypeEnum.Text]:{type:"crt.Input"}};this._extendWithProperties(s,{tools:n});const c={...s,...a};this._extendWithProperties(c,r),this._applyReadonlyState(c,e),e.templates=c}processViewConfig(e,t,i){this._extendViewConfig(e,t,i),this._initTemplates(e,t,i)}static#e=this.\u0275fac=function(t){return new(t||J)(o.\u0275\u0275inject(M.TranslateService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac})}class He{static#e=this.\u0275fac=function(t){return new(t||He)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:He});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[H,J,z]})}class ze extends Ft{constructor(e,t,i,r,a){super(t),this._featureService=e,this.translateService=t,this._addButtonService=i,this._viewConfigService=r,this._attributesService=a,this._communicationOptionsProcessingDisableFeature="DisableCommunicationOptionsPreprocessing",this.translatePrefix="CommunicationOptions"}get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._communicationOptionsProcessingDisableFeature))}_isValidItemsBinding(e,t){return(0,A.isBindToViewModelAttribute)(e.items,t.viewModelConfig?.attributes)?!0:(console.warn(`The setup property [items] for component [${e.name}] is incorrect.Only binding to the ViewModel collection attribute is allowed for this property.`),!1)}processItem(e,t){var i=this;return(0,l.Z)(function*(){if(i._isValidItemsBinding(e,t)){const r=e.items.split("$")[1],a=t.viewModelConfig?.attributes?.[r]??{},n=a?.modelConfig?.path||"";i._viewConfigService.processViewConfig(e,r,n),i._attributesService.processAttributes(e,t,a,n),F.addDependencies(t,e,n),yield i._addButtonService.processAddButton(e,t,n)}})()}processItemsAsync(e,t){var i=this;return(0,l.Z)(function*(){const r=e.map(function(){var a=(0,l.Z)(function*(n){yield i.processItem(n.viewConfig,t)});return function(n){return a.apply(this,arguments)}}());yield Promise.all(r)})()}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(yield t.isProcessingDisabled)return e;const i=e,r=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.CommunicationOptions",i.viewConfig);return yield t.processItemsAsync(r,i),e})()}static#e=this.\u0275fac=function(t){return new(t||ze)(o.\u0275\u0275inject(y.FeatureService),o.\u0275\u0275inject(M.TranslateService),o.\u0275\u0275inject(H),o.\u0275\u0275inject(J),o.\u0275\u0275inject(z))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ze,factory:ze.\u0275fac})}class Je{constructor(e){this._featureService=e,this._commonCommunicationsBehaviorFeature="CommonCommunicationsBehavior",this._communicationOptionsProcessingDisableFeature="DisableCommunicationOptionsPreprocessing",this._replacementConfig={ContactCommunicationOptions:{replaceData:[{type:"crt.EmailInput",label:"Email",labelPosition:"above",control:"$Email",visible:!0,placeholder:"",tooltip:"",name:"Email"},{type:"crt.PhoneInput",label:"Mobile phone",labelPosition:"above",control:"$MobilePhone",visible:!0,placeholder:"",tooltip:"",name:"MobilePhone"}],additionalAttributesConfig:{MobilePhone:{modelConfig:{path:"PDS.MobilePhone"}},Email:{modelConfig:{path:"PDS.Email"}}}},AccountCommunicationOptions:{replaceData:[{type:"crt.WebInput",label:"Web",labelPosition:"above",control:"$Web",visible:!0,placeholder:"",tooltip:"",name:"Web"},{type:"crt.PhoneInput",label:"Primary phone",labelPosition:"above",control:"$Phone",visible:!0,placeholder:"",tooltip:"",name:"Phone"}],additionalAttributesConfig:{Phone:{modelConfig:{path:"PDS.Phone"}},Web:{modelConfig:{path:"PDS.Web"}}}}},this._namesToDelete=[...Object.keys(this._replacementConfig),"ContactCommunicationOptionsAddButton","AccountCommunicationOptionsAddButton"]}get isCommonCommunicationsBehaviorEnabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._commonCommunicationsBehaviorFeature))}get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._communicationOptionsProcessingDisableFeature))}_prepareAttibutesBeforeReplacement(e,t){const i=e?.additionalAttributesConfig||{};for(const[r,a]of Object.entries(i)){const n=Dt(t,a.modelConfig?.path);n&&n!==r&&(i[n]=t[n],delete i[r],e.replaceData=[...e.replaceData].map(s=>s.control===`$${r}`?{...s,control:`$${n}`}:s))}Object.assign(t,i)}_replaceCommOptionsWithFields(e){e.viewModelConfig={attributes:{},...e.viewModelConfig},m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("name",this._namesToDelete,e.viewConfig).forEach(i=>{const a=m.MetadataSchemaUtils.getViewConfigInfoByProperty("name",i.parentName,e.viewConfig)[0].viewConfig,n=i.viewConfig.name,s=a[i.parentPropertyName],c=s.indexOf(i.viewConfig);this._prepareAttibutesBeforeReplacement(this._replacementConfig[i.viewConfig.name],e.viewModelConfig.attributes);const d=this._replacementConfig[n]?.replaceData||[];s.splice(c,1,...d)})}_makeOtherCommOptionsComponentsReadonly(e){e.filter(i=>!this._namesToDelete.includes(i.viewConfig.name)).forEach(i=>i.viewConfig.readonly=!0)}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if((yield t.isProcessingDisabled)||(yield t.isCommonCommunicationsBehaviorEnabled))return e;const i=e,r=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.CommunicationOptions",i.viewConfig);return t._replaceCommOptionsWithFields(i),t._makeOtherCommOptionsComponentsReadonly(r),e})()}static#e=this.\u0275fac=function(t){return new(t||Je)(o.\u0275\u0275inject(y.FeatureService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Je,factory:Je.\u0275fac})}class Mt{hasEntityEditPage(e,t){return(0,l.Z)(function*(){const i={type:"crt.7XRequest",action:"HasEntityEditPage",$context:e,payload:{entityName:t}};return yield h.HandlerChainService.instance.process(i)})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){return yield Promise.all((0,u.getDataGridViewConfigsWithItemsBinding)(e,r.viewItemTypes).filter(a=>!a.rowToolbarItems).map(a=>r.setRowToolbarMenuItems(a,i))),e})()}}class Y extends Mt{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.DataGrid"]}setRowToolbarMenuItems(e,t){var i=this;return(0,l.Z)(function*(){const r=e.items.slice(1),a=t.getBoundDataSourceNameByAttributePath(r),n=t.getBoundDataSchemaByAttributePath(r)?.name,s=yield i.hasEntityEditPage(t,n),c=`$${r}.PrimaryModelMode | crt.IsEqual : 'create'`;e.rowToolbarItems=[{type:"crt.MenuItem",caption:i._translateService.instant("DataGrid.RowToolbar.Open"),icon:"edit-row-action",visible:s,disabled:c,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:r,recordId:`$${r}.${a}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:i._translateService.instant("DataGrid.RowToolbar.Copy"),icon:"copy-row-action",visible:s,disabled:c,clicked:{request:"crt.CopyRecordRequest",params:{itemsAttributeName:r,recordId:`$${r}.${a}_Id`},useRelativeContext:!0}},{type:"crt.MenuItem",caption:i._translateService.instant("DataGrid.RowToolbar.Delete"),icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:r,recordId:`$${r}.${a}_Id`},useRelativeContext:!1}}]})()}static#e=this.\u0275fac=function(t){return new(t||Y)(o.\u0275\u0275inject(M.TranslateService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Y,factory:Y.\u0275fac})}class ${constructor(e){this._dataGridDefaultBulkActionsCreator=e,this.viewItemTypes=["crt.DataGrid"]}_setDefaultBulkActions(e,t){const i=(0,A.parseExpression)(e.items).attributePath;if(!i)return;const a=t[i]?.modelConfig?.path;!a||(e.bulkActions=this._dataGridDefaultBulkActionsCreator.createDefaultBulkActions(a,e))}crtOnMetaDataInit(e){const t=e,i=t.viewModelConfig.attributes??{};return(0,u.getDataGridViewConfigsWithItemsBinding)(t,this.viewItemTypes).filter(r=>r.bulkActions===void 0).forEach(r=>{this._setDefaultBulkActions(r,i)}),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||$)(o.\u0275\u0275inject(u.DataGridDefaultBulkActionsCreator))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac})}class Ye{constructor(e){this._dataGridDefaultBulkActionsCreator=e,this.viewItemTypes=["crt.DataGrid"]}_clearDefaultBulkActions(e,t){const i=(0,A.parseExpression)(e.items).attributePath;if(!i)return;const a=t[i]?.modelConfig?.path;if(!a)return;const n=this._dataGridDefaultBulkActionsCreator.createDefaultBulkActions(a,e);n&&(0,S.isEqual)(e.bulkActions,n)&&(e.bulkActions=void 0)}crtOnMetaDataChanged(e){const t=e,i=t.viewModelConfig.attributes??{};return(0,u.getDataGridViewConfigsWithItemsBinding)(t,this.viewItemTypes).forEach(r=>{this._clearDefaultBulkActions(r,i)}),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||Ye)(o.\u0275\u0275inject(u.DataGridDefaultBulkActionsCreator))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ye,factory:Ye.\u0275fac})}class Q{static#e=this.\u0275fac=function(t){return new(t||Q)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:Q});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:f.CRT_METADATA_PREPROCESSOR,useClass:$,multi:!0},{provide:f.CRT_METADATA_POSTPROCESSOR,useClass:Ye,multi:!0},{provide:f.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useClass:$,multi:!0}]})}var Bt=v(14537);const ui={[h.DataValueType.Integer]:0,[h.DataValueType.FLOAT1]:1,[h.DataValueType.FLOAT2]:2,[h.DataValueType.FLOAT3]:3,[h.DataValueType.FLOAT4]:4,[h.DataValueType.FLOAT8]:8,[h.DataValueType.Money]:2};class B{process(e,t){const i=ui[t]??null;i!==null&&!e.format&&(e.format={decimalPrecision:i})}static#e=this.\u0275fac=function(t){return new(t||B)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:B,factory:B.\u0275fac})}class Qe{constructor(e){this._numberInputPreprocessorService=e}_process(e,t){if(!(0,A.isBindingExpression)(e.control))return;const i=(0,A.parseExpression)(e.control).attributePath;if(!i)return;const a=t.getBoundDataSchemaAttributeByAttributePath(i)?.dataValueType;!a||this._numberInputPreprocessorService.process(e,a)}crtOnViewModelInit(e,t,i){const r=e;return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.NumberInput",r.viewConfig).forEach(n=>{this._process(n.viewConfig,i)}),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||Qe)(o.\u0275\u0275inject(B))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Qe,factory:Qe.\u0275fac})}class X{constructor(e,t,i,r,a){this._editingCellViewConfigCreatorFactory=e,this._featureService=t,this._metadataModifierService=i,this._comboboxPreprocessorService=r,this._numberInputPreprocessorService=a}_isEditingModeDisabled(){return(0,_.firstValueFrom)(this._featureService.getFeatureState(R.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_updateAttributeProperties(e,t,i){Bt.ViewElementConfigUtils.updateCollectionAttributeProperties(t,e,i,[{name:"readonly",defaultValue:!1}])}_addColumnsEditingCellViewConfigs(e,t,i,r=!1){var a=this;return(0,l.Z)(function*(){const n=e.columns;if(!Array.isArray(n))return;const s=e.items,c=n.filter(d=>!d.editingCellView);for(const d of c){const g=yield a._editingCellViewConfigCreatorFactory.create({dataValueType:d.dataValueType,columnName:d.code}).getViewElementConfig({column:d,itemsAttributeName:s,context:t});r&&g&&a._updateAttributeProperties(i,g,s),g&&a._metadataModifierService.addProperty(d,"editingCellView",g)}})()}_getColumnDefinitionByPredicate(e,t){return Array.isArray(e.columns)?(e.columns||[]).filter(t):[]}_getComboboxesViewConfigsFromDataGridViewConfig(e){return this._getDataGridComboBoxColumnDefinitions(e).map(t=>t.editingCellView)}_getDataGridComboBoxColumnDefinitions(e){return this._getColumnDefinitionByPredicate(e,t=>Boolean(t.dataValueType===h.DataValueType.Lookup&&t.editingCellView))}_getDataGridNumberInputColumnDefinitions(e){return this._getColumnDefinitionByPredicate(e,t=>Boolean(t.editingCellView?.type==="crt.DataTableEditNumericCell"))}_getDataGridItemsAttributeConfig(e,t){const i=(0,u.getViewModelItemsAttributeName)(e);return i?t.viewModelConfig.attributes[i]?.viewModelConfig?.attributes:void 0}_addEditableFeature(e,t){const i=e.features;if((0,A.isBindingExpression)(i))return;const r=(0,u.fullInDataTableEditingFeatures)(i?.editable,!t);if(!i)return this._metadataModifierService.addProperty(e,"features",{editable:r});const a=i.editable;if(a==null)return this._metadataModifierService.addProperty(i,"editable",r);typeof a!="boolean"&&(a.enable==null&&this._metadataModifierService.addProperty(a,"enable",r.enable),a.itemsCreation==null&&this._metadataModifierService.addProperty(a,"itemsCreation",a.enable&&r.itemsCreation),a.floatingEditPanel==null&&this._metadataModifierService.addProperty(a,"floatingEditPanel",a.enable&&r.floatingEditPanel),a.lookupItemsCreation==null&&this._metadataModifierService.addProperty(a,"lookupItemsCreation",a.enable&&r.lookupItemsCreation))}_comboboxesOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){const a=r._getComboboxesViewConfigsForOnViewModelInit(e,t);yield r._comboboxPreprocessorService.crtOnViewModelInit(a,t,i)})()}_getComboboxesViewConfigsForOnViewModelInit(e,t){return e.map(i=>{const r=this._getComboboxesViewConfigsFromDataGridViewConfig(i);return this._addActionAddRecordToListActionsIfNeed(r,t,i),r}).flat(1)}_addActionAddRecordToListActionsIfNeed(e,t,i){const r=this._getLookupItemsCreationFeatureValue(i);!(!(0,S.isBoolean)(r)||r)||e.forEach(n=>this._addActionAddRecordToListActions(n,t))}_getLookupItemsCreationFeatureValue(e){return e.features?.editable?.lookupItemsCreation}_addActionAddRecordToListActions(e,t){const i=t[`${e.attributeName}_List`],r=i&&"embeddedModel"in i&&i.embeddedModel?.config?.config?.entitySchemaName;if(!r)return;const a=e.control.split(".").pop(),n={...U.defaultAddRecordActionConfig,clicked:{request:"crt.CreateRecordFromEditLookupCellRequest",params:{schemaName:r,attributeName:a,detail:"@event.detail"},useRelativeContext:!0},name:D.NameGenerator.generateUnique("ListAction")};this._addComboboxActionIfNotExist(e,U.ComboboxActionCodeEnum.AddRecord,n)}_addComboboxActionIfNotExist(e,t,i){e.listActions||(e.listActions=[]),!e.listActions.some(a=>a.code===t)&&e.listActions.push(i)}_numbersOnViewModelInit(e){this._getDataGridNumberInputColumnDefinitions(e).forEach(i=>{const r=i.dataValueType,a=i.editingCellView;this._numberInputPreprocessorService.process(a,r)})}_updateCellPropertiesOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){const a=e.items,n=r._getColumnDefinitionByPredicate(e,s=>Boolean(s.editingCellView?.type===i));for(const s of n){const d=yield r._editingCellViewConfigCreatorFactory.create({dataValueType:s.dataValueType,columnName:s.code}).getViewElementConfig({column:s,itemsAttributeName:a,context:t});r._metadataModifierService.addProperty(s,"editingCellView",d)}})()}_phoneOnViewModelInit(e,t){var i=this;return(0,l.Z)(function*(){yield i._updateCellPropertiesOnViewModelInit(e,t,"crt.DataTableEditPhoneCell")})()}_emailOnViewModelInit(e,t){var i=this;return(0,l.Z)(function*(){yield i._updateCellPropertiesOnViewModelInit(e,t,"crt.DataTableEditEmailCell")})()}_isDataGridEditingEnabled(e){const t=e.features;return(0,A.isBindingExpression)(t)?!0:(0,u.fullInDataTableEditingFeatures)(t?.editable).enable}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){const i=e,r=yield t._isEditingModeDisabled(),a=(0,u.getDataGridViewConfigs)(e);for(const n of a){if(t._addEditableFeature(n,r),!t._isDataGridEditingEnabled(n)||r)continue;yield t._addColumnsEditingCellViewConfigs(n,null,i,!0);const s=t._getDataGridItemsAttributeConfig(n,e);if(!s)continue;const c=t._getComboboxesViewConfigsFromDataGridViewConfig(n);t._comboboxPreprocessorService.crtOnMetaDataInit(c,s)}return e})()}crtOnModelInit(e,t){var i=this;return(0,l.Z)(function*(){if(yield i._isEditingModeDisabled())return e;const r=(0,u.getDataGridViewConfigs)(e);for(const a of r){if(!i._isDataGridEditingEnabled(a))continue;const n=i._getDataGridItemsAttributeConfig(a,e);if(!n)continue;const s=i._getComboboxesViewConfigsFromDataGridViewConfig(a);yield i._comboboxPreprocessorService.crtOnModelInit(s,n,t)}return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){if(yield r._isEditingModeDisabled())return e;const a=e,n=(0,u.getDataGridViewConfigs)(e);let s={};const c=[];for(const d of n){if(!r._isDataGridEditingEnabled(d))continue;const p=r._getDataGridItemsAttributeConfig(d,e);!p||(s={...s,...p},c.push(d),yield r._addColumnsEditingCellViewConfigs(d,i,a),r._numbersOnViewModelInit(d),yield r._phoneOnViewModelInit(d,i),yield r._emailOnViewModelInit(d,i))}return yield r._comboboxesOnViewModelInit(c,s,i),e})()}static#e=this.\u0275fac=function(t){return new(t||X)(o.\u0275\u0275inject(R.DATA_GRID_EDITING_CELL_VIEW_CONFIG_CREATOR_FACTORY),o.\u0275\u0275inject(y.FeatureService),o.\u0275\u0275inject(f.MetadataModifierService),o.\u0275\u0275inject(U.ComboboxPreprocessorService),o.\u0275\u0275inject(B))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac})}var P=v(27049);class G{constructor(e,t,i){this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=i,this.featureName="DisableDataGridColumnsPreprocessing",this.viewItemTypes=["crt.DataGrid"]}_getColumnDefinitions(e,t){var i=this;return(0,l.Z)(function*(){const r=e.columns,a=yield i.getGenerateCellViewConfig(e,t);return a?(0,_.lastValueFrom)(i.dataGridColumnDefinitionService.processDataGridColumnDefinitions(a,r)):[]})()}_addColumnsCellViewConfigs(e,t){var i=this;return(0,l.Z)(function*(){const r=e.columns;if(!Array.isArray(r)||r.length===0)return;const a=yield i._getColumnDefinitions(e,t);i._addColumnProperty(r,a,"cellView"),i._addColumnProperty(r,a,"readonly"),r.forEach(n=>{delete n.path,delete n.referenceSchemaName})})()}_addColumnProperty(e,t,i){e.filter(r=>!r[i]).map(r=>[r,t.find(a=>a.code===r.code)]).forEach(([r,a])=>this.metadataModifierService.addProperty(r,i,a?.[i]))}getGenerateCellViewConfig(e,t){const i=(0,_.of)(t),r=(0,u.getViewModelItemsAttributeName)(e);if(!r)return Promise.resolve(null);const a=i.pipe((0,P.map)(c=>c?.getBoundDataSourceNameByAttributePath(r))),n=i.pipe((0,P.map)(c=>c?.getBoundDataSchemaByAttributePath(r))),s=e.items;return(0,_.lastValueFrom)((0,_.forkJoin)([a,n]).pipe((0,P.switchMap)(([c,d])=>c&&d?(0,_.of)({dataSchema:d,dataSourceName:c,itemsAttributeName:s,viewModel:t,features:e.features,dataGridName:e.name}):(0,_.of)(null))))}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){if(yield(0,_.lastValueFrom)(r.featureService.getFeatureState(r.featureName),{defaultValue:null}))return e;const n=m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",r.viewItemTypes,e.viewConfig);for(const s of n)yield r._addColumnsCellViewConfigs(s.viewConfig,i);return e})()}static#e=this.\u0275fac=function(t){return new(t||G)(o.\u0275\u0275inject(y.FeatureService),o.\u0275\u0275inject(f.MetadataModifierService),o.\u0275\u0275inject(R.DataGridColumnDefinitionService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:G,factory:G.\u0275fac})}class K{constructor(e){this._filterOptionsBackwardCompatibilityModifier=e}_isEmptyExposeFilters(e){const t=e?._filterOptions;return t?!t.expose?.length:!1}crtOnMetaDataInit(e){return(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).filter(t=>this._isEmptyExposeFilters(t)).forEach(t=>this._filterOptionsBackwardCompatibilityModifier.modify(t)),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||K)(o.\u0275\u0275inject(u.DataGridFilterOptionsBackwardCompatibilityModifier))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:K,factory:K.\u0275fac})}class ee{_setInitialFilterOptions(e){e.items??=`$${(0,u.createDataGridItemsAttributeName)(e)}`,e.activeRow??=`$${(0,u.createDataGridActiveRowAttributeName)(e)}`;const t=(0,u.createDataGridInitialFilterOptions)(e);t&&(e._filterOptions=t)}_canSetInitialFilterOptions(e){return(0,S.isEmpty)(e?._filterOptions)&&(0,u.canDataGridContainsFilterOptions)(e)}crtOnMetaDataInit(e){return(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).filter(this._canSetInitialFilterOptions).forEach(t=>this._setInitialFilterOptions(t)),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||ee)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ee,factory:ee.\u0275fac})}class Rt{static#e=this.\u0275fac=function(t){return new(t||Rt)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:Rt});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[u.DataGridFilterOptionsBackwardCompatibilityModifier,{provide:f.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useClass:ee,multi:!0},{provide:f.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useClass:K,multi:!0}]})}class Xe{_cleanupDefaultFilterOptionsMetadata(e){const t=e._filterOptions;if(!t)return this._cleanupDefaultActiveRow(e);const i=(0,S.cloneDeep)(e),r=`$${(0,u.createDataGridActiveRowAttributeName)(e)}`;i.activeRow??=r;const a=(0,u.createDataGridInitialFilterOptions)(i);!(0,S.isEqual)(t,a)||(delete e._filterOptions,this._cleanupDefaultActiveRow(e))}_cleanupDefaultActiveRow(e){const t=e.activeRow,i=`$${(0,u.createDataGridActiveRowAttributeName)(e)}`;(0,S.isEqual)(t,i)&&delete e.activeRow}crtOnMetaDataChanged(e){return(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).forEach(t=>this._cleanupDefaultFilterOptionsMetadata(t)),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||Xe)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Xe,factory:Xe.\u0275fac})}class Pt{static#e=this.\u0275fac=function(t){return new(t||Pt)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:Pt});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:f.CRT_METADATA_POSTPROCESSOR,useClass:Xe,multi:!0}]})}class te{constructor(e,t,i,r,a){this._defaultFeatures=e,this._featureValues=t,this._translateService=i,this._dataGridFolderTreeRelationsProvider=r,this._licenseOperationValues=a}_createGeneralListSettingsMenuItems(e,t){const i=`$${t} | crt.ToBoolean | crt.InvertBooleanValue`,r=this._defaultFeatures?.operations?.canCreateDefaultGridSettings,a={type:"crt.MenuItem",caption:this._translateService.instant("DataGrid.ActionsToolbar.SaveForAll"),icon:"save",visible:i,clicked:{request:"crt.DataGridSaveConfigsForAllRequest",params:{dataGridName:e.name}}};return[{type:"crt.MenuLabel",caption:this._translateService.instant("DataGrid.ActionsToolbar.GeneralListSettingsLabel"),visible:i},...r?[a]:[],{type:"crt.MenuItem",caption:this._translateService.instant("DataGrid.ActionsToolbar.ResetToDefault"),icon:"reset",visible:i,clicked:{request:"crt.DataGridResetConfigsToDefaultRequest",params:{dataGridName:e.name}}}]}_setupSaveConfigsForActiveFolderActionVisibleAttribute(e,t,i,r){const a=`${t}_Exist`,n=`${i}_NotExist`;r.viewModelConfig??={},r.viewModelConfig.attributes={...r.viewModelConfig.attributes,[a]:{from:t,converter:"crt.ToBoolean"},[n]:{from:i,converter:"crt.ToBoolean | crt.InvertBooleanValue"},[e]:{from:[a,n],converter:"crt.IsEveryEqualTo : true"}}}_createFolderListSettingsMenuItems(e,t,i){const r=this._licenseOperationValues[u.CAN_MANAGE_LIST_COLUMNS_LICENSE_OPERATION_CODE];if(this._featureValues.DisableDataGridSettingsByFolders||!r)return[];const a=this._dataGridFolderTreeRelationsProvider.getSingleRelatedFolderTreeViewConfig(e,i);if(!a?.name)return[];const n=this._translateService.instant("DataGrid.ActionsToolbar.SaveListSettingsForFolder"),s=this._translateService.instant("DataGrid.ActionsToolbar.ClearListSettingsForFolder"),c=`$${t} | crt.ToBoolean`,{activeFolderFolderTreeIdAttrName:d,activeFolderNameAttrName:p}=(0,m.buildFolderTreeAttributeNames)(a.name),g=`$${p} | crt.InterpolateString : '${n}'`,b=e.name+"_SaveConfigsForActiveFolderAction_Visible";return this._setupSaveConfigsForActiveFolderActionVisibleAttribute(b,d,t,i),[{type:"crt.MenuLabel",caption:this._translateService.instant("DataGrid.ActionsToolbar.FolderListSettingsLabel"),visible:`$${d} | crt.ToBoolean`},{type:"crt.MenuItem",caption:g,icon:"save-for-folder-icon",visible:`$${b}`,clicked:{request:"crt.DataGridSaveConfigsForActiveFolderRequest",params:{folderTreeName:a.name,dataGridName:e.name}}},{type:"crt.MenuItem",caption:g,icon:"save-for-folder-icon",visible:c,clicked:{request:"crt.DataGridUpdateConfigsForActiveFolderRequest",params:{folderTreeName:a.name,dataGridName:e.name}}},{type:"crt.MenuItem",caption:`$${p} | crt.InterpolateString : '${s}'`,icon:"discard-for-folder-icon",visible:c,clicked:{request:"crt.DataGridClearConfigsForActiveFolderRequest",params:{dataGridName:e.name,folderTreeName:a.name}}}]}crtOnMetaDataInit(e){return(0,u.getDataGridViewConfigs)(e).filter(i=>!i.headerToolbarItems).forEach(i=>{const r=(0,u.createDataGridActiveFolderSettingsAttributeName)(i),a=this._createGeneralListSettingsMenuItems(i,r),n=this._createFolderListSettingsMenuItems(i,r,e);i.headerToolbarItems=[...a,...n]}),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||te)(o.\u0275\u0275inject(u.DATA_GRID_FEATURES,8),o.\u0275\u0275inject(m.FEATURE_VALUES),o.\u0275\u0275inject(M.TranslateService),o.\u0275\u0275inject(u.DataGridFolderTreeRelationsProvider),o.\u0275\u0275inject(y.LICENSE_RESTRICTION_OPERATION_VALUES))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:te,factory:te.\u0275fac})}class ie{constructor(e){this._featureService=e}_isEditingModeDisabled(){return(0,_.firstValueFrom)(this._featureService.getFeatureState(R.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_setCancelItemsChangesOutput(e){const t=e.items.slice(1);e.cancelItemsChanges={request:"crt.DataGridCancelItemsChangesRequest",params:{itemsAttributeName:t,changedItems:"@event"}}}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){return(yield t._isEditingModeDisabled())||(0,u.getDataGridViewConfigsWithItemsBinding)(e).filter(i=>i.cancelItemsChanges==null).forEach(i=>t._setCancelItemsChangesOutput(i)),e})()}static#e=this.\u0275fac=function(t){return new(t||ie)(o.\u0275\u0275inject(y.FeatureService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ie,factory:ie.\u0275fac})}class re{constructor(e){this._featureService=e}_isEditingModeDisabled(){return(0,_.firstValueFrom)(this._featureService.getFeatureState(R.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_isItemsCreationEnabled(e){const t=e.features;if((0,A.isBindingExpression)(t))return!0;const i=(0,u.fullInDataTableEditingFeatures)(t?.editable,!0);return Boolean(i.itemsCreation)}_bindEditingCellsInput(e,t){if(e.editingCells)return;const i=e.name&&`${e.name}_EditingCells`;!i||(t[i]||(t[i]={value:null}),e.editingCells=`$${i}`)}_bindItemCreatingOutput(e,t,i){if(e.createItem)return;const r=this._getDefaultValuesFromDependencies(e,t,i);e.createItem={request:"crt.DataGridCreateItemRequest",params:{dataGridName:e.name,insertionIndex:"@event.index",defaultValues:r.map(({attributeName:a,value:n})=>({attributeName:a,value:n}))}}}_getDefaultValuesFromDependencies(e,t,i){const r=i.dependencies,a=i.dataSources,n=i.primaryDataSourceName||"",s=e.items.slice(1),d=t[s]?.modelConfig?.path,p=d&&r?.[d];return p?p.filter(g=>this._isDependOnPageDataSource(g,a)).map(g=>this._getDependencyAttributeName(g,t,n)).map((g,b)=>g||`${e.name}_DependencyValue_${b}`).map((g,b)=>{const C=p[b];return this._setDependencyViewModelAttribute(g,C,t),this._getDefaultValue(g,C,a)}):[]}_getRelatedDataSourceName(e){return e.relationPath.split(".").shift()??""}_isDependOnPageDataSource(e,t){const i=this._getRelatedDataSourceName(e);return t?.[i]?.scope===h.DataSourceScope.Page}_getDefaultValue(e,t,i){const r=this._getRelatedDataSourceName(t),a=i?.[r]?.config||{},n=a.entitySchemaName?`$${e} | crt.ToLookup : '${a.entitySchemaName}'`:`$${e}`;return{attributeName:t.attributePath,value:n}}_setDependencyViewModelAttribute(e,t,i){i[e]||(i[e]={modelConfig:{path:t.relationPath}})}_getDependencyAttributeName(e,t,i){return Object.keys(t).find(r=>(t[r]?.modelConfig?.path||"").replace("#PrimaryDataSourceName()#",i)===e.relationPath)}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(yield t._isEditingModeDisabled())return e;const i=e;i.viewModelConfig=i.viewModelConfig??{};const r=i.viewModelConfig.attributes=i.viewModelConfig.attributes||{},a=i.modelConfig||{};return(0,u.getDataGridViewConfigsWithItemsBinding)(i).filter(n=>t._isItemsCreationEnabled(n)).forEach(n=>{t._bindEditingCellsInput(n,r),t._bindItemCreatingOutput(n,r,a)}),e})()}static#e=this.\u0275fac=function(t){return new(t||re)(o.\u0275\u0275inject(y.FeatureService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:re,factory:re.\u0275fac})}class ae{_bindItemDeletionOutput(e){const t=e.items.slice(1);e.deleteItem||!t||(e.deleteItem={request:"crt.DeleteRecordRequest",params:{itemsAttributeName:t,recordId:"@event.rowId"}})}crtOnMetaDataInit(e){const t=e;return t.viewModelConfig=t.viewModelConfig??{},(0,u.getDataGridViewConfigsWithItemsBinding)(t).forEach(i=>{this._bindItemDeletionOutput(i)}),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||ae)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ae,factory:ae.\u0275fac})}class ne{constructor(e){this._featureService=e,this._featureName="DisableDataGridEditingMode"}_isEditingModeDisabled(){return(0,_.firstValueFrom)(this._featureService.getFeatureState(R.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE))}_setSaveItemsChangesOutput(e){const t=e.items.slice(1);e.saveItemsChanges={request:"crt.SaveRecordsRequest",params:{itemsAttributeName:t}}}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){return(yield t._isEditingModeDisabled())||(0,u.getDataGridViewConfigsWithItemsBinding)(e).filter(i=>i.saveItemsChanges==null).forEach(i=>t._setSaveItemsChangesOutput(i)),e})()}static#e=this.\u0275fac=function(t){return new(t||ne)(o.\u0275\u0275inject(y.FeatureService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ne,factory:ne.\u0275fac})}class se{constructor(e){this._featureValues=e}_createActivateRowBusinessRulesRequest(e,t){return{request:"crt.DataGridActivateRowBusinessRulesRequest",params:{rowValueAttributeName:e,dataGridViewElementName:t.name}}}_getActiveRowAttributeName(e){let t=e.activeRow;return t==null&&(t=`$${(0,u.createDataGridActiveRowAttributeName)(e)}`),(0,A.isBindingExpression)(t)?(0,A.parseExpression)(t).attributePath:""}crtOnMetaDataInit(e){if(this._featureValues.DisableActivateGridRowOnReload)return Promise.resolve(e);const t=e;return(0,u.getDataGridViewConfigsWithItemsBinding)(e).forEach(i=>{const r=this._getActiveRowAttributeName(i);if(r){const a=(0,u.getDataGridItemsAttributeName)(i);m.MetadataSchemaUtils.addViewModelAttributeChangeRequest(t,{attributeName:a,requests:[this._createActivateRowBusinessRulesRequest(r,i)]})}}),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||se)(o.\u0275\u0275inject(m.FEATURE_VALUES))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:se,factory:se.\u0275fac})}class oe{constructor(e){this._featureService=e,this._featureName="DisableDataGridPagingPreprocessing"}_setPaginationChange(e,t){if(e.paginationChange)return;const i=e.items?.slice(1),r=t.getBoundDataSourceNameByAttributePath(i);e.paginationChange=wt(r)}_setPagingConfig(e,t){const i=e.items?.slice(1),r=(t?.viewModelConfig?.attributes)[i]??{};if(!(0,f.isModelAttributeConfig)(r))return;const a=r.modelConfig;!a||a?.pagingConfig||(a.pagingConfig=$t())}get _isFeatureDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._featureName))}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(yield t._isFeatureDisabled)return e;const i=e,r=(0,u.getDataGridViewConfigsWithItemsBinding)(e);for(const a of r)t._setPagingConfig(a,i);return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){if(yield r._isFeatureDisabled)return e;const a=(0,u.getDataGridViewConfigsWithItemsBinding)(e);for(const n of a)r._setPaginationChange(n,i);return e})()}static#e=this.\u0275fac=function(t){return new(t||oe)(o.\u0275\u0275inject(y.FeatureService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:oe,factory:oe.\u0275fac})}class ce{constructor(e){this._featureService=e,this._featureName="DisableDataGridPlaceholderPreprocessing"}_setNoConfiguredPlaceholder(e){e.skeleton==null&&(e.skeleton=[{type:"crt.Placeholder",image:{type:"icon",icon:"data-table",width:null,height:null,padding:null},title:"",subhead:""}])}_setNoItemsPlaceholders(e,t,i){const r=t.placeholder,a=t.items?.split("$")?.pop(),n=this._getSearchFilterAttributesNames(i,a),c=[...this._getFilterAttributesNames(e,a),...n];if(!r?.length||!c.length)return;r.map(p=>p.visible).map(p=>(p??"")?.split("$")?.pop()).filter(Boolean).map(p=>e[p]).filter(Boolean).forEach(p=>p.from=(0,S.uniq)([...p.from,...c]))}_getFilterAttributesNames(e,t){const r=e[t]?.modelConfig?.filterAttributes??[];return Object.values(r).filter(a=>a.loadOnChange).filter(a=>!a.name.endsWith("_PredefinedFilter")).map(a=>a.name)}_getSearchFilterAttributesNames(e,t){return e.filter(i=>i.targetAttributes?.includes(t)).map(({name:i})=>Wt(i,t))}_getSearchFilterViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.SearchFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(yield(0,_.lastValueFrom)(t._featureService.getFeatureState(t._featureName),{defaultValue:null}))return e;const r=e;r.viewModelConfig.attributes=r.viewModelConfig.attributes??{};const a=r.viewModelConfig.attributes,n=t._getSearchFilterViewConfigs(r);return(0,u.getDataGridViewConfigs)(e).forEach(s=>{(0,A.isBindToViewModelAttribute)(s.items,a)?t._setNoItemsPlaceholders(a,s,n):t._setNoConfiguredPlaceholder(s)}),e})()}static#e=this.\u0275fac=function(t){return new(t||ce)(o.\u0275\u0275inject(y.FeatureService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ce,factory:ce.\u0275fac})}class le{_bindActiveRow(e,t,i){if(t.activeRow===void 0&&(t.activeRow=`$${(0,u.createDataGridActiveRowAttributeName)(t)}`),!(0,A.isBindingExpression)(t.activeRow))return;const r=(0,A.parseExpression)(t.activeRow).attributePath;i[r]??={value:null},m.MetadataSchemaUtils.addViewModelAttributeChangeRequest(e,{attributeName:r,requests:[{request:"crt.DataGridActivateRowBusinessRulesRequest",params:{rowValueAttributeName:r,dataGridViewElementName:t.name}}]})}crtOnMetaDataInit(e){const t=e,i=t.viewModelConfig.attributes??={};return(0,u.getDataGridViewConfigs)(e).forEach(r=>this._bindActiveRow(t,r,i)),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||le)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:le,factory:le.\u0275fac})}class ue{constructor(e){this._featureService=e,this._featureName="DisableDataGridRowDoubleClickPreprocessing"}_hasSectionEditPage(e,t){return(0,l.Z)(function*(){const i={type:"crt.7XRequest",action:"HasEntityEditPage",$context:t,payload:{entityName:e}};return yield h.HandlerChainService.instance.process(i)})()}_getReferenceSchemaName(e,t){return(0,l.Z)(function*(){return(yield(0,f.getEntitySchemaAttribute)(t,e))?.referenceSchemaName})()}_getPrimaryAttributeName(e,t){const i=(0,u.getViewModelItemsAttributeName)(e),r=t.getBoundDataSourceNameByAttributePath(i),a=t.getBoundDataSchemaByAttributePath(i),{primaryAttributeName:n}=a??{};return n?`${r}_${n}`:""}_isPageExists(e,t){var i=this;return(0,l.Z)(function*(){const r=i._getPrimaryAttributeName(e,t),a=yield i._getReferenceSchemaName(r,t);return i._hasSectionEditPage(a,t)})()}_getDataGridViewConfigs(e,t){var i=this;return(0,l.Z)(function*(){const r=(0,u.getDataGridViewConfigsWithItemsBinding)(e);return(yield Promise.all(r.map(n=>i._isPageExists(n,t)))).reduce((n,s,c)=>(s&&!r[c].rowDoubleClick&&n.push(r[c]),n),[])})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){if(yield(0,_.lastValueFrom)(r._featureService.getFeatureState(r._featureName),{defaultValue:null}))return e;const n=yield r._getDataGridViewConfigs(e,i);for(const s of n)s.rowDoubleClick={request:"crt.DataGridRowDoubleClickRequest",params:{itemsAttributeName:(0,u.getViewModelItemsAttributeName)(s),rowId:"@event.rowId"}};return e})()}static#e=this.\u0275fac=function(t){return new(t||ue)(o.\u0275\u0275inject(y.FeatureService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ue,factory:ue.\u0275fac})}class de{constructor(e){this._featureService=e}_isSelectionPreprocessingDisabled(){const e=this._featureService.getFeatureState("DisableDataGridRowsSelectionPreprocessing");return(0,_.lastValueFrom)(e,{defaultValue:!1})}_bindSelectedRows(e,t){if(e.selectedRows??=`$${(0,u.createDataGridSelectedRowsAttributeName)(e)}`,!(0,A.isBindingExpression)(e.selectedRows))return;const i=(0,A.parseExpression)(e.selectedRows).attributePath;t[i]||(t[i]={value:null})}_bindSelectionState(e,t,i){if(t.selectionState??=`$${(0,u.createDataGridSelectionStateAttributeName)(t)}`,!(0,A.isBindingExpression)(t.selectionState))return;const r=(0,A.parseExpression)(t.selectionState).attributePath;if(i[r]??={value:null},!(0,A.isBindingExpression)(t.items))return;const a=(0,A.parseExpression)(t.items).attributePath;if(t.totalItemsCount??=`$${a}_TotalItemsCount`,!(0,A.isBindingExpression)(t.totalItemsCount))return;const n=(0,A.parseExpression)(t.totalItemsCount).attributePath,s=`${a}_SelectedItemsCount`;if(this._createTotalItemsCountAttribute(n,{itemsAttributeName:a,selectionStateAttributeName:r},i),this._createSelectedItemsCountAttribute(s,{itemsAttributeName:a,selectionStateAttributeName:r,totalItemsCountAttributeName:n},i),m.MetadataSchemaUtils.addViewModelAttributeChangeRequest(e,{attributeName:r,requests:[{request:"crt.DataGridCleanupCachedItemsCountLoadParametersRequest",params:{itemsAttributeName:a,selectionStateAttributeName:r}},{request:"crt.DataGridRunSelectedItemsCountAttributeCalculationRequest",params:{selectionStateAttributeName:r,selectedItemsCountAttributeName:s}}]}),!(0,A.isBindingExpression)(t.selectedRows))return;const c=(0,A.parseExpression)(t.selectedRows).attributePath;m.MetadataSchemaUtils.addViewModelAttributeChangeRequest(e,{attributeName:r,requests:[{request:"crt.DataGridSetSelectedRowsFromSelectionStateRequest",params:{selectedRowsAttributeName:c,selectionStateAttributeName:r}}]})}_createTotalItemsCountAttribute(e,t,i){const{itemsAttributeName:r,selectionStateAttributeName:a}=t,n=`${e}_Actualization`;i[e]??={from:[r,n],converter:`crt.ToCollectionItemsCount : '${r}' : '${e}'`},i[n]??={from:a,converter:"crt.IsAnySelected"}}_createSelectedItemsCountAttribute(e,t,i){const{itemsAttributeName:r,selectionStateAttributeName:a,totalItemsCountAttributeName:n}=t;i[e]??={from:[r,a,n],converter:`crt.ToCollectionSelectedItemsCount : '${r}' : '${e}'`,change:{request:"crt.DataGridSetSelectedCountToRowsSelectionStateRequest",params:{selectionStateAttributeName:a,selectedItemsCountAttributeName:e}}}}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(yield t._isSelectionPreprocessingDisabled())return e;const i=e,r=i.viewModelConfig.attributes??={};return(0,u.getDataGridViewConfigs)(e).forEach(a=>{t._bindSelectedRows(a,r),t._bindSelectionState(i,a,r)}),e})()}static#e=this.\u0275fac=function(t){return new(t||de)(o.\u0275\u0275inject(y.FeatureService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:de,factory:de.\u0275fac})}class me{constructor(e){this._exposeAttributeConverterMetadataGenerator=e}_getSelectionElementViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByFilter(t=>Boolean(t?._selectionOptions),e).map(t=>t.viewConfig)}_generateSelectionAttributes(e){const t=e._selectionOptions.attribute;if(typeof t=="string")return{[t]:{value:null}};const{from:i,expose:r}=t??{};if((0,S.isEmpty)(i)||(0,S.isEmpty)(r))return{};const a=r.attribute;if(!a)return{};const n=this._exposeAttributeConverterMetadataGenerator.generate(r);return n?{[a]:{from:i,converter:n.converterExpression},...n.converterArgsAttributes}:{[a]:{from:i}}}_setSelectionAttributes(e,t){const i=e.viewModelConfig.attributes??={};Object.entries(t).filter(([r,a])=>!!r).forEach(([r,a])=>{i[r]??=a})}crtOnMetaDataInit(e){const t=e;return this._getSelectionElementViewConfigs(t.viewConfig).map(i=>this._generateSelectionAttributes(i)).forEach(i=>{this._setSelectionAttributes(t,i)}),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||me)(o.\u0275\u0275inject(A.ExposeAttributeConverterMetadataGenerator))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:me,factory:me.\u0275fac})}class fe{static#e=this.\u0275fac=function(t){return new(t||fe)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:fe});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[A.ExposeAttributeConverterMetadataGenerator,{provide:f.CRT_METADATA_PREPROCESSOR,useClass:me,multi:!0}]})}class O{_canSetSelectionOptions(e){return(0,S.isEmpty)(e?._selectionOptions)&&(0,A.canComponentContainSelectionOptions)(e)}_setSelectionOptions(e,t){e.selectionState??=`$${(0,A.createComponentSelectionStateAttributeName)(t)}`;const i=(0,A.createComponentInitialSelectionOptions)(e);i&&(e._selectionOptions=i)}setInitialSelectionOptions(e,t){this._canSetSelectionOptions(e)&&this._setSelectionOptions(e,t)}static#e=this.\u0275fac=function(t){return new(t||O)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac})}class L{constructor(e=!1){this._isDesignTime=e,this._selectionOptionsPreprocessorService=(0,o.inject)(O)}_setInitialSelectionOptions(e){(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).forEach(t=>this._selectionOptionsPreprocessorService.setInitialSelectionOptions(t,t.name||"DataGrid"))}_setExportToExcelRequestFiltersParameter(e){(0,Bt.getRequestBindingConfigs)(e.viewConfig,"crt.ExportDataGridToExcelRequest",this._canSetExportToExcelRequestFiltersParameter).forEach(t=>{const i=t.params.viewName,r=this._getExportToExcelRequestFiltersParameter(e,i);!r||(t.params={...t.params,filters:r})})}_canSetExportToExcelRequestFiltersParameter(e){const{viewName:t,filters:i}=e?.params??{};return Boolean(t)&&i===void 0}_getExportToExcelRequestFiltersParameter(e,t){const i=m.MetadataSchemaUtils.getViewConfigInfoByName(e,t);if(!i?.viewConfig)return null;const{items:r,_selectionOptions:a}=i.viewConfig,n=(0,A.isBindingExpression)(r)&&(0,A.parseExpression)(r).attributePath,s=a?(0,A.getSelectionStateAttributeName)(a):null;return!n||!s?null:(0,A.createCollectionFiltersBindingExpression)(n,s,{supportEmptySelection:!0})}crtOnMetaDataInit(e){const t=e;return this._setInitialSelectionOptions(t),this._isDesignTime||this._setExportToExcelRequestFiltersParameter(t),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||L)(o.\u0275\u0275inject(m.IS_DESIGN_TIME,8))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac})}class pe{static#e=this.\u0275fac=function(t){return new(t||pe)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:pe});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:f.CRT_METADATA_PREPROCESSOR,useClass:L,multi:!0},{provide:f.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useClass:L,multi:!0}]})}class Ke{_isSelectionStateAttributeBound(e,t,i){const r=(0,S.cloneDeep)(i),n=m.MetadataSchemaUtils.getViewConfigInfoByName(r,e).viewConfig;return delete n._selectionOptions,delete n.selectionState,m.MetadataSchemaUtils.isViewModelAttributeBound(r,t)}_cleanupDefaultSelectionOptionsMetadata(e,t){const i=e._selectionOptions;if(!i)return this._cleanupDefaultSelectionState(e,t);const r=(0,S.cloneDeep)(e),a=`$${(0,u.createDataGridSelectionStateAttributeName)(e)}`;r.selectionState??=a;const n=(0,A.createComponentInitialSelectionOptions)(r);if(!(0,S.isEqual)(i,n))return;const s=(0,A.getSelectionStateAttributeName)(i);e.name&&this._isSelectionStateAttributeBound(e.name,s,t)||(delete e._selectionOptions,this._cleanupDefaultSelectionState(e,t))}_cleanupDefaultSelectionState(e,t){const i=e.selectionState,r=`$${(0,u.createDataGridSelectionStateAttributeName)(e)}`;if(!(0,S.isEqual)(i,r))return;const a=(0,A.parseExpression)(i).attributePath;e.name&&this._isSelectionStateAttributeBound(e.name,a,t)||delete e.selectionState}crtOnMetaDataChanged(e){return(0,u.getDataGridViewConfigs)(e,["crt.DataGrid"]).forEach(t=>this._cleanupDefaultSelectionOptionsMetadata(t,e)),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||Ke)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ke,factory:Ke.\u0275fac})}class Ot{static#e=this.\u0275fac=function(t){return new(t||Ot)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:Ot});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:f.CRT_METADATA_POSTPROCESSOR,useClass:Ke,multi:!0}]})}class ge{constructor(e,t,i){this._featureService=e,this._dcmSchemaManagerService=t,this._entitySchemaRepository=i,this._dcmDataAttributePostfix="_DCMData",this._dcmSchemas=[],this._dataGridToDataSourceMap=[],this._dataSourceSchemas=[]}_getDataGridToDataSourceMap(e,t){return e.map(i=>{const r=i.primaryColumnName?.split("_");r?.pop();const a=r?.join("_")||"",n=t[a];return{dataGridName:i.name,dataSource:n,dataSourceName:a}}).filter(({dataSource:i})=>i!=null)}_getEntitySchemaFromDataSourceSchemas(e){return this._dataSourceSchemas.find(t=>t.name===e?.config?.entitySchemaName)}_getFilterColumnPath(e){const t=e.find(r=>r.filters&&r.isActive&&r.isActiveVersion)?.filters;let i="";if(t){const r=JSON.parse(t);i=`${Object.values(r.items)[0].leftExpression.columnPath}`}return i}_fillDataGridModelConfig(e,t,i,r){var a=this;return(0,l.Z)(function*(){const n=a._dcmSchemas.filter(C=>C.entitySchemaUId===e);if(!n?.length)return;const s=a._getFilterColumnPath(n),c=a._dcmSchemaManagerService.getDcmSchemaDataItems(e),d=yield(0,_.firstValueFrom)(c),p=`${t.name}${a._dcmDataAttributePostfix}`;r[p]={value:{schemas:n,schemasData:d,filterColumnAttributePath:`${i?.dataSourceName}_${s}`}};const g=t.items.substring(1),b=r[g].viewModelConfig;s&&g&&!b.attributes[s]&&(b.attributes[`${i?.dataSourceName}_${s}`]={modelConfig:{path:`${i?.dataSourceName}.${s}`}})})()}_initDataGridViewConfigAttributes(e,t){var i=this;return(0,l.Z)(function*(){const r=i._dataGridToDataSourceMap.find(n=>n.dataGridName===e.name);if(!r)return;const a=i._getEntitySchemaFromDataSourceSchemas(r.dataSource);!a||(yield i._fillDataGridModelConfig(a?.uId,e,r,t))})()}_getDataSourceSchemas(){var e=this;return(0,l.Z)(function*(){const t=e._dataGridToDataSourceMap.map(i=>({name:i?.dataSource?.config?.entitySchemaName,loadLookupColumns:!0}));return yield(0,_.firstValueFrom)(e._entitySchemaRepository.getSchemes(t))})()}get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState("DisableDataGridProgressBarStageCell"))}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(yield t.isProcessingDisabled)return e;const i=(0,u.getDataGridViewConfigs)(e);if(!i?.length)return e;const r=e.modelConfig.dataSources||{};t._dcmSchemas=yield(0,_.firstValueFrom)(t._dcmSchemaManagerService.getDcmSchemaDataCollection()),t._dataGridToDataSourceMap=t._getDataGridToDataSourceMap(i,r),t._dataSourceSchemas=yield t._getDataSourceSchemas();const a=e,n=a.viewModelConfig.attributes=a.viewModelConfig.attributes||{};for(const s of i)yield t._initDataGridViewConfigAttributes(s,n);return e})()}static#e=this.\u0275fac=function(t){return new(t||ge)(o.\u0275\u0275inject(y.FeatureService),o.\u0275\u0275inject(y.DcmSchemaManagerService),o.\u0275\u0275inject(m.EntitySchemaRepository))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ge,factory:ge.\u0275fac})}class he{constructor(e,t){this._featureValues=e,this._licenseOperationValues=t}crtOnMetaDataInit(e){const t=this._licenseOperationValues[u.CAN_MANAGE_LIST_COLUMNS_LICENSE_OPERATION_CODE];if(this._featureValues.DisableDataGridRestrictionsPreprocessing||t)return Promise.resolve(e);const i={columns:{editing:!1,adding:!1}};return(0,u.getDataGridViewConfigs)(e).filter(r=>typeof r.features!="string").forEach(r=>{r.features??={},(0,S.merge)(r.features,i)}),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||he)(o.\u0275\u0275inject(m.FEATURE_VALUES),o.\u0275\u0275inject(y.LICENSE_RESTRICTION_OPERATION_VALUES))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:he,factory:he.\u0275fac})}const Jt=new o.InjectionToken("Represents a handler to process data grid metadata on metadata init");class Yt{getViewConfigsByType(e,t){return(m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",[e],t.viewConfig)||[]).map(i=>i?.viewConfig).filter(Boolean)}processElementsOnMetadataInit(e,t,i){var r=this;return(0,l.Z)(function*(){const a=r.getViewConfigsByType(e,i);yield Promise.all(a.map(n=>t?.handle({metadata:i,viewConfig:n})))})()}processElementsOnModelInit(e,t,i,r){var a=this;return(0,l.Z)(function*(){const n=a.getViewConfigsByType(e,i);yield Promise.all(n.map(s=>t?.handle({metadata:i,viewConfig:s,models:r})))})()}}class et extends Yt{constructor(e){super(),this._dataGridOnMetadataInitHandler=e}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){const i=e;if(t._dataGridOnMetadataInitHandler)for(const r of u.GRID_VIEW_ELEMENT_TYPES)yield t.processElementsOnMetadataInit(r,t._dataGridOnMetadataInitHandler,i);return Promise.resolve(e)})()}static#e=this.\u0275fac=function(t){return new(t||et)(o.\u0275\u0275inject(Jt,8))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:et,factory:et.\u0275fac})}var di=v(29989),Qt=v.n(di);class _e{constructor(e,t){this._userInfo=e,this._entityDataSourceAttributeConfigConverterFactory=t}_applyResources(e,t){(0,S.isEmpty)(e?.localizableStrings)||(t.resources??={strings:{}},t.resources.strings??={},(0,S.merge)(t.resources.strings,e?.localizableStrings),this._fullResourcesForCurrentCulture(t.resources.strings))}_fullResourcesForCurrentCulture(e){const t=this._userInfo.cultureInfo.sysCultureName;Object.values(e).filter(i=>!(t in i)).forEach(i=>{const r=Object.values(i).find(Boolean);r&&(i[t]=r)})}_applyDataGridColumns(e,t,i){if(!t)return;const r=(0,u.getDataGridItemsAttributeConfig)(e,i);if(!r)return;const a=r.modelConfig?.path;if(!a)return;const n=(0,u.getDataGridItemsDataSourceConfig)(a,i);if(!n)return;const s=e.columns=[],c=r.viewModelConfig.attributes??={},d=n.attributes??={};t.forEach(({viewMetadata:p,viewModelMetadata:g,modelMetadata:b})=>{if(p&&s.push(p),!b)return;const C=this._createEntityDataSourceAttribute(b),I=g?.attributeName||p?.code;if(!I||!C)return;const E={modelConfig:{path:`${a}.${C.name}`}},Nt=c[I]??{},xt=d[C.name]??{};c[I]=Qt()(E,Nt),d[C.name]=Qt()(C.config,xt)})}_createEntityDataSourceAttribute(e){const t=e.name,i=this._entityDataSourceAttributeConfigConverterFactory.create(e?.type).toEntityDataSourceAttribute(e);return!t||!i?null:{name:t,config:i}}_applyDataGridSortingConfig(e,t,i){if(!t)return;const r=(0,u.getDataGridItemsAttributeConfig)(e,i);if(!r)return;const a=r.modelConfig?.sortingConfig;a&&delete a.default;const n=a?.attributeName??(0,u.createDataGridSortingAttributeName)(e),s=i.viewModelConfig.attributes,c=s[n]??={};(0,f.isCalculatedAttributeConfig)(c)||(c.value=(0,u.toSortColumnsOptions)(t,r))}apply(e,t,i){const{resources:r,columns:a,sorting:n}=t;this._applyResources(r,i),this._applyDataGridColumns(e,a,i),this._applyDataGridSortingConfig(e,n,i)}static#e=this.\u0275fac=function(t){return new(t||_e)(o.\u0275\u0275inject(m.UserInfo),o.\u0275\u0275inject(m.ENTITY_DATA_SOURCE_ATTRIBUTE_CONFIG_CONVERTER_FACTORY))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:_e,factory:_e.\u0275fac,providedIn:"root"})}class Se extends D.AbstractHandler{constructor(e,t,i,r,a){super(),this._dataGridDesignSettingsApplier=e,this._dataGridFolderTreeRelationsProvider=t,this._folderTreeRelatedElementConfigsProvider=i,this._folderTreeIdResolver=r,this._featureValues=a}_setDataGridActiveFolderSettingsAttribute(e,t,i){const r=i.viewModelConfig.attributes,a=(0,u.createDataGridActiveFolderSettingsAttributeName)(e);r[a]={value:t}}handle(e){var t=()=>super.handle,i=this;return(0,l.Z)(function*(){if(i._featureValues.DisableDataGridSettingsByFolders)return t().call(i,e);const{metadata:r,viewConfig:a}=e??{};if(!r?.name||!a?.name)return t().call(i,e);const n=i._dataGridFolderTreeRelationsProvider.getSingleRelatedFolderTreeViewConfig(a,r);if(!n)return t().call(i,e);const s=yield i._folderTreeIdResolver.getActiveFolderFolderTreeId(n,r);if(!s)return i._setDataGridActiveFolderSettingsAttribute(a,null,r),t().call(i,e);const c={folderId:s,schemaName:r.name,elementName:a.name},d=yield(0,_.firstValueFrom)(i._folderTreeRelatedElementConfigsProvider.get(c));return d&&i._dataGridDesignSettingsApplier.apply(a,(0,S.cloneDeep)(d),r),i._setDataGridActiveFolderSettingsAttribute(a,d,r),t().call(i,e)})()}static#e=this.\u0275fac=function(t){return new(t||Se)(o.\u0275\u0275inject(_e),o.\u0275\u0275inject(u.DataGridFolderTreeRelationsProvider),o.\u0275\u0275inject(y.FolderTreeRelatedElementConfigsProvider),o.\u0275\u0275inject(u.FolderTreeIdResolver),o.\u0275\u0275inject(m.FEATURE_VALUES))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Se,factory:Se.\u0275fac})}class Ae extends D.AbstractHandler{constructor(e){super(),this._dataGridDesignSettingsApplier=e}handle(e){const{metadata:t,viewConfig:i}=e??{};if(!t?.name||!i?.name)return super.handle(e);const r=i._designOptions?.designSettings;return r&&this._dataGridDesignSettingsApplier.apply(i,(0,S.cloneDeep)(r),t),super.handle(e)}static#e=this.\u0275fac=function(t){return new(t||Ae)(o.\u0275\u0275inject(_e))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ae,factory:Ae.\u0275fac})}const mi="DisableDataGridSortingPreprocessing";class be extends D.AbstractHandler{constructor(e){super(),this._isSortingPreprocessingDisabled=Boolean(e[mi])}_getSortingAttributeName(e,t){const i=(0,u.getDataGridItemsAttributeName)(e);if(!i)return null;const r=t.viewModelConfig?.attributes?.[i];if(!r||!("modelConfig"in r))return null;let a=r.modelConfig?.sortingConfig?.attributeName;if(a)return a;a=(0,u.createDataGridSortingAttributeName)(e);const n={modelConfig:{sortingConfig:{attributeName:a}}};return(0,S.merge)(r,n),a}_setSorting(e,t,i){if(t.sorting)return;i.viewModelConfig.attributes||={},i.viewModelConfig.attributes[e]||={};const r=(0,u.getDataGridItemsAttributeName)(t);t.sorting=`$${e} | crt.ToDataTableSortingConfig: '${r}'`}_setSortingChange(e){e.sortingChange||(e.sortingChange={request:"crt.DataGridSortDataRequest",params:{itemsAttributeName:(0,u.getDataGridItemsAttributeName)(e),sorting:"@event"}})}handle(e){const{metadata:t,viewConfig:i}=e??{};if(!t||!i||this._isSortingPreprocessingDisabled)return super.handle(e);const r=this._getSortingAttributeName(i,t);return r?(this._setSorting(r,i,t),this._setSortingChange(i),super.handle(e)):super.handle(e)}static#e=this.\u0275fac=function(t){return new(t||be)(o.\u0275\u0275inject(m.FEATURE_VALUES,8))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:be,factory:be.\u0275fac})}class Ce{static#e=this.\u0275fac=function(t){return new(t||Ce)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:Ce});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:f.CRT_METADATA_PREPROCESSOR,useClass:et,multi:!0},{provide:Jt,useFactory:e=>{const t=e.get(Ae);return t.setNext(e.get(Se)).setNext(e.get(be)),t},deps:[o.Injector]},Ae,Se,be]})}class tt{crtOnMetaDataInit(e){return(0,l.Z)(function*(){const t=e;return t.name==="Playbooks_FormPage"&&(t.viewModelConfig.attributes.DcmStages={from:"CrtPlaybookDS_DcmCase",converter:"crt.ToDcmStageValue"}),Promise.resolve(e)})()}static#e=this.\u0275fac=function(t){return new(t||tt)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:tt,factory:tt.\u0275fac})}class fi{_getDetailViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Angular7XDetail",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_processDetail(e){this._processDetailOutputs(e)}_processDetailOutputs(e){this._processDetailChangedOutput(e)}_processDetailChangedOutput(e){e.detailChanged||(e.detailChanged={request:"crt.DetailChangedRequest",params:{detailId:"@event.detail.detailId",saveChanges:"@event.detail.saveChanges",discardChanges:"@event.detail.discardChanges",destroyed:"@event.detail.destroyed"}})}_processSchema(e){this._processViewModelAttributes(e),this._changeViewConfigsBindings(e)}_processViewModelAttributes(e){this._processUnSaveDetailsDataViewModelAttributes(e),this._processHasUnsavedDataAndDetailsViewModelAttributes(e)}_processUnSaveDetailsDataViewModelAttributes(e){const t=this._getSchemaViewModelAttributes(e);t[f.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]||(t[f.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME]={value:[]})}_processHasUnsavedDataAndDetailsViewModelAttributes(e){const t=this._getSchemaViewModelAttributes(e);t[f.HAS_UNSAVED_DATA_AND_DETAILS_ATTRIBUTE_NAME]||(t[f.HAS_UNSAVED_DATA_AND_DETAILS_ATTRIBUTE_NAME]={from:[f.HAS_UNSAVED_DATA_SYSTEM_ATTRIBUTE_NAME,f.UNSAVED_DETAILS_DATA_ATTRIBUTE_NAME],converter:"crt.HasUnsavedDataOr7XDetails"})}_getSchemaViewModelAttributes(e){const t=e.viewModelConfig=e.viewModelConfig||{};return t.attributes=t.attributes||{}}_changeViewConfigsBindings(e){const t=e.viewConfig||[],i=`(^|\\W)(${f.HAS_UNSAVED_DATA_SYSTEM_ATTRIBUTE_NAME})($|\\W)`,r=`$1${f.HAS_UNSAVED_DATA_AND_DETAILS_ATTRIBUTE_NAME}$3`;t.forEach(a=>this._replaceStringsRecursive(a,i,r))}_replaceStringsRecursive(e,t,i){(0,S.forOwn)(e,(r,a)=>{if((0,S.isObject)(r))this._replaceStringsRecursive(r,t,i);else if((0,S.isString)(r)){const n=new RegExp(t,"g");if(!r.match(n))return;e[a]=r.replace(n,i)}})}crtOnMetaDataInit(e){const t=e,i=this._getDetailViewConfigs(t);return i.forEach(r=>this._processDetail(r)),i.length&&this._processSchema(t),Promise.resolve(e)}}class it{_modifyInputType(e,t,i){const r=e.control.replace("$",""),a=t.attributes[r]?.modelConfig?.path;if(a){const n=this._getDataSchemaAttributeByPath(a,i);h.DataValueType.EMAIL_TEXT&&n?.dataValueType===h.DataValueType.EMAIL_TEXT&&(e.type="crt.EmailInput",e.isFormatValidated=n.isFormatValidated)}}_getDataSchemaAttributeByPath(e,t){const[i,r]=e.split("."),a=t.dataSchemas[i]?.attributes;let n;for(const s in a)if(a[s].path===r){n=a[s];break}return n}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){const a=e,n=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),s=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.EmailInput",a.viewConfig);return n.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),s.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),e})()}static#e=this.\u0275fac=function(t){return new(t||it)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:it,factory:it.\u0275fac})}class rt{get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState("DisableEntityStageProgressBarPreprocessing"))}constructor(e,t,i,r){this._featureService=e,this._dcmSettingsService=t,this._dcmSchemaManagerService=i,this._configurationDataService=r,this._componentName="crt.EntityStageProgressBar",this._stagesAttributeSuffix="_StagesList",this._stageConnectionsAttributeSuffix="_StageConnections",this._allowedStagesAttributeSuffix="_AllowedStages",this._valueAttributeSuffix="_CurrentStage",this._stageFilteredByAttributeSuffix="_StageFilteredBy",this._stageRunningProcessUIdAttributeSuffix="_RunningProcessUId",this._entityStageSchemasAttributeSuffix="_EntityStageSchemas",this._isAppropriateEntityStageSchemaAttributeSuffix="_IsAppropriateEntityStageSchema",this._filteredByValueAttributeName="",this._primaryDataSourceName=""}_getComponents(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig)}_getComponentName(e){return e.name.replace(/\./g,"_")}_getStageColumnName(e){return(0,_.lastValueFrom)(this._dcmSettingsService.getStageColumnName(e),{defaultValue:null})}_getEntityStagesSchemas(e){return(0,_.lastValueFrom)(this._dcmSchemaManagerService.getDcmSchemaDataCollection().pipe((0,P.map)(t=>t.filter(i=>i.entitySchemaUId===e))))}_getEntitySchemaUid(e){return(0,_.lastValueFrom)(this._configurationDataService.getEntityUId(e).pipe((0,P.map)(t=>t?.data?.entityUIds?.filter(i=>i.entitySchemaName===e)[0].entitySchemaUId)))}_findAttributeKeyByPath(e,t){let i=null;return Object.keys(e).forEach(r=>{e[r]?.modelConfig?.path===t&&(i=r)}),i}_generateAttributes(e){return{listAttributeName:`${e}${this._stagesAttributeSuffix}`,stageConnectionsAttributeName:`${e}${this._stageConnectionsAttributeSuffix}`,allowedStagesAttributeName:`${e}${this._allowedStagesAttributeSuffix}`,stageRunningProcessUIdAttributeName:`${e}${this._stageRunningProcessUIdAttributeSuffix}`,entityStageSchemasAttribute:`${e}${this._entityStageSchemasAttributeSuffix}`,isAppropriateEntityStageSchemaAttribute:`${e}${this._isAppropriateEntityStageSchemaAttributeSuffix}`,currentStageAttributeName:""}}_loadEntityStageSchemas(e,t,i){var r=this;return(0,l.Z)(function*(){const a=yield r._getEntitySchemaUid(t),n=(yield r._getEntityStagesSchemas(a)).filter(s=>s.isActive&&s.isActiveVersion);if(n){e[`${i}${r._entityStageSchemasAttributeSuffix}`]={value:n};const s=n.find(C=>C.filters)?.filters;if(!s)return;const c=JSON.parse(s),p=Object.values(c.items)[0].leftExpression.columnPath,g=`${r._primaryDataSourceName}.${p}`,b=r._findAttributeKeyByPath(e,g);b&&(r._filteredByValueAttributeName=b),r._filteredByValueAttributeName||(r._filteredByValueAttributeName=`${i}${r._stageFilteredByAttributeSuffix}`,e[r._filteredByValueAttributeName]={modelConfig:{path:g}})}})()}_loadEntityAttributes(e,t){var i=this;return(0,l.Z)(function*(){const r=`ProgressBarComponent_${t}`,a=i._generateAttributes(r);let n=e.viewModelConfig.attributes;n||(n=e.viewModelConfig.attributes={}),n[a.entityStageSchemasAttribute]={value:null},yield i._loadEntityStageSchemas(n,t,r),a.filterValueAttributeName=i._filteredByValueAttributeName||"";const s=yield i._getStageColumnName(t);return s&&(a.currentStageAttributeName=i.setupColumnAttribute(s,n,r,i._valueAttributeSuffix)),a.idAttributeName=i.setupColumnAttribute("Id",n,r,"_RecordId"),n[a.listAttributeName]={value:null},n[a.stageConnectionsAttributeName]={value:null},n[a.allowedStagesAttributeName]={value:null},n[a.stageRunningProcessUIdAttributeName]={value:null},n[a.isAppropriateEntityStageSchemaAttribute]={value:!0},a})()}setupColumnAttribute(e,t,i,r){const a=`${this._primaryDataSourceName}.${e}`;let n=this._findAttributeKeyByPath(t,a);return n||(n=`${i}${r}`,t[n]={modelConfig:{path:a}}),n}_setupComponentConfig(e,t){this._setupComponentFields(e,t),this._setupComponentHandlers(e,t)}_setupComponentFields(e,t){const i=e?.viewConfig;i.recordId=`$${t.idAttributeName}`,i.stages=`$${t.listAttributeName}`,i.stageConnections=`$${t.stageConnectionsAttributeName}`,i.allowedStages=`$${t.allowedStagesAttributeName}`,i.stageSchemaFilterByValue=`$${t.filterValueAttributeName}`,i.value=`$${t.currentStageAttributeName}`,i.isAppropriateEntityStageSchema=`$${t.isAppropriateEntityStageSchemaAttribute}`,i.stageRunningProcessUId=`$${t.stageRunningProcessUIdAttributeName}`}_setupComponentHandlers(e,t){const i=e?.viewConfig;i.stageChanged={request:"crt.EntityStageProgressBarStageChangedHandlerRequest",params:{stageAttribute:t.currentStageAttributeName,stagesAttribute:t.listAttributeName,config:"@event"}},i.setAllowedStages={request:"crt.EntityStageProgressBarProcessStagePermissionsHandlerRequest",params:{stagesAttribute:t.listAttributeName,config:"@event"}},i.loadData={request:"crt.EntityStageProgressBarLoadDataHandlerRequest",params:{stagesAttribute:t.listAttributeName,stageConnectionsAttribute:t.stageConnectionsAttributeName,allowedStagesAttribute:t.allowedStagesAttributeName,stageRunningProcessUIdAttribute:t.stageRunningProcessUIdAttributeName,stageSchemaFilterByValueName:t.filterValueAttributeName,currentStageAttribute:t.currentStageAttributeName,config:"@event"}},i.checkIsAnAppropriateProcessSchema={request:"crt.EntityStageProcessAppropriateCheckHandlerRequest",params:{entityStageSchemas:`$${t.entityStageSchemasAttribute}`,stageRunningProcessUId:`$${t.stageRunningProcessUIdAttributeName}`,filterColumnAttributeName:t.filterValueAttributeName,isAppropriateEntityStageSchemaAttribute:t.isAppropriateEntityStageSchemaAttribute,config:"@event"}},i.changeToAppropriateEntityStageSchema={request:"crt.EntityStageProgressBarChangeStageProcessHandlerRequest",params:{entityName:e?.viewConfig.entityName,entityId:`$${t.idAttributeName}`,currentStage:`$${t.currentStageAttributeName}`,stageRunningProcessUIdAttribute:t.stageRunningProcessUIdAttributeName,isAppropriateEntityStageSchemaAttribute:t.isAppropriateEntityStageSchemaAttribute,loadDataRequest:i.loadData}}}crtOnModelInit(e,t){var i=this;return(0,l.Z)(function*(){if(yield i.isProcessingDisabled)return e;const r=e;i._primaryDataSourceName=(0,A.resolveSchemaPrimaryDataSource)(r);const a=i._getComponents(r),n=a.map(s=>s.viewConfig.entityName).filter((s,c,d)=>d.indexOf(s)===c);for(const s of n){i._filteredByValueAttributeName="";const c=yield i._loadEntityAttributes(r,s);for(const d of a.filter(p=>p.viewConfig.entityName===s))i._setupComponentConfig(d,c)}return e})()}static#e=this.\u0275fac=function(t){return new(t||rt)(o.\u0275\u0275inject(y.FeatureService),o.\u0275\u0275inject(y.DcmSettingsService),o.\u0275\u0275inject(y.DcmSchemaManagerService),o.\u0275\u0275inject(y.ConfigurationDataService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:rt,factory:rt.\u0275fac})}var x=v(96923);const pi=32,gi=81;class ye{_getDataGridViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.DataGrid",e?.items)}_setDataGridMaxHeight(e){if(!e.layoutConfig?.rowSpan||e?.styles?.["max-height"]!=null)return;const i=e.layoutConfig.rowSpan*pi,r=Math.max(i,gi);e.layoutConfig.rowSpan=1,e.styles=(0,S.merge)(e.styles,{["max-height"]:`${r}px`})}_replaceLegacyGridContainerRowsConfig(e){const t=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.GridContainer",e).shift();t?.viewConfig?.rows?.replace(/\s/g,"")==="minmax(32px,32px)"&&(t.viewConfig.rows="minmax(max-content, 32px)")}setDataGridMaxHeight(e){const t=this._getDataGridViewConfigs(e);t.forEach(i=>{this._setDataGridMaxHeight(i.viewConfig)}),t.length&&this._replaceLegacyGridContainerRowsConfig(e?.items)}static#e=this.\u0275fac=function(t){return new(t||ye)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ye,factory:ye.\u0275fac})}class at{constructor(e,t,i){this._featureService=e,this._expandedListLayoutService=t,this._profileAttributeService=i,this._expPanelActionsProcessingDisableFeature="DisableExpansionPanelPreprocessing"}_filterItemsByGridType(e){if(!e.items||e.items.length===0)return;const t=e?.tools??[],i=e.items.filter(r=>r.gridContainerType===u.ExpansionPanelGridContainerType.TOOLS);t?.length===0&&i?.length>0&&(e.items=e.items.filter(r=>r.gridContainerType!==u.ExpansionPanelGridContainerType.TOOLS),e.tools=i)}_processPaddings(e){e.padding||(e.padding={top:x.SizeEnum.Small,bottom:x.SizeEnum.Small,left:x.SizeEnum.Medium,right:x.SizeEnum.Medium})}get _isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._expPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(yield t._isProcessingDisabled)return e;const i=e;return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ExpansionPanel",i.viewConfig).forEach(function(){var a=(0,l.Z)(function*(n){t._expandedListLayoutService.setDataGridMaxHeight(n.viewConfig),t._filterItemsByGridType(n.viewConfig),t._processPaddings(n.viewConfig),yield t._profileAttributeService.prepareAttributeWithFeatureCheck(i,n.viewConfig,"expanded","","DisableSaveToProfileExpPanelExpanded")});return function(n){return a.apply(this,arguments)}}()),e})()}static#e=this.\u0275fac=function(t){return new(t||at)(o.\u0275\u0275inject(y.FeatureService),o.\u0275\u0275inject(ye),o.\u0275\u0275inject(u.ProfileAttributeService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:at,factory:at.\u0275fac})}class nt{_getFeedViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Feed",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_fixFeedByRecordBindings(e,t){t.feedType!==u.FeedSourceType.Record||this._validateRecordFeedConfig(e,t)||!(0,A.resolveSchemaPrimaryDataSource)(e)||(t.primaryColumnValue=`$${this._getOrAddRecordIdAttribute(e,t)}`,t.entitySchemaName=this._getEntitySchemaName(e))}_validateRecordFeedConfig(e,t){const i=e.viewModelConfig.attributes,r=t.primaryColumnValue?.split("$")[1],a=i[r];return!(0,S.isEmpty)(t.entitySchemaName)&&!!a}_getOrAddRecordIdAttribute(e,t){return this._findRecordIdAttribute(e,t)||this._createRecordIdAttribute(e,t)}_findRecordIdAttribute(e,t){const r=`${(0,A.resolveSchemaPrimaryDataSource)(e)}.Id`,a="#PrimaryDataSourceName()#.Id",n=e.viewModelConfig.attributes,s=Object.keys(n).find(d=>{const g=(n[d]??{}).modelConfig?.path;return g===r||g===a});if(!(0,S.isEmpty)(s))return s;const c=`${t.name}_RecordId`;return c in n?c:void 0}_createRecordIdAttribute(e,t){const i=(0,A.resolveSchemaPrimaryDataSource)(e),r=e.viewModelConfig.attributes,a=`${t.name}_RecordId`;return r[a]={modelConfig:{path:`${i}.Id`}},a}_getEntitySchemaName(e){const t=(0,A.resolveSchemaPrimaryDataSource)(e);return(e.modelConfig?.dataSources||{})[t]?.config?.entitySchemaName}_addMessagesBindings(e,t){if(t.feedMessages)return;const i=e.viewModelConfig.attributes,r=`${t.name}_FeedMessagesPage`,a=this._createEmptyAttribute("OffsetDate",i,t),n=this._createEmptyAttribute("SortColumn",i,t);t.feedMessages=`$${this._createEmptyAttribute("FeedMessages",i,t)}`,t.offsetDate=`$${a}`,t.sortColumn=`$${n}`,t.feedMessagesPage=`$${r}`;const s=[a];t.feedType===u.FeedSourceType.Record&&s.push(t.primaryColumnValue.replace("$","")),i[r]={from:s,converter:`crt.LoadFeedMessages: '${t.feedType}' : '${t.entitySchemaName}' : '${n}'`}}_createEmptyAttribute(e,t,i){const r=`${i.name}_${e}`;return t[r]={value:null},r}crtOnMetaDataInit(e){const t=e;return this._getFeedViewConfigs(t).forEach(r=>{this._fixFeedByRecordBindings(t,r),this._addMessagesBindings(t,r)}),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||nt)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:nt,factory:nt.\u0275fac})}class st{get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._fileInputPreprocessingDisableFeature))}constructor(e){this._featureService=e,this._fileInputPreprocessingDisableFeature="DisableFileInputPreprocessing"}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(yield t.isProcessingDisabled)return e;const i=e;return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FileInput",i.viewConfig).forEach(a=>{if(!a.viewConfig.upload){const s=a.viewConfig.control.slice(1);a.viewConfig.upload={request:"crt.UploadDataAttributeFileRequest",params:{fileAttributeName:s,detail:"@event.detail"}}}a.viewConfig.download||(a.viewConfig.download={request:"crt.DownloadEntityFileRequest",params:{detail:"@event.detail"}})}),e})()}static#e=this.\u0275fac=function(t){return new(t||st)(o.\u0275\u0275inject(y.FeatureService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:st,factory:st.\u0275fac})}class ot extends Mt{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.FileList"]}setRowToolbarMenuItems(e,t){const i=e.items.slice(1),r=t.getBoundDataSourceNameByAttributePath(i);return e.rowToolbarItems=[{type:"crt.MenuItem",caption:this._translateService.instant("DataGrid.RowToolbar.Delete"),icon:"delete-row-action",clicked:{request:"crt.DeleteRecordRequest",params:{itemsAttributeName:i,recordId:`$${i}.${r}_Id`},useRelativeContext:!1}}],Promise.resolve(void 0)}static#e=this.\u0275fac=function(t){return new(t||ot)(o.\u0275\u0275inject(M.TranslateService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ot,factory:ot.\u0275fac})}class ct extends G{constructor(e,t,i,r){super(e,t,i),this.featureService=e,this.metadataModifierService=t,this.dataGridColumnDefinitionService=i,this._cellViewConfigCreatorFactory=r,this._predefinedColumns={},this.viewItemTypes=["crt.FileList"]}_setPredefinedColumnDefinitions(e){for(const t of e){const i=t.viewConfig,r=i.name,a=i.columns,n=[];for(const s of a)s.cellView&&n.push(s.code);this._predefinedColumns[r]=n}}_processFileListColumnDefinitions(e,t,i){var r=this;return(0,l.Z)(function*(){const{dataSourceName:a,dataSchema:n,itemsAttributeName:s,viewModel:c}=t,{primaryAttributeName:d,primaryDisplayAttributeName:p}=n??{},g=n.name,b=d&&`${a}_${d}`;for(const C of i){const I=n.attributes.find(ir=>(0,m.removeSpecialSymbols)(`${a}_${ir.name}`)===C.code);if(!I)continue;const E=I.name,Nt={columnName:E,dataValueType:I.dataValueType,primaryDisplayAttributeName:p},xt={column:C,context:c,itemsAttributeName:s,primaryAttributeName:b,dataSchemaName:g,columnName:E},ai=yield r._cellViewConfigCreatorFactory.create(Nt)?.getViewElementConfig(xt);ai&&!r._predefinedColumns[e]?.includes(C.code)&&r.metadataModifierService.addProperty(C,"cellView",ai)}})()}crtOnViewModelInit(e,t,i){var r=()=>super.crtOnViewModelInit,a=this;return(0,l.Z)(function*(){if(yield(0,_.lastValueFrom)(a.featureService.getFeatureState(a.featureName),{defaultValue:null}))return e;const s=m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",a.viewItemTypes,e.viewConfig);a._setPredefinedColumnDefinitions(s),e=yield r().call(a,e,t,i);for(const c of s){const d=c.viewConfig.columns,p=c.viewConfig.name,g=yield a.getGenerateCellViewConfig(c.viewConfig,i);g&&(yield a._processFileListColumnDefinitions(p,g,d))}return e})()}static#e=this.\u0275fac=function(t){return new(t||ct)(o.\u0275\u0275inject(y.FeatureService),o.\u0275\u0275inject(f.MetadataModifierService),o.\u0275\u0275inject(R.DataGridColumnDefinitionService),o.\u0275\u0275inject(R.FILE_LIST_CELL_VIEW_CONFIG_CREATOR_FACTORY))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ct,factory:ct.\u0275fac})}class j{get order(){return this.index||0}constructor(e){this.featureService=e,this.componentTypes=[]}getComponentsToProcess(e){return m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this.componentTypes,e.viewConfig)}process(e,t){var i=this;return(0,l.Z)(function*(){const r=i.getComponentsToProcess(e);return yield i.innerProcess(r,e,t)})()}static#e=this.\u0275fac=function(t){return new(t||j)(o.\u0275\u0275inject(y.FeatureService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac})}class Ie extends j{constructor(){super(...arguments),this.componentTypes=["crt.FileList"],this.index=2,this.defaultFilesEntitySchemaName="SysFile",this._galleryColumnNames=["Name","CreatedOn","Size"]}_addDataSourceAttributes(e,t){let i=e[t];i||(i=F.createDataSourceConfig(this.defaultFilesEntitySchemaName),e[t]=i);const r=i.config||{attributes:{}};r.attributes=r.attributes||{},this._galleryColumnNames.forEach(a=>{r?.attributes[a]||(r.attributes[a]={path:a})}),i.config=r}_addViewModelAttributes(e,t,i){if(!e?.attributes)return;const a=e.attributes[t]?.viewModelConfig?.attributes;!a||this._galleryColumnNames.forEach(n=>{const s=`${i}_${n}`;a[s]||(a[s]={modelConfig:{path:`${i}.${n}`}})})}_applyGalleryConfig(e,t){t.viewConfig.galleryItemConfig||(t.viewConfig.galleryItemConfig={templateValuesMapping:{fileId:`${e}_Id`,fileName:`${e}_Name`,fileCreatedOn:`${e}_CreatedOn`,fileSize:`${e}_Size`}}),t.viewConfig.galleryItemConfig.defaultSize=t.viewConfig.tileSize||x.SizeEnum.Medium}_getAttributeDSName(e){return`${e}${f.DATA_SOURCE_PREFIX}`}innerProcess(e,t,i){var r=this;return(0,l.Z)(function*(){return e.forEach(a=>{const n=a.viewConfig.items;if(typeof n!="string")return;const s=n.split("$")[1];if(!s)return;const c=r._getAttributeDSName(s);r._addDataSourceAttributes(t.modelConfig?.dataSources||{},c),r._addViewModelAttributes(t.viewModelConfig,s,c),r._applyGalleryConfig(c,a)}),yield Promise.resolve(t)})()}static#e=this.\u0275fac=function(){let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(Ie)))(i||Ie)}}();static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ie,factory:Ie.\u0275fac})}class ve extends j{constructor(){super(...arguments),this.componentTypes=["crt.FileList"],this.index=1,this.defaultPrimaryColumnName="Id",this.defaultFilesEntitySchemaName="SysFile",this.defaultRecordColumnName="RecordId",this._fileDropDisableFeature="DisableFileListDropPreprocessing"}_getAdditionalFilterName(e){return`${e}_PredefinedFilter`}_createViewModelAttribute(e){return{isCollection:!0,modelConfig:{path:e},viewModelConfig:{attributes:{}}}}_getUploadFileRequest(e){return{request:"crt.UploadFileRequest",params:{viewElementName:e}}}_setFileListDropZoneParameters(e,t){t&&(e.viewConfig.droppable=!1,e.viewConfig.fileDropped=void 0),e.viewConfig.droppable!==!1&&(e.viewConfig.droppable=!0,e.viewConfig.fileDropped||(e.viewConfig.fileDropped=this._getUploadFileRequest(e.viewConfig.name??"")))}_setFileListUploadButtonParameters(e){e.viewConfig.uploadClicked||(e.viewConfig.uploadClicked=this._getUploadFileRequest(e.viewConfig.name??""))}_tryAddFileListProperties(e){if(e.viewConfig.items||(e.viewConfig.items=`$${e.viewConfig.name}`),!e.viewConfig.primaryColumnName){const t=e.viewConfig.name??"",r=`${F.getAttributeDSName(t)}_${this.defaultPrimaryColumnName}`;e.viewConfig.primaryColumnName=r}}_linkFilterToAttribute(e,t){if(e=e??{},!(0,f.isModelAttributeConfig)(e)||!e.modelConfig)return;const i=e.modelConfig.filterAttributes??[];i.find(r=>r.name===t)||i.push({loadOnChange:!0,name:t}),e.modelConfig.filterAttributes=i}tryAddAttributeAndDataSource(e,t,i){var r=this;return(0,l.Z)(function*(){const a=i.viewConfig.items;if(typeof a!="string")return;const n=a.split("$")[1];if(!n)return;const s=F.getAttributeDSName(n),c=r._getAdditionalFilterName(n);e.modelConfig||(e.modelConfig={});const d=e.modelConfig.dataSources??{},p=e.viewModelConfig.attributes??{};if(d[s]||(d[s]=F.createDataSourceConfig(r.defaultFilesEntitySchemaName),e.modelConfig.dataSources=d),F.addDependencies(e,i.viewConfig,s),p[n]||(p[n]=r._createViewModelAttribute(s),e.viewModelConfig.attributes=p),!p[c]){const g=i.viewConfig.fileGroups,b=i.viewConfig.tag??"",C=d[s].config?.entitySchemaName,I=yield F.getRecordEntitySchemaName(i.viewConfig.items,i.viewConfig?.masterRecordColumnValue,e,t),E=Ut(g,b,C,I);E&&(p[c]=E,r._linkFilterToAttribute(p[n],c),e.viewModelConfig.attributes=p)}})()}innerProcess(e,t,i){var r=this;return(0,l.Z)(function*(){const a=r.featureService.getFeatureState(r._fileDropDisableFeature),n=yield(0,_.lastValueFrom)(a);for(const s of e)r._tryAddFileListProperties(s),r._setFileListDropZoneParameters(s,n),r._setFileListUploadButtonParameters(s),yield r.tryAddAttributeAndDataSource(t,i,s);return t})()}static#e=this.\u0275fac=function(){let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(ve)))(i||ve)}}();static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ve,factory:ve.\u0275fac})}const Vt=new o.InjectionToken("FILE_UPLOAD_METADATA_WORKER");class lt{constructor(e){this._workers=e??[]}run(e,t){var i=this;return(0,l.Z)(function*(){const r=[...i._workers].sort((a,n)=>a.order-n.order);for(const a of r)yield a.process(e,t)})()}static#e=this.\u0275fac=function(t){return new(t||lt)(o.\u0275\u0275inject(Vt,8))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:lt,factory:lt.\u0275fac,providedIn:"root"})}class Te extends j{constructor(){super(...arguments),this.index=3,this._uploadFileRequestName="crt.UploadFileRequest",this._defaultFilesEntitySchemaName="SysFile",this._defaultRecordColumnName="RecordId"}_getUploadFileRequestConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.Button","crt.MenuItem"],e.viewConfig).filter(t=>t.viewConfig.clicked?.request===this._uploadFileRequestName).map(t=>t.viewConfig.clicked)}_getFileLists(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FileList",e.viewConfig)}_getFileDropRequestConfigs(e){const t=this._getFileLists(e);return t.filter(i=>i.viewConfig.fileDropped?.request===this._uploadFileRequestName).map(i=>i.viewConfig.fileDropped).concat(t.filter(i=>i.viewConfig.uploadClicked?.request===this._uploadFileRequestName).map(i=>i.viewConfig.uploadClicked))}getFilesEntitySchemaName(e,t,i){const r=F.getDataSourceNameByAttribute(e);return r?F.getDataSchemaName({models:i,schema:t,dataSourceName:r}):Promise.resolve(null)}setRequestParam(e,t,i){!e[t]&&i&&(e[t]=i)}getBaseRequestParams(){return{fileGroup:f.FileGroupEnum.Attachments,tag:"",files:"@event.files"}}getDefaultRequestParams(e){const t=F.getDataSourcePrimaryAttribute(e);return{...this.getBaseRequestParams(),recordId:`$${t}`,fileEntitySchemaName:this._defaultFilesEntitySchemaName,recordColumnName:this._defaultRecordColumnName}}getRequestParams(e,t,i){var r=this;return(0,l.Z)(function*(){const a=r.getBaseRequestParams(),n=e.items,s=(yield r.getFilesEntitySchemaName(n,t,i))||r._defaultFilesEntitySchemaName,c=e?.masterRecordColumnValue,d=yield F.getRecordEntitySchemaName(n,c,t,i);return{...a,fileGroup:e?.fileGroups?.[0],tag:e?.tag,recordId:c,itemsAttributeName:e.name,fileEntitySchemaName:s,recordEntitySchemaName:d,recordColumnName:e.recordColumnName||r._defaultRecordColumnName}})()}_setRequestParams(e,t){for(const i in t)t[i]&&this.setRequestParam(e.params,i,t[i])}_extendRequestParams(e,t,i,r){var a=this;return(0,l.Z)(function*(){e.params=e.params||{};const n=t.find(c=>c.viewConfig.name===e.params.viewElementName),s=n?yield a.getRequestParams(n.viewConfig,i,r):a.getDefaultRequestParams(i);a._setRequestParams(e,s)})()}getComponentsToProcess(e){return[...this._getUploadFileRequestConfigs(e),...this._getFileDropRequestConfigs(e)]}innerProcess(e,t,i){var r=this;return(0,l.Z)(function*(){const a=r._getFileLists(t);for(const n of e)yield r._extendRequestParams(n,a,t,i);return t})()}static#e=this.\u0275fac=function(){let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(Te)))(i||Te)}}();static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Te,factory:Te.\u0275fac})}class Ne{static#e=this.\u0275fac=function(t){return new(t||Ne)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:Ne});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:Vt,useClass:Ie,multi:!0},{provide:Vt,useClass:ve,multi:!0},{provide:Vt,useClass:Te,multi:!0}],imports:[Et.CommonModule]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(Ne,{imports:[Et.CommonModule]})})();class ut{get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._fileListPreprocessingDisableFeature))}constructor(e,t){this._featureService=e,this._workersService=t,this._fileListPreprocessingDisableFeature="DisableFileListPreprocessing"}crtOnModelInit(e,t){var i=this;return(0,l.Z)(function*(){if(yield i.isProcessingDisabled)return e;const r=e;return yield i._workersService.run(r,t),e})()}static#e=this.\u0275fac=function(t){return new(t||ut)(o.\u0275\u0275inject(y.FeatureService),o.\u0275\u0275inject(lt))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ut,factory:ut.\u0275fac})}const ar={fileLists:{A:"FileListA",B:"FileListB",C:"FileListC",D:"FileListD",E:"FileListE",F:"FileListF",G:"FileListG",H:"FileListH",I:"FileListI",WithDeepMasterRecordColumn:"FileListWithDeepMasterRecordColumn",WithAttributeWoPath:"FileListWithAttributeWoPath",WithUploadButton:"FileListWithCustomUploadButton",WoMasterRecordColumn:"FileListWoMasterRecordColumn",WoRecordSchemaName:"FileListWoRecordSchemaName",WithRecordSchemaName:"FileListWithRecordSchemaName",WoDropZone:"FileListWoDropZone"},recordColumnNameA:"ColumnA",testFileEntity:"TestFile",testEntityName:"TestEntity",testTag:"TestTag"};function nr(){return{viewConfig:[{type:"crt.FlexContainer",direction:"column",items:[{type:"crt.FileList",name:TEST_SCHEMA_DATA.fileLists.WithUploadButton,uploadClicked:{request:"crt.UploadFileRequest",params:{viewElementName:"custom"}}},{type:"crt.FileList",droppable:!1,name:TEST_SCHEMA_DATA.fileLists.WoDropZone},{type:"crt.FileList",items:"$FileListA",masterRecordColumnValue:"$OwnerId",recordColumnName:TEST_SCHEMA_DATA.recordColumnNameA,primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.A,tag:TEST_SCHEMA_DATA.testTag},{type:"crt.FileList",items:"$FileListRecordSchemaName",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WithRecordSchemaName},{type:"crt.FileList",items:"$FileListA",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WoRecordSchemaName},{type:"crt.FileList",items:"$FileListE",masterRecordColumnValue:"$OwnerId",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.E,fileGroups:[FileGroupEnum.Attachments]},{type:"crt.FileList",items:"$FileListF",masterRecordColumnValue:"$OwnerId",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.F,fileGroups:[FileGroupEnum.Attachments],tag:TEST_SCHEMA_DATA.testTag},{type:"crt.FileList",items:"$FileListG",masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.G},{type:"crt.FileList",items:TEST_SCHEMA_DATA.fileLists.H,masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.H},{type:"crt.FileList",items:"$FileListI",masterRecordColumnValue:"$OwnerAccountCreatedBy",primaryColumnName:"FileListADS_Id",name:TEST_SCHEMA_DATA.fileLists.I},{type:"crt.FlexContainer",direction:"column",items:[{type:"crt.FileList",name:TEST_SCHEMA_DATA.fileLists.B,droppable:!0}],name:"InnerContainer"},{type:"crt.Button",name:"ButtonA",clicked:{request:"crt.UploadFileRequest",params:{maximumAllowedFileSize:null,allowedFileTypes:"",viewElementName:TEST_SCHEMA_DATA.fileLists.A}}},{type:"crt.Button",name:"ButtonB",clicked:{request:"crt.UploadFileRequest",params:{}}},{type:"crt.Button",name:"ButtonTestRecordSchemaName",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WoRecordSchemaName}}},{type:"crt.Button",name:"ButtonTestRecordSchemaName",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WithRecordSchemaName}}},{type:"crt.Button",name:"ButtonC",menuItems:[{type:"crt.MenuItem",name:"MenuItemA",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.B}}},{type:"crt.MenuItem",name:"MenuItemB",clicked:{request:"crt.UpdateRecordRequest",params:{}}},{type:"crt.MenuItem",name:"MenuItemC"}]},{type:"crt.Button",name:"ButtonD",clicked:"$onClick"},{type:"crt.Button",name:"ButtonE"},{type:"crt.FileList",masterRecordColumnValue:"$OwnerAccountId",name:TEST_SCHEMA_DATA.fileLists.C,recordColumnName:"RecordId"},{type:"crt.FileList",masterRecordColumnValue:"$AttributeWoColumn",name:TEST_SCHEMA_DATA.fileLists.D,recordColumnName:"RecordId"},{type:"crt.FileList",masterRecordColumnValue:"$AttributeWoPath",name:TEST_SCHEMA_DATA.fileLists.WithAttributeWoPath},{type:"crt.FileList",masterRecordColumnValue:"not a master record attribute",name:TEST_SCHEMA_DATA.fileLists.WoMasterRecordColumn},{type:"crt.FileList",masterRecordColumnValue:"$OwnerAccountCreatedBy",name:TEST_SCHEMA_DATA.fileLists.WithDeepMasterRecordColumn,recordColumnName:"RecordId"},{type:"crt.Button",clicked:{request:"crt.UploadFileRequest",params:{viewElementName:TEST_SCHEMA_DATA.fileLists.WithDeepMasterRecordColumn}}}],name:"MainContainer"}],viewModelConfig:{attributes:{OwnerId:{modelConfig:{path:"PDS.Id"}},OwnerAccountId:{modelConfig:{path:"PDS.OwnerAccountId"}},FileListA:{isCollection:!0,modelConfig:{path:"FileListADS",filterAttributes:[{loadOnChange:!0,name:"FileListA_PredefinedFilter"}]},viewModelConfig:{attributes:{FileListADS_Name:{modelConfig:{path:"FileListADS.NamePredefined"}},FileListADS_CreatedOn:{modelConfig:{path:"FileListADS.CreatedOnPredefined"}},FileListADS_Size:{modelConfig:{path:"FileListADS.SizePredefined"}}}}},FileListRecordSchemaName:{isCollection:!0,modelConfig:{path:"FileListRecordSchemaNameDS"}},FileListE:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListF:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListG:{isCollection:!0,modelConfig:{path:"FileListADS"},viewModelConfig:{attributes:{}}},FileListI:{isCollection:!0,modelConfig:null,viewModelConfig:{attributes:{}}},AttributeWoColumn:{modelConfig:{path:"AttributeWoColumn"}},AttributeWoPath:{modelConfig:{path:""}},AttributeWoModelConfig:{modelConfig:void 0},OwnerAccountCreatedBy:{modelConfig:{path:"PDS.OwnerAccountCreatedBy"}}}},modelConfig:{dataSources:{PDS:{type:"crt.EntityDataSource",config:{entitySchemaName:TEST_SCHEMA_DATA.testEntityName,attributes:{OwnerAccountId:{path:"Owner.Account.Id"},OwnerAccountCreatedBy:{path:"Owner.Account.CreatedBy"}}}},FileListADS:{type:"crt.EntityDataSource",config:{entitySchemaName:TEST_SCHEMA_DATA.testFileEntity}},FileListRecordSchemaNameDS:{type:"crt.EntityDataSource",config:{entitySchemaName:"ObjectWithoutRecordSchemaName"}}},primaryDataSourceName:"PDS",dependencies:{FileListADS:[{attributePath:"RecordId",relationPath:"PDS.Id"}]}}}}class dt{constructor(e,t){this._filterViewElementOptionsModifierFactory=e,this._exposeAttributeConverterMetadataGenerator=t}_getFilterViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByFilter(t=>Boolean(t?._filterOptions),e).map(t=>t.viewConfig)}_modifyFilterViewConfig(e){return this._filterViewElementOptionsModifierFactory?.create(e?.type)?.modify(e)||e}_generateFiltersAttributes(e){const{from:t,converters:i,expose:r}=e._filterOptions||{};return(0,S.isEmpty)(t)||(0,S.isEmpty)(r)?{}:r.filter(a=>Boolean(a?.attribute)).map(a=>({from:t,converters:i,expose:a})).map(a=>this._generateFilterAttributes(a)).reduce((a,n)=>({...a,...n}),{})}_generateFilterAttributes(e){const{from:t,expose:i}=e,r=i.attribute;if(!r)return{};const a=this._exposeAttributeConverterMetadataGenerator.generate({...i,converters:this._getFilterConverters(i.converters,e.converters)});return a?{[r]:{from:t,converter:a.converterExpression},...a.converterArgsAttributes}:{}}_getFilterConverters(e,t){const i=e?.filter(({converter:a})=>Boolean(a))??[],r=t?.filter(({converter:a})=>Boolean(a))??[];return i.length===0?r:i.map(({converter:a,args:n})=>{const s=r.find(c=>c.converter===a);return{converter:a,args:n??s?.args}})}crtOnMetaDataInit(e){const t=e;return this._getFilterViewConfigs(t.viewConfig).map(i=>this._modifyFilterViewConfig(i)).map(i=>this._generateFiltersAttributes(i)).forEach(i=>{t.viewModelConfig.attributes={...t.viewModelConfig.attributes??{},...i}}),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||dt)(o.\u0275\u0275inject(A.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS_FACTORY,8),o.\u0275\u0275inject(A.ExposeAttributeConverterMetadataGenerator))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:dt,factory:dt.\u0275fac})}function hi(T,e){const t=new Map(e.map(([i,r])=>[i,{injectable:r}]));return new D.Factory(T,t)}class V{static withModifiers(e){return{ngModule:V,providers:e.map(t=>({provide:A.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS,useValue:t,multi:!0}))}}static#e=this.\u0275fac=function(t){return new(t||V)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:V});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[A.ExposeAttributeConverterMetadataGenerator,{provide:f.CRT_METADATA_PREPROCESSOR,useClass:dt,multi:!0},{provide:A.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS_FACTORY,useFactory:hi,deps:[o.Injector,A.FILTER_VIEW_ELEMENT_OPTIONS_MODIFIERS]}]})}class mt{constructor(){this._folderTreeItemsFilterName="folderTreeItemsFilter",this._featureValues=(0,o.inject)(m.FEATURE_VALUES),this._userInfo=(0,o.inject)(m.UserInfo),this._folderTreeUseStaticFolderService=(0,o.inject)(u.FolderTreeUseStaticFolderService),this._dataSchemaRepository=(0,o.inject)(f.DataSchemaRepositoryService),this._folderTreeIdResolver=(0,o.inject)(u.FolderTreeIdResolver),this._folderTreeDataProvider=(0,o.inject)(u.FolderTreeDataProvider),this._folderTreeAdminUnitRoleSourcesService=(0,o.inject)(u.FolderTreeAdminUnitRoleSourcesService)}_initializeAdminUnitRoleSources(){var e=this;return(0,l.Z)(function*(){e._adminUnitRoleSources=yield e._folderTreeAdminUnitRoleSourcesService.getAsArray()})()}_getFolderTreeViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FolderTree",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_processFolderTree(e,t){var i=this;return(0,l.Z)(function*(){if(!t.rootSchemaName){i._resetActiveFolderIdAttributesValue(e,t);return}yield i._prepareActiveFolderIdAttributeValue(e,t),yield i._setUseStaticFoldersAttributeValue(t),yield i._setItemsConfig(e,t),i._setFolderTreeInputs(e,t),i._setFolderTreeOutputs(e,t),i._setFavoriteItemsConfig(e,t)})()}_setFolderTreeInputs(e,t){this._setExpandedItemsAttrValue(e,t),this._setVisibleAttrValue(e,t),this._setActiveFolderAttributes(e,t),this._setShowMaskAttrValue(e,t)}_setFolderTreeOutputs(e,t){this._setActiveFolderChanged(t),this._setFolderTreeVisibleChanged(t),this._setAddFolderRequest(t),this._setCopyFolderRequest(t),this._setFolderRenameRequest(t),this._setFolderFiltersUpdatedRequest(t),this._setDeleteFolderRequest(e,t),this._setFolderTreeExpandedItemsChanged(t),this._setConvertToStaticFolder(t),this._setFolderChangeRights(t),this._setToggleFolderFavoriteRequest(t)}_isOldSourceSchema(e){return(0,u.isOldSourceSchema)(e.sourceSchemaName)}_getFolderFilterColumnName(e){return(0,u.getFolderFilterColumnName)(e.sourceSchemaName)}_setActiveFolderChanged(e){e.activeFolderChanged||(e.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:e.name,id:"@event.id",name:"@event.name",folderTreeId:"@event.folderTreeId",filterData:"@event.filterData",folderTypeId:"@event.folderTypeId",rootSchemaName:"@event.rootSchemaName",isFavorite:"@event.isFavorite"}})}_setFolderTreeVisibleChanged(e){e.folderTreeVisibleChanged||(e.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:e.name,visible:"@event.visible"}})}_setAddFolderRequest(e){e.addFolder||(e.addFolder={request:"crt.AddFolderDataRequest",params:this._getAddFolderRequestParameters(e)})}_getAddFolderRequestParameters(e){return{folderTreeName:e.name,folderId:"@event.folderId",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData",folderTypeId:"@event.folderTypeId"}}_setCopyFolderRequest(e){e.copyFolder||(e.copyFolder={request:"crt.CopyFolderDataRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",sourceId:"@event.sourceId",copyRights:"@event.copyRights",folderName:"@event.folderName",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",parentId:"@event.parentId",filterData:"@event.filterData"}})}_setFolderRenameRequest(e){e.folderRenamed||(e.folderRenamed={request:"crt.FolderTreeRenameRequest",params:{folderTreeName:e.name,folderId:"@event.folderId",folderName:"@event.folderName",sourceSchemaName:"@event.sourceSchemaName",reloadFavorites:"@event.reloadFavorites"}})}_setToggleFolderFavoriteRequest(e){e.toggleFolderFavorite||(e.toggleFolderFavorite={request:"crt.ToggleFolderFavoriteRequest",params:{folderTreeName:e.name,id:"@event.id",favoriteId:"@event.favoriteId",rootSchemaName:"@event.rootSchemaName",sourceSchemaName:"@event.sourceSchemaName",status:"@event.status",reloadFavorites:!0}})}_setFolderFiltersUpdatedRequest(e){e.folderFiltersUpdated||(e.folderFiltersUpdated={request:"crt.FolderTreeUpdateFiltersRequest",params:{folderTreeName:e.name,filterData:"@event.filterData",sourceSchemaName:"@event.sourceSchemaName",folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}})}_setDeleteFolderRequest(e,t){if(t.deleteFolder)return;const{itemsAttrName:i}=(0,m.buildFolderTreeAttributeNames)(t.name);t.deleteFolder={request:"crt.DeleteFolderDataRequest",params:{dataSourceName:this._getDataSourceNameByItems(e,i),sourceSchemaName:"@event.sourceSchemaName",folderTreeName:t.name,folderId:"@event.folderId",reloadFavorites:"@event.reloadFavorites"}}}_getDataSourceNameByItems(e,t){const i=this._getViewModelConfigAttribute(e,t)??{};return"embeddedModel"in i?i?.embeddedModel?.name??"":""}_setItemsConfig(e,t){var i=this;return(0,l.Z)(function*(){i._setItemsAttrValue(t),yield i._addItemsViewModelAttribute(e,t),i._setItemsFilterAttrValue(e,t)})()}_setItemsAttrValue(e){if(e.items)return;const{itemsAttrName:t}=(0,m.buildFolderTreeAttributeNames)(e.name);e.items=`$${t}`}_updateItemsViewModelAttributeViewModelConfig(e,t){const{itemsModelName:i}=(0,m.buildFolderTreeAttributeNames)(t.name),r=this._getFolderFilterColumnName(t);if(!this._isOldSourceSchema(t)){e.attributes.FilterData={modelConfig:{path:`${i}.${r}`}};return}e.attributes.FolderTypeId={modelConfig:{path:`${i}.FolderType.Id`}},e.attributes.FilterData={modelConfig:{path:`${i}.${r}`}}}_addItemsViewModelAttribute(e,t){var i=this;return(0,l.Z)(function*(){const{itemsAttrName:r,itemsModelName:a,itemsFilterAttrName:n}=(0,m.buildFolderTreeAttributeNames)(t.name),s=t.sourceSchemaName,c=yield i._getDataSchema(s),d={isCollection:!0,viewModelConfig:i._createItemsViewModelAttributeViewModelConfig(t,c),modelConfig:i._createItemsViewModelAttributeModelConfig(a,n),embeddedModel:i._createItemsViewModelAttributeEmbeddedModel(a,s)};i._isOldItemsCollectionViewModelAttribute(e,t)&&i._addViewModelConfigAttribute(e,r,d,!0),i._mergeViewModelConfigAttribute(e,r,d)})()}_getDataSchema(e){return(0,_.lastValueFrom)(this._dataSchemaRepository.get(e))}_createItemsViewModelAttributeViewModelConfig(e,t){const{itemsModelName:i}=(0,m.buildFolderTreeAttributeNames)(e.name),r=this._getFolderFilterColumnName(e),a={attributes:{Id:{modelConfig:{path:`${i}.${t.primaryAttributeName}`}},Name:{modelConfig:{path:`${i}.${t.primaryDisplayAttributeName}`}},ParentId:{modelConfig:{path:`${i}.${t.hierarchyAttributeName}.${t.primaryAttributeName}`}},FilterData:{modelConfig:{path:`${i}.${r}`}}}};return this._updateItemsViewModelAttributeViewModelConfig(a,e),a}_createItemsViewModelAttributeModelConfig(e,t){return{path:e,filterAttributes:[{name:t,loadOnChange:!0}]}}_createItemsViewModelAttributeEmbeddedModel(e,t){return{name:e,config:{type:"crt.EntityDataSource",config:{entitySchemaName:t,adminUnitRoleSources:this._adminUnitRoleSources}}}}_isOldItemsCollectionViewModelAttribute(e,t){const{itemsAttrName:i}=(0,m.buildFolderTreeAttributeNames)(t.name),r=this._getViewModelConfigAttribute(e,i);return this._isOldCollectionViewModelAttribute(r)}_isOldCollectionViewModelAttribute(e){return!!e&&!!e.isCollection&&!!e.viewModelConfig&&!!e.embeddedModel&&!!e.modelConfig}_setItemsFilterAttrValue(e,t){if(!this._getViewModelConfigAttributes(e))return;const{itemsFilterAttrName:i}=(0,m.buildFolderTreeAttributeNames)(t.name),r=this._createItemsFilterGroup(t);this._addViewModelConfigAttribute(e,i,{value:r},!0)}_createItemsFilterGroup(e){return this._isOldSourceSchema(e)?this._createOldStructureItemsFilterGroup(e):this._createNewStructureItemsFilterGroup(e)}_createOldStructureItemsFilterGroup(e){const t=new h.FilterGroup(h.LogicalOperatorType.Or),i=[u.DYNAMIC_FOLDER_TYPE_ID];return e.useStaticFolders&&i.push(u.STATIC_FOLDER_TYPE_ID),t.addSchemaColumnInFilterWithParameters(h.ComparisonType.Equal,"FolderType",i,this._folderTreeItemsFilterName),t}_createNewStructureItemsFilterGroup(e){const t=new h.FilterGroup(h.LogicalOperatorType.Or);return t.addSchemaColumnFilterWithParameter(h.ComparisonType.Equal,"EntitySchemaName",e.rootSchemaName,this._folderTreeItemsFilterName),t}_isAllowUseStaticFolders(e){var t=this;return(0,l.Z)(function*(){return t._featureValues.IsAllowUseStaticFolders&&(yield(0,_.lastValueFrom)(t._folderTreeUseStaticFolderService.isEnabled(e.rootSchemaName)))})()}_setVisibleAttrValue(e,t){if(t.visible)return;const{visibleAttrName:i}=(0,m.buildFolderTreeAttributeNames)(t.name);t.visible=`$${i}`,this._addViewModelConfigAttribute(e,i,{value:!0})}_setShowMaskAttrValue(e,t){if(t.showMask)return;const{showMaskAttrName:i}=(0,m.buildFolderTreeAttributeNames)(t.name);t.showMask=`$${i}`,this._addViewModelConfigAttribute(e,i,{value:!1})}_setActiveFolderAttributes(e,t){t.activeFolderId||(this._setActiveFolderIdAttribute(t),this._setActiveFolderFilterAttribute(e,t),this._addActiveFolderNameAttribute(e,t))}_setActiveFolderIdAttribute(e){const{activeFolderIdAttrName:t}=(0,m.buildFolderTreeAttributeNames)(e.name);e.activeFolderId=`$${t}`}_addActiveFolderNameAttribute(e,t){const{activeFolderNameAttrName:i}=(0,m.buildFolderTreeAttributeNames)(t.name);this._addViewModelConfigAttribute(e,i,{})}_setActiveFolderFilterAttribute(e,t){if(!this._isNeedToSetFolderFilterAttribute(e,t))return;const{activeFolderFolderTreeIdAttrName:i,activeFolderFilterAttrName:r,activeFolderFilterDataAttrName:a}=(0,m.buildFolderTreeAttributeNames)(t.name);this._addViewModelConfigAttribute(e,r,{from:[i,a],converter:"crt.FolderTreeActiveFilterAttributeConverter"},!0)}_isNeedToSetFolderFilterAttribute(e,t){const{activeFolderFilterAttrName:i}=(0,m.buildFolderTreeAttributeNames)(t.name),r=this._getViewModelConfigAttribute(e,i);return!(r&&(0,f.isCalculatedAttributeConfig)(r))}_setFavoriteItemsConfig(e,t){const{favoriteItemsAttrName:i}=(0,m.buildFolderTreeAttributeNames)(t.name);t.favoriteItems=`$${i}`;const r=`${i}_DS`,a=`${r}_filter`;this._setFavoriteItemsFilterAttr(a,e,t);const n={isCollection:!0,modelConfig:{path:r,filterAttributes:[{name:a,loadOnChange:!0}]}};this._addFavoriteItemsViewModelConfig(n,t,r),this._addFavoriteItemsEmbeddedModel(n,t,r),this._isOldFavoriteItemsCollectionViewModelAttribute(e,t)&&this._addViewModelConfigAttribute(e,i,n,!0),this._mergeViewModelConfigAttribute(e,i,n)}_addFavoriteItemsViewModelConfig(e,t,i){const r=this._isOldSourceSchema(t),a=r?"":".FolderTree",n=r?"FolderId":"Id",s={Id:{modelConfig:{path:`${i}.Id`}},Name:{modelConfig:{path:`${i}${a}.Name`}},FolderTreeId:{modelConfig:{path:`${i}${a}.${n}`}},FilterData:{modelConfig:{path:`${i}${a}.FilterData`}}};r&&(s.FolderTypeId={modelConfig:{path:`${i}${a}.FolderTypeId`}}),e.viewModelConfig={attributes:s}}_addFavoriteItemsEmbeddedModel(e,t,i){const r=this._isOldSourceSchema(t),a=r?u.SECURED_OLD_FOLDER_TREE_FAVORITE_SCHEMA_NAME:u.SECURED_DEFAULT_FOLDER_TREE_FAVORITE_SCHEMA_NAME,n={name:i,config:{type:"crt.EntityDataSource",config:{entitySchemaName:a,adminUnitRoleSources:this._adminUnitRoleSources},hiddenInPageDesigner:!1}};if(r){const s=t.sourceSchemaName,c=this._getFolderFilterColumnName(t);n.config.config.attributes={Name:{path:`[${s}:Id:FolderId].Name`,type:h.DataSchemaAttributeType.ForwardReferenceAttribute},FilterData:{path:`[${s}:Id:FolderId].${c}`,type:h.DataSchemaAttributeType.ForwardReferenceAttribute},FolderTypeId:{path:`[${s}:Id:FolderId].FolderType.Id`,type:h.DataSchemaAttributeType.ForwardReferenceAttribute}}}e.embeddedModel=n}_isOldFavoriteItemsCollectionViewModelAttribute(e,t){const{favoriteItemsAttrName:i}=(0,m.buildFolderTreeAttributeNames)(t.name),r=this._getViewModelConfigAttribute(e,i);return this._isOldCollectionViewModelAttribute(r)}_setFavoriteItemsFilterAttr(e,t,i){const r=this._getViewModelConfigAttributes(t);if(r?.[e]||!r)return;const a=this._isOldSourceSchema(i),n=new h.FilterGroup(h.LogicalOperatorType.And),s=new h.CompareFilter(h.ComparisonType.Equal,new h.ColumnExpression({columnPath:"SysAdminUnit"}),new h.ParameterExpression({value:this._userInfo?.id,dataValueType:h.DataValueType.Guid}));if(n.add(s,"adminUnitFilter"),a){const c=i.sourceSchemaName,d=new h.CompareFilter(h.ComparisonType.Equal,new h.ColumnExpression({columnPath:"FolderEntitySchemaName"}),new h.ParameterExpression({value:c}));n.add(d,"folderEntitySchemaNameFilter")}else{const c=new h.CompareFilter(h.ComparisonType.Equal,new h.ColumnExpression({columnPath:"EntitySchemaName"}),new h.ParameterExpression({value:i.rootSchemaName}));n.add(c,"schemaFilter")}r[e]={value:n}}_setExpandedItemsAttrValue(e,t){if(t.expandedItems)return;const{expandedItemsAttrName:i}=(0,m.buildFolderTreeAttributeNames)(t.name);t.expandedItems=`$${i}`,this._addViewModelConfigAttribute(e,i,{})}_getViewModelConfigAttribute(e,t){return(this._getViewModelConfigAttributes(e)||{})[t]}_getViewModelConfigAttributes(e){return e?.viewModelConfig?.attributes}_mergeViewModelConfigAttribute(e,t,i){const r=this._getViewModelConfigAttribute(e,t);r&&(i=(0,S.mergeWith)(i,r,(a,n)=>(0,S.isArray)(n)?n:void 0)),this._addViewModelConfigAttribute(e,t,i,!0)}_addViewModelConfigAttribute(e,t,i,r=!1){const a=this._getViewModelConfigAttribute(e,t);if(!r&&a)return;const n=this._getViewModelConfigAttributes(e)||{};n[t]=i}_setFolderTreeExpandedItemsChanged(e){e.folderTreeExpandedItemsChanged||(e.folderTreeExpandedItemsChanged={request:"crt.FolderTreeExpandedItemsRequest",params:{folderTreeName:e.name,expandedItems:"@event.expandedItems"}})}_setFolderChangeRights(e){e.folderChangeRights||(e.folderChangeRights={request:"crt.LoadRightsModuleRequest",params:{payload:{entitySchemaName:"@event.entitySchemaName",entitySchemaCaption:"@event.entitySchemaCaption",primaryColumnValue:"@event.primaryColumnValue",primaryDisplayColumnValue:"@event.primaryDisplayColumnValue"}}})}_setConvertToStaticFolder(e){e.convertToStaticFolder||!this._isOldSourceSchema(e)||(e.convertToStaticFolder={request:"crt.ConvertToStaticFolderRequest",params:this._getAddFolderRequestParameters(e)})}_prepareActiveFolderIdAttributeValue(e,t){var i=this;return(0,l.Z)(function*(){const r=yield i._folderTreeIdResolver.getActiveFolderFolderTreeId(t,e);if((0,S.isEmpty)(r)){i._resetActiveFolderIdAttributesValue(e,t);return}yield i._updateActiveFolderIdAttributesValue(r,e,t)})()}_resetActiveFolderIdAttributesValue(e,t){const{activeFolderFolderTreeIdAttrName:i,activeFolderIdAttrName:r,activeFolderNameAttrName:a,activeFolderFilterDataAttrName:n}=(0,m.buildFolderTreeAttributeNames)(t.name);[i,r,a,n].forEach(c=>{this._addViewModelConfigAttribute(e,c,{value:null},!0)})}_updateActiveFolderIdAttributesValue(e,t,i){var r=this;return(0,l.Z)(function*(){const a=yield r._folderTreeDataProvider.getFolderData(e,i.sourceSchemaName);if(!a)return;const{activeFolderNameAttrName:n,activeFolderFilterDataAttrName:s}=(0,m.buildFolderTreeAttributeNames)(i.name),c=yield r._getFolderFilterFromFolderData(a,i);r._addViewModelConfigAttribute(t,n,{value:a.name},!0),r._addViewModelConfigAttribute(t,s,{value:c},!0)})()}_getFolderFilterFromFolderData(e,t){return(0,u.isStaticFolder)(e.folderTypeId)?(0,u.createStaticFolderFilter)(e.id,t.rootSchemaName):Promise.resolve(e.filter)}_setUseStaticFoldersAttributeValue(e){var t=this;return(0,l.Z)(function*(){!t._isOldSourceSchema(e)||(e.useStaticFolders=yield t._isAllowUseStaticFolders(e))})()}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){const i=e,r=t._getFolderTreeViewConfigs(i);return(0,S.isEmpty)(r)?e:(yield t._initializeAdminUnitRoleSources(),yield Promise.all(r.map(a=>t._processFolderTree(i,a))),i)})()}static#e=this.\u0275fac=function(t){return new(t||mt)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:mt,factory:mt.\u0275fac})}class ft{_getFolderTreeActionViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.FolderTreeActions",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_setProperties(e){const t=e.folderTree,{activeFolderIdAttrName:i,activeFolderNameAttrName:r,activeFolderFavoriteStateAttrName:a,favoriteItemsAttrName:n}=(0,m.buildFolderTreeAttributeNames)(t);e.activeFolderId||(e.activeFolderId=t?`$${i}`:null),e.activeFolderName||(e.activeFolderName=t?`$${r}`:null),e.activeFolderFavoriteState||(e.activeFolderFavoriteState=t?`$${a}`:null),e.favoriteItems||(e.favoriteItems=t?`$${n}`:null)}_setActiveFolderChangedRequest(e,t){if(t.activeFolderChanged)return;const i=t.folderTree??null;if(!i)return;const r=this._getFolderTreeRootSchemaName(e,i);t.activeFolderChanged={request:"crt.FolderTreeActiveFolderChangedRequest",params:{folderTreeName:i,id:"@event.id",name:"@event.name",folderTreeId:"@event.folderTreeId",filterData:"@event.filterData",folderTypeId:"@event.folderTypeId",rootSchemaName:r,isFavorite:"@event.isFavorite"}}}_setFolderTreeVisibleChangedRequest(e){e.folderTreeVisibleChanged||(e.folderTreeVisibleChanged={request:"crt.FolderTreeVisibleRequest",params:{folderTreeName:e.folderTree??null,togglePanel:"@event.togglePanel"}})}_getFolderTreeRootSchemaName(e,t){return m.MetadataSchemaUtils.getViewConfigInfoByName(e,t)?.viewConfig?.rootSchemaName}crtOnMetaDataInit(e){const t=e,i=this._getFolderTreeActionViewConfigs(t);for(const r of i)this._setProperties(r),this._setActiveFolderChangedRequest(t,r),this._setFolderTreeVisibleChangedRequest(r);return Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||ft)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ft,factory:ft.\u0275fac})}class _i{constructor(){this._pagingConfigPath="modelConfig.pagingConfig",this._selectionOptionsPreprocessorService=(0,o.inject)(O),this.collectionPropertyName="items",this.paginationChangePropertyName="paginationChange"}_normalizeViewConfigName(e){e.name||(e.name=(0,D.getRandomString)(10))}_getCollectionsViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this.viewType,e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_allowSetPagingConfig(e,t){return!!e&&e in t&&!(0,S.has)(t[e],this._pagingConfigPath)}_allowSetPaginationChange(e,t){return!!t&&!(0,S.has)(e,this.paginationChangePropertyName)}_getViewModelConfigAttributes(e){return e?.viewModelConfig?.attributes}processElementsOnMetaDataInit(e,t){var i=this;return(0,l.Z)(function*(){return Promise.all(e.map(r=>i.processElementOnMetaDataInit(r,t)))})()}processElementOnMetaDataInit(e,t){this._normalizeViewConfigName(e);const i=t.viewModelConfig.attributes,r=this.getCollectionAttributeName(e);return this.setCollectionAttributePagingConfig(r,i),this.setSelectionOptions(e),Promise.resolve()}setCollectionAttributePagingConfig(e,t){!this._allowSetPagingConfig(e,t)||(0,S.set)(t[e],this._pagingConfigPath,this.getPagingConfig())}setSelectionOptions(e){this._selectionOptionsPreprocessorService.setInitialSelectionOptions(e,e.name)}processElementsOnViewModelInit(e,t,i){return Promise.all(e.map(r=>this.processElementOnViewModelInit(r,t,i)))}processElementOnViewModelInit(e,t,i){const r=this.getCollectionAttributeName(e);return this.setCollectionViewConfigPaginationChange(e,i,r,this.paginationChangePropertyName),Promise.resolve()}setCollectionViewConfigPaginationChange(e,t,i,r){if(!this._allowSetPaginationChange(e,i))return;const a=t.getBoundDataSourceNameByAttributePath(i);(0,S.set)(e,r,this.getPaginationChangeRequest(a))}addViewModelConfigAttribute(e,t,i,r=!1){const a=this.getViewModelConfigAttribute(e,t);if(!r&&a)return;const n=this._getViewModelConfigAttributes(e)||{};(0,S.set)(n,t,i)}getViewModelConfigAttribute(e,t){return(this._getViewModelConfigAttributes(e)||{})[t]}getCollectionAttributeName(e){return this.getBoundAttributeName((0,S.get)(e,this.collectionPropertyName))}getBoundAttributeName(e){return e?.startsWith("$")?e.slice(1):e}getPagingConfig(){return{rowCount:30}}getPaginationChangeRequest(e){return{request:"crt.LoadDataRequest",params:{dataSourceName:e,parameters:[]}}}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){const i=e,r=t._getCollectionsViewConfigs(i);return yield t.processElementsOnMetaDataInit(r,i),Promise.resolve(e)})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){const a=e,n=r._getCollectionsViewConfigs(a);return yield r.processElementsOnViewModelInit(n,a,i),Promise.resolve(e)})()}}class Ee extends _i{constructor(){super(...arguments),this.viewType="crt.Gallery"}_setGalleryInputs(e,t){this._setSelectedItemIdAttrValue(e,t)}_setSelectedItemIdAttrValue(e,t){if(e.selectedItemId)return;const i=this._getGallerySelectedItemIdAttributeName(e.name);e.selectedItemId=`$${i}`,this.addViewModelConfigAttribute(t,i,{value:null})}_processOpenPageHandles(e,t){var i=this;return(0,l.Z)(function*(){if(!i._isValidGalleryItemConfig(e.itemConfig))return;const r=yield i._getCollectionEntitySchemaName(e,t);if(!(yield i._hasAnyPage(e,r,t)))return;const n=yield i._getOpenPageRequest(e,r);i._processCaptionViewConfig(e,n),i._processItemDblClick(e,n)})()}_isValidGalleryItemConfig(e){return Boolean(e&&!e.captionViewConfig&&e.templateValuesMapping?.caption&&e.templateValuesMapping?.id)}_getCollectionEntitySchemaName(e,t){var i=this;return(0,l.Z)(function*(){const r=i.getCollectionAttributeName(e);return(yield(0,f.getEntitySchemaAttribute)(t,r))?.referenceSchemaName})()}_hasAnyPage(e,t,i){return this._hasSpecificPage(e)?Promise.resolve(!0):this._hasEntityEditPage(t,i)}_hasSpecificPage(e){return!!e.useSpecificPage&&!!e.specificPage}_hasEntityEditPage(e,t){if(!e)return Promise.resolve(!1);const i={type:"crt.7XRequest",action:"HasEntityEditPage",$context:t,payload:{entityName:e}};return h.HandlerChainService.instance.process(i)}_getOpenPageRequest(e,t){return this._hasSpecificPage(e)?Promise.resolve(this._getOpenPageBySpecificPage(e)):Promise.resolve(this._getOpenPageByEntityName(e,t))}_getOpenPageBySpecificPage(e){const{specificPage:t}=e,{itemIdBoundedAttribute:i}=this._getItemAttributes(e);return{request:"crt.OpenPageRequest",params:{schemaName:t,modelInitConfigs:[{recordId:i,action:h.ModelInPageAction.Edit}]}}}_getOpenPageByEntityName(e,t){const{itemIdBoundedAttribute:i}=this._getItemAttributes(e);return{request:"crt.UpdateRecordRequest",params:{entityName:t,recordId:i}}}_processCaptionViewConfig(e,t){e.itemConfig.captionViewConfig=this._getLinkViewConfig(e,t)}_getLinkViewConfig(e,t){return this._hasSpecificPage(e)?this._getLinkViewConfigBySpecificPage(e,t):this._getLinkViewConfigByEntityName(e,t)}_getLinkViewConfigBySpecificPage(e,t){const{specificPage:i}=e,{itemIdBoundedAttribute:r,itemCaptionBoundedAttribute:a}=this._getItemAttributes(e);return{...this._getBaseLinkViewConfig(a),href:`${r} | crt.ToOpenPageLink : '${i}'`,clicked:t}}_getLinkViewConfigByEntityName(e,t){const{itemConfig:i}=e,r=i.templateValuesMapping?.id,{itemIdBoundedAttribute:a,itemCaptionBoundedAttribute:n}=this._getItemAttributes(e);return{...this._getBaseLinkViewConfig(n),href:`${a} | crt.ToRecordLinkAsync : '${r}'`,clicked:t}}_getItemAttributes(e){const{itemConfig:t,items:i}=e,r=t.templateValuesMapping?.caption,a=t.templateValuesMapping?.id,n=this.getBoundAttributeName(i),s=`$${n}.${a}`,c=`$${n}.${r}`;return{itemIdBoundedAttribute:s,itemCaptionBoundedAttribute:c}}_getBaseLinkViewConfig(e){return{type:"crt.Link",mode:"preventDefault",caption:`${e}`}}_processItemDblClick(e,t){e.itemDblClick||(e.itemDblClick={request:"crt.GalleryItemClickRequest",params:{item:"@event",clickRequestConfig:t}})}_getGallerySelectedItemIdAttributeName(e){return`${e}_SelectedItemId`}processElementOnMetaDataInit(e,t){var i=()=>super.processElementOnMetaDataInit,r=this;return(0,l.Z)(function*(){yield i().call(r,e,t),r._setGalleryInputs(e,t)})()}processElementOnViewModelInit(e,t,i){var r=()=>super.processElementOnViewModelInit,a=this;return(0,l.Z)(function*(){yield r().call(a,e,t,i),yield a._processOpenPageHandles(e,i)})()}static#e=this.\u0275fac=function(){let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(Ee)))(i||Ee)}}();static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ee,factory:Ee.\u0275fac})}class pt{get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._imageInputPreprocessingDisableFeature))}get isAutobindDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._autoBindToDisabled))}constructor(e,t){this._featureService=e,this._metadataModifierService=t,this._imageInputPreprocessingDisableFeature="DisableImageInputPreprocessing",this._autoBindToDisabled="AutoBindToDisabled"}_addToImageLinkConverter(e,t){const i=t.indexOf("|");if(t.startsWith("$")&&i===-1){const r=t+" | crt.ToImageLink";this._metadataModifierService.updateProperty({source:e,keys:["value"],value:r})}}_addBusinessRulesBinding(e,t,i,r,a){if(r.startsWith("$")&&!e.bindTo&&!a){this._metadataModifierService.addProperty(e,"bindTo",`$${i}`);const n=t.attributes||{};n[i]={...n[i],viewItemName:e.name},t.attributes=n}}_addImageSelectedRequest(e,t){e.imageSelected||this._metadataModifierService.addProperty(e,"imageSelected",{request:"crt.UploadImageRequest",params:{imageAttributeName:t,details:"@event"}})}_addimageClearRequest(e,t){e.imageClear||this._metadataModifierService.addProperty(e,"imageClear",{request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:t,attributeValue:null}})}_setReadonlyByType(e,t,i){var r=this;return(0,l.Z)(function*(){const a=t.viewModelConfig.attributes,n=r._getBindingAttributeWoConverters(e.value);if((0,A.isBindToViewModelAttribute)(n,a)){const s=n.slice(1).split(".").pop(),c=a[s]??{};let d="";(0,f.isModelAttributeConfig)(c)&&(d=c.modelConfig?.path.split(".")[0]);let p="";(0,f.isModelAttributeConfig)(c)&&(p=c.modelConfig?.path.split(".").pop());const g=i.find(I=>I.name===d),C=(g?yield(0,_.lastValueFrom)(g.getSchema(),{defaultValue:null}):null)?.findAttributeByName(p);C&&C.dataValueType!==h.DataValueType.IMAGELOOKUP&&(e.readonly||r._metadataModifierService.updateProperty({source:e,keys:["readonly"],value:!0}),r._metadataModifierService.removeProperty(e,"bindTo"))}})()}_getBindingAttributeWoConverters(e){const t=e?.indexOf("|");return t&&t!==-1&&(e=e.substring(0,t-1).trimEnd()),e}_getBindAttributeName(e){return this._getBindingAttributeWoConverters(e).replace("$","")}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(yield t.isProcessingDisabled)return e;const i=e,r=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ImageInput",i.viewConfig),a=yield t.isAutobindDisabled;return r.forEach(n=>{const s=n.viewConfig.value,c=t._getBindAttributeName(s);t._addToImageLinkConverter(n.viewConfig,s),t._addBusinessRulesBinding(n.viewConfig,i.viewModelConfig,c,s,a),t._addImageSelectedRequest(n.viewConfig,c),t._addimageClearRequest(n.viewConfig,c)}),e})()}crtOnModelInit(e,t){var i=this;return(0,l.Z)(function*(){if(yield i.isProcessingDisabled)return e;const r=e;return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.ImageInput",r.viewConfig).forEach(function(){var n=(0,l.Z)(function*(s){yield i._setReadonlyByType(s.viewConfig,r,t)});return function(s){return n.apply(this,arguments)}}()),e})()}static#e=this.\u0275fac=function(t){return new(t||pt)(o.\u0275\u0275inject(y.FeatureService),o.\u0275\u0275inject(f.MetadataModifierService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:pt,factory:pt.\u0275fac})}class gt{constructor(e){this._featureService=e,this._labelProcessingDisableFeature="DisableLabelPreprocessing"}_actualizeLabelType(e){const t=u.LABEL_TYPE_MAPPING[e.labelType];t&&(e.labelType=t)}get _isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._labelProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(yield t._isProcessingDisabled)return e;const i=e;return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Label",i.viewConfig).forEach(a=>{t._actualizeLabelType(a.viewConfig)}),e})()}static#e=this.\u0275fac=function(t){return new(t||gt)(o.\u0275\u0275inject(y.FeatureService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:gt,factory:gt.\u0275fac})}class ht{_getViewConfigs(e,t){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",t,e.viewConfig).map(i=>i?.viewConfig).filter(Boolean)}_setAddNextStepBtnAdditionalProperties(e){Object.keys(e).includes("visible")||(e.visible="$CardState | crt.IsEqual : 'edit'")}_setNextStepsComponentAdditionalProperties(e,t){if(!!e&&(Object.keys(e).includes("cardState")||(e.cardState="$CardState"),!Object.keys(e).includes("nextSteps"))){const i=t.viewModelConfig.attributes;this._createNextStepsAttribute(e,i)}}_createNextStepsAttribute(e,t){const i=`NextSteps_${e.name}`,r=`ReloadNextSteps_${e.name}`;t[i]={from:[this._getOrCreatePropertyAttribute(e.masterSchemaId||"",`MasterSchemaId_${e.name}`,t),this._getOrCreatePropertyAttribute(u.RELOAD_NEXT_STEPS_PREFIX,r,t)],converter:`crt.LoadNextSteps : '${e.masterSchemaName}'`},e.nextSteps=`$${i}`,e.reloadNextSteps=`$${r}`}_getOrCreatePropertyAttribute(e,t,i){return e.startsWith("$")?e.replace("$",""):(i[t]={value:e},t)}_handleNextStepsComponent(e){this._getViewConfigs(e,"crt.NextSteps").forEach(i=>{this._setNextStepsComponentAdditionalProperties(i,e)})}_handleNextStepsAddButtons(e){this._getViewConfigs(e,"crt.Button").forEach(i=>{if(i&&i.clickMode==="menu"){const r=i.menuItems||[];Array.isArray(r)&&r.some(a=>{const n=a.clicked;return n&&(n.request==="crt.AddNextStepRequest"||n.request==="crt.CreateEmailRequest")})&&this._setAddNextStepBtnAdditionalProperties(i)}})}_getNextStepRelatedConfigs(e){const t=m.MetadataSchemaUtils.getViewConfigInfoByFilter(i=>i.type==="crt.NextSteps"&&i.bindingColumns||i.type==="crt.MenuItem"&&i.clicked?.request==="crt.CreateEmailRequest"&&!i.clicked?.params?.bindingColumns,[e]).map(i=>i?.viewConfig).filter(Boolean);return t?.length!==2?null:{nextStep:t.find(i=>i.type==="crt.NextSteps"),addEmailBtn:t.find(i=>i.type==="crt.MenuItem")}}_getConfigsToFix(e){const t=new Array;return m.MetadataSchemaUtils.getViewConfigInfoByFilter(i=>{if(i.type!=="crt.ExpansionPanel")return!1;const r=this._getNextStepRelatedConfigs(i);return r&&t.push(r),Boolean(r)},e.viewConfig),t}_fixBindingColumns(e){this._getConfigsToFix(e).forEach(i=>{const r=i.addEmailBtn.clicked;r.params=r.params||{},r.params.bindingColumns=(0,S.cloneDeep)(i.nextStep.bindingColumns)})}crtOnMetaDataInit(e){const t=e;return this._fixBindingColumns(t),this._handleNextStepsAddButtons(t),this._handleNextStepsComponent(t),Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||ht)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ht,factory:ht.\u0275fac})}class _t{_modifyInputType(e,t,i){const r=e.control.replace("$",""),a=t.attributes[r]?.modelConfig?.path;if(a){const n=this._getDataSchemaAttributeByPath(a,i);n?.dataValueType===h.DataValueType.PHONE_TEXT&&(e.type="crt.PhoneInput",e.phoneAsLink=!0,e.displayAsPhone=n.isMasked)}else e.type==="crt.PhoneInput"&&(e.phoneAsLink=!0,e.displayAsPhone=!0)}_getDataSchemaAttributeByPath(e,t){const[i,r]=e.split("."),a=t.dataSchemas[i]?.attributes;let n;for(const s in a)if(a[s].path===r||a[s].name===r){n=a[s];break}return n}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){const a=e,n=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),s=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.PhoneInput",a.viewConfig);return n.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),s.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),e})()}static#e=this.\u0275fac=function(t){return new(t||_t)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:_t,factory:_t.\u0275fac})}class St{constructor(e,t,i){this._translateService=e,this._printablesService=t,this._rightsService=i,this._translatePrefix="PrintablesMenuItemsPreprocessor",this._canManageReports=!1}_generateMenuItems(e,t,i){var r=this;return(0,l.Z)(function*(){const a=e.viewConfig.clicked.params,n=t.modelConfig?.dataSources;if((0,S.isEmpty)(n))return console.warn("There is no datasources in modelConfig."),[];const s=n?.[a.dataSourceName];if(!s)return console.warn(`Datasource '${a.dataSourceName}' specified in the request is not found in the modelConfig.`),[];const c=s.scope===h.DataSourceScope.Page,d=s.config?.entitySchemaName;return(yield r._printablesService.getPrintablesForEntity(d)).filter(g=>c?g.ShowInCard:g.ShowInSection).map(g=>({type:"crt.MenuItem",caption:g.Caption,clicked:{request:"crt.PrintablesRequest",params:{convertInPDF:g.ConvertInPDF===!0,printableCaption:g.Caption,templateId:g.Id,dataSourceName:a.dataSourceName,filters:a?.filters}}}))})()}_getItemsWithPrintablesRequest(e,t){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",e,t.viewConfig).filter(r=>{const{clicked:a,menuItems:n}=r.viewConfig||{};return!n?.length&&a?.request==="crt.PrintablesRequest"&&a.params?.dataSourceName&&!a.params.templateId})}_noAvailablePrintablesMenuItem(){return{type:"crt.MenuLabel",caption:this._translateService.instant(this._translatePrefix+".NoAvailablePrintablesCaption")}}_goToPrintablesSetupMenuItems(){return this._canManageReports?[{type:"crt.MenuDivider"},{type:"crt.MenuItem",caption:this._translateService.instant(this._translatePrefix+".GoToPrintablesSetupCaption"),icon:"open-button-icon",handleItemClick:()=>{this._goToPrintables()}}]:[]}_goToPrintables(){const e=(0,m.getWorkspaceBaseUrl)();window.open(`${e}ClientApp#/Printables`,"_blank")}_generateInfoMenuItems(){return[this._noAvailablePrintablesMenuItem(),...this._goToPrintablesSetupMenuItems()]}_prepareItemMenu(e,t,i,r){var a=this;return(0,l.Z)(function*(){const n=a._getItemsWithPrintablesRequest(e,i);for(const s of n){let c=yield a._generateMenuItems(s,i,r);c.length===0?c=a._generateInfoMenuItems():c.push(...a._goToPrintablesSetupMenuItems()),s.viewConfig[t]=c,s.viewConfig.clickMode="menu",delete s.viewConfig.clicked}})()}_initCanManageReports(){var e=this;return(0,l.Z)(function*(){e._canManageReports=yield(0,_.firstValueFrom)(e._rightsService.getCanExecuteOperation("CanManageReports"))})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){const a=e;return yield r._initCanManageReports(),yield r._prepareItemMenu("crt.MenuItem","items",a,i),yield r._prepareItemMenu("crt.Button","menuItems",a,i),e})()}static#e=this.\u0275fac=function(t){return new(t||St)(o.\u0275\u0275inject(M.TranslateService),o.\u0275\u0275inject(y.PrintablesService),o.\u0275\u0275inject(y.RightsService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:St,factory:St.\u0275fac})}class At{constructor(e){this.featureService=e,this.featureName="DisableDataGridMoveSelectedItemsProcessing"}_getMoveItemsButtons(e){return(0,Bt.getRequestBindingConfigs)(e.viewConfig,"crt.MoveSelectedItemsRequest")}_generateViewModelAttribute(e,t,i){const r=e?.viewModelConfig?.attributes||{},a=t?.replace(i+"_","");r[t]||(r[t]={modelConfig:{path:`${i}.${a}`}})}_generateDataSourceAttribute(e,t,i){const n=(e?.modelConfig?.dataSources??{})[i]?.config?.attributes,s=t.replace(i+"_","");n[s]||(n[s]={path:s})}_generateMissingAttributes(e,t){const i=e?.params,r=i?.sourceAttribute,a=i?.targetAttribute,n=i?.defaultValues,s=t?.viewModelConfig?.attributes??{},c=s[r],d=s[a],p=c?.modelConfig?.path,g=d?.modelConfig?.path;n?.forEach(b=>{const C=b.attributeName,I=b.value;if(b.type===f.MoveSelectedItemDefaultValueType.Item){const E=typeof b.value=="object"?I.value:I;typeof E=="string"&&this._generateViewModelAttribute(c,E,p),this._generateDataSourceAttribute(t,E,p)}this._generateViewModelAttribute(d,C,g),this._generateDataSourceAttribute(t,C,g)})}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(yield(0,_.lastValueFrom)(t.featureService.getFeatureState(t.featureName),{defaultValue:null}))return e;const r=e;if(!r.viewModelConfig?.attributes)return e;const a=t._getMoveItemsButtons(r);for(const n of a)t._generateMissingAttributes(n,r);return e})()}static#e=this.\u0275fac=function(t){return new(t||At)(o.\u0275\u0275inject(y.FeatureService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:At,factory:At.\u0275fac})}var Si=v(15070);class k{constructor(e){this._resourceFinderService=e,this._dataGridType="crt.DataGrid",this._galleryType="crt.Gallery",this._findAttributeInDataSchema=(t,i)=>t?.attributes?.find(r=>r.name===i)}_getBindedViewElementConfigsByAttributeNames(e,t){return m.MetadataSchemaUtils.getViewConfigInfoByFilter(i=>this._isViewConfigInfoBindedByPropertyValues(i,t.map(r=>`$${r}`)),e.viewConfig).map(i=>i.viewConfig)}_isViewConfigInfoBindedByPropertyValues(e,t){const i=Object.values(e);for(const r of i)if(t.includes(r))return!0;return!1}_getColumnByViewType(e,t,i,r){switch(r.type){case this._dataGridType:return this._getColumnsFromDataGridViewConfig(e,t,i,r);case this._galleryType:return Promise.resolve(this._getColumnsFromGalleryViewConfig(e,t,i,r));default:return Promise.resolve(this._getColumnsFromViewModelConfig(e,t,i))}}_getColumnsFromDataGridViewConfig(e,t,i,r){var a=this;return(0,l.Z)(function*(){const n=[],s=a._getDataSchema(t,i);if(!s)return Promise.resolve(null);const c=r;if(!c.columns)return a._getColumnsFromViewModelConfig(e,t,i);const d=a._getColumnAttributes(e,i);for(const p of c.columns){const g=p.code,b=d?.[g];yield a._addColumnByResourcesIfNeed(s,t,n,p,b)}return{columns:n,viewName:r.name||i,primaryDisplayName:s.primaryDisplayAttributeName}})()}_addColumnByResourcesIfNeed(e,t,i,r,a){var n=this;return(0,l.Z)(function*(){const s=n._getColumnNameFromAttributeConfigPath(a),c=n._findAttributeInDataSchema(e,s);n._isAllowedToAddColumn(c,i,s)&&i.push(yield n._createColumnByResources(t[m.SchemaResourcesSuffix],r.caption,s,c?.path))})()}_getColumnsFromGalleryViewConfig(e,t,i,r){const a=[],n=this._getDataSchema(t,i);if(!n)return null;const s=r?.itemConfig,c=this._getColumnAttributes(e,i);return(0,S.forEach)(s?.templateValuesMapping,(d,p)=>{const g=c?.[d];this._addColumnByDataSchemaIfNeed(n,a,g)}),{columns:a,viewName:r.name||i,primaryDisplayName:n.primaryDisplayAttributeName}}_getColumnsFromViewModelConfig(e,t,i){const r=[],a=this._getDataSchema(t,i);if(!a)return null;const n=this._getColumnAttributes(e,i);return(0,S.forEach)(n,(s,c)=>{this._addColumnByDataSchemaIfNeed(a,r,s)}),{columns:r,viewName:i,primaryDisplayName:a.primaryDisplayAttributeName}}_getDataSchema(e,t){return e.getBoundDataSchemaByAttributePath(t)}_getColumnAttributes(e,t){const i=e.viewModelConfig.attributes;return Object.prototype.hasOwnProperty.call(i,t)?i[t].viewModelConfig?.attributes||{}:{}}_addColumnByDataSchemaIfNeed(e,t,i){const r=this._getColumnNameFromAttributeConfigPath(i),a=this._findAttributeInDataSchema(e,r);this._isAllowedToAddColumn(a,t,r)&&t.push(this._createColumnByDataSchema(a,r))}_getColumnNameFromAttributeConfigPath(e){if(e&&(0,f.isModelAttributeConfig)(e))return e?.modelConfig?.path?.split(".").slice(1).shift()}_isAllowedToAddColumn(e,t,i){return(0,m.isAllowedTypeSearchColumn)(e)&&!!i&&!t.some(r=>r.name===i)}_createColumnByResources(e,t,i,r){var a=this;return(0,l.Z)(function*(){return{caption:(yield a._resourceFinderService.findViewModelResourceValue(t,e,t))||i,name:i,path:r||i}})()}_createColumnByDataSchema(e,t){return{caption:e?.caption||t,name:t,path:e?.path||t}}_getUniqueColumns(e){if(!e.length)return null;const t=[];return e.forEach(i=>{i.columns.forEach(r=>{this._isSearchFilterColumnExist(t,r)||t.push(r)})}),{columns:t,viewName:e.slice().shift()?.viewName||"",primaryDisplayName:e.slice().shift()?.primaryDisplayName}}_isSearchFilterColumnExist(e,t){return e.some(i=>i.caption===t.caption&&i.name===t.name)}getColumnsModelByAttributeName(e,t,i){var r=this;return(0,l.Z)(function*(){const a=r._getBindedViewElementConfigsByAttributeNames(e,[i]);if(a.length===0)return r._getColumnsFromViewModelConfig(e,t,i);const n=(yield Promise.all(a.map(s=>r._getColumnByViewType(e,t,i,s)))).filter(Boolean);return r._getUniqueColumns(n)})()}static#e=this.\u0275fac=function(t){return new(t||k)(o.\u0275\u0275inject(m.ResourceFinderService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:k,factory:k.\u0275fac})}class De extends Si.BaseFilterPreprocessor{constructor(e,t,i,r){super(),this._featureService=e,this._searchFilterPreprocessorService=t,this._searchFilterQueryAnalyzerService=i,this._translateService=r,this._isTargetAttributesExist=(a,n)=>this._getAvailableTargetAttributes(a,n)?.length>0}_getSearchFilterViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.SearchFilter",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_getAvailableTargetAttributes(e,t){return this.isNewStructure(t)?this._getAvailableTargetFromFilterOptions(e,t):this._getAvailableTargetFromTargetAttributes(e,t)}_getAvailableTargetFromTargetAttributes(e,t){return t?.targetAttributes?.map(i=>(0,S.get)(e.viewModelConfig?.attributes||{},i)?i:null).filter(Boolean)||[]}_getAvailableTargetFromFilterOptions(e,t){return t?._filterOptions?.expose?.map(i=>this._getTargetAttributeNameFromConverter(i.converters||[])).filter(Boolean)}_getTargetAttributeNameFromConverter(e){return e.find(i=>i?.args?.length>0)?.args?.find(i=>!!i)??""}_getSearchValueViewModelAttributeName(e){return`${e}_SearchValue`}_getSearchFilteredColumnViewModelAttributeName(e){return`${e}_SearchFilteredColumn`}_getSearchFilteredColumnsGroupsAttributeName(e){return`${e}_FilteredColumnsGroups`}_getSearchMinifySearchAttributeName(e){return`${e}_MinifySearch`}_setDisabledAttribute(e,t){this._isTargetAttributesExist(e,t)||(t.disabled=!0)}_setTooltipAttribute(e){e.tooltip||(e.tooltip=this._translateService.instant("Components.SearchFilter.Tooltip"))}_setSearchValueAttribute(e,t){const i=this._getSearchValueViewModelAttributeName(t.name);this._createViewModelAttribute(e,i),t.value=`$${i}`}_setSearchFilteredColumnAttribute(e,t){const i=this._getSearchFilteredColumnViewModelAttributeName(t.name);this._createViewModelAttribute(e,i),t.filteredColumn=`$${i}`}_setSearchMinifySearchAttribute(e,t){const i=this._getSearchMinifySearchAttributeName(t.name);this._createViewModelAttribute(e,i,t.iconOnly||!1),t.minifySearch=`$${i}`}_setSearchFilteredColumnsGroupsAttribute(e,t){const i=this._getSearchFilteredColumnsGroupsAttributeName(t.name);this._createViewModelAttribute(e,i),t.selectedColumnsGroups=`$${i}`}_createViewModelAttribute(e,t,i=""){const r=e.viewModelConfig.attributes;Object.prototype.hasOwnProperty.call(r,t)||(r[t]={value:i})}_setFilterAttribute(e,t){this.isNewStructure(t)||!this._isTargetAttributesExist(e,t)||this._getAvailableTargetAttributes(e,t).forEach(i=>{this._setFilterConverterAttribute(e,t,i),this.setFilterAttribute(e,t.name,i)})}_setFilterConverterAttribute(e,t,i){const r=e.viewModelConfig.attributes,a=this.getFilterAttributeName(t.name,i),n=this._getSearchFilteredColumnsGroupsAttributeName(t.name),s={from:[this._getSearchValueViewModelAttributeName(t.name),n],converter:`crt.SearchFilterAttributeConverter: '${i}'`};this.createAttributeIfNeed(r,n,{value:[]}),this.createAttributeIfNeed(r,a,s)}_setSearchFilterColumnsGroupsRequest(e,t,i){var r=this;return(0,l.Z)(function*(){if(i.valueChange||!r._isTargetAttributesExist(e,i))return;const a=(yield r._createSearchFilterTargets(e,t,i)).filter(Boolean);if((0,S.isEmpty)(a))return;const s=(yield r._getIsSearchFilterQueryAnalyzerEnabled())?yield r._getIsNeedShowAllOptionForTargets(e,t,a):!0;r._setSearchFilterConfigIntoView(i,a,s),i.valueChange={request:"crt.SearchFilterColumnsGroupsRequest",params:{value:"@event.value",searchFilterColumnsGroups:"@event.columnsGroups",searchFilterGroups:a.map(c=>({filterAttributeName:c.filterAttributeName,viewAttributeName:c.viewAttribute.name})),searchValueAttributeName:r._getSearchValueViewModelAttributeName(i.name),searchFilteredColumnAttributeName:r._getSearchFilteredColumnViewModelAttributeName(i.name),searchFilteredColumnsGroupsAttributeName:r._getSearchFilteredColumnsGroupsAttributeName(i.name)}}})()}_getIsSearchFilterQueryAnalyzerEnabled(){return this._featureService.getFeatureState("SearchFilterQueryAnalyzerEnabled")}_getIsNeedShowAllOptionForTargets(e,t,i){var r=this;return(0,l.Z)(function*(){for(const a of i)if(yield r._getIsNeedOptimization(e,t,a.viewAttribute.name,a.columnsModel.columns))return!1;return!0})()}_getIsNeedOptimization(e,t,i,r){var a=this;return(0,l.Z)(function*(){if(a._isCollectionAttributeHasFixedFilter(e,t,i))return!1;const n=t.getBoundDataSchemaByAttributePath(i)?.name,s=r.map(d=>d.path);return(0,S.isEmpty)(n)||r.length===0?!1:(yield(0,_.firstValueFrom)(a._searchFilterQueryAnalyzerService.analyze(n,s))).isNeedOptimization})()}_isCollectionAttributeHasFixedFilter(e,t,i){let r=!1;const a=e.viewModelConfig.attributes;if(this._isDataSourceHasDependencies(e,t,i))return!0;const n=this.getAttributeModelFilters(a,i);return(0,S.each)(n,s=>(r=this._isPredefineFilterAttribute(a,s.name),!r)),r}_isPredefineFilterAttribute(e,t){const r=e[t]?.value?.filterType;return!!r||r===0}_isDataSourceHasDependencies(e,t,i){const r=t.getBoundDataSourceNameByAttributePath(i);return((e.modelConfig?.dependencies||{})[r]||[]).length>0}_createSearchFilterTargets(e,t,i){return Promise.all(this._getAvailableTargetAttributes(e,i).map(r=>this._createSearchFilterTarget(e,t,i.name,r)))}_createSearchFilterTarget(e,t,i,r){var a=this;return(0,l.Z)(function*(){const n=yield a._getColumnsModel(e,t,r);if(!n)return Promise.resolve(null);const s=`${i}_${r}`,c=a._getDisplayValueForViewAttributeName(t,r,n.viewName);return{columnsModel:n,filterAttributeName:s,viewAttribute:{caption:c,name:r}}})()}_getColumnsModel(e,t,i){return this._searchFilterPreprocessorService.getColumnsModelByAttributeName(e,t,i)}_getDisplayValueForViewAttributeName(e,t,i){const r=e.getBoundDataSchemaByAttributePath(t);return r?`${r.name}${(0,S.isEmpty)(i)?"":" | "+i}`:i}_setSearchFilterConfigIntoView(e,t,i){e.columnsGroupsConfig={showAllOption:i,columnsGroups:t.map(r=>({group:r.viewAttribute,columns:r.columnsModel.columns})),primaryColumnName:t.slice().shift()?.columnsModel.primaryDisplayName}}crtOnMetaDataInit(e){const t=e;return this._getSearchFilterViewConfigs(t).forEach(r=>{this._setDisabledAttribute(t,r),this._setTooltipAttribute(r),this._setSearchValueAttribute(t,r),this._setSearchFilteredColumnAttribute(t,r),this._setFilterAttribute(t,r),this._setSearchMinifySearchAttribute(t,r),this._setSearchFilteredColumnsGroupsAttribute(t,r)}),Promise.resolve(e)}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){const a=e,n=i,s=r._getSearchFilterViewConfigs(a);for(const c of s)yield r._setSearchFilterColumnsGroupsRequest(a,n,c);return e})()}static#e=this.\u0275fac=function(t){return new(t||De)(o.\u0275\u0275inject(h.FeatureService),o.\u0275\u0275inject(k),o.\u0275\u0275inject(u.SearchFilterQueryAnalyzerService),o.\u0275\u0275inject(M.TranslateService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:De,factory:De.\u0275fac})}class bt extends Mt{constructor(e){super(),this._translateService=e,this.viewItemTypes=["crt.DataGrid"]}setRowToolbarMenuItems(e,t){var i=this;return(0,l.Z)(function*(){const r=e.items.slice(1),a=t.getBoundDataSchemaByAttributePath(r)?.name;if(a!=="SimilarLead")return;const n=t.getBoundDataSourceNameByAttributePath(r),s=yield i.hasEntityEditPage(t,a),c=`$${r}.PrimaryModelMode | crt.IsEqual : 'create'`;e.rowToolbarItems=[{type:"crt.MenuItem",caption:i._translateService.instant("DataGrid.RowToolbar.Open"),icon:"edit-row-action",visible:s,disabled:c,clicked:{request:"crt.UpdateRecordRequest",params:{itemsAttributeName:r,recordId:`$${r}.${n}_Id`},useRelativeContext:!0}}]})()}static#e=this.\u0275fac=function(t){return new(t||bt)(o.\u0275\u0275inject(M.TranslateService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:bt,factory:bt.\u0275fac})}class Fe extends D.AbstractHandler{constructor(e){super(),this._profileAttributeService=e}handle(e){const{metadata:t,viewConfig:i}=e??{};return!t||!i?.name?super.handle(e):typeof i.expanded=="boolean"?super.handle(e):(this._profileAttributeService.createOrUpdateAttributeWithChangeRequest(t,i,"expanded",(0,u.createSummariesExpandedAttributeName)(i)),super.handle(e))}static#e=this.\u0275fac=function(t){return new(t||Fe)(o.\u0275\u0275inject(u.ProfileAttributeService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Fe,factory:Fe.\u0275fac})}const Ai={type:"crt.MenuDivider"},bi="CanCreateDefaultSummariesSettings";class Me extends D.AbstractHandler{constructor(e,t,i,r){super(),this._translateService=e,this._summaryItemMetaSettingsCreator=t,this._quickSummaryItemCreationActionsProvider=i,this._rightsService=r}_getDataSourceInfo(e,t,i){return f.DataSourceInfo.getFromViewModelConfig(e.viewModelConfig,t).get(i)}_createQuickSummaryItemMenuItems(e,t,i){return t?.length?t.map(r=>this._createQuickSummaryItemMenuItem(e,r,i)).filter(Boolean):[]}_createQuickSummaryItemMenuItem(e,t,i){return t?.actions?.length?this._createQuickSummaryItemMenuSubMenuItem(e,t,i):this._createQuickSummaryItemMenuActionItem(e,t,i)}_createQuickSummaryItemMenuSubMenuItem(e,t,i){const{name:r,icon:a,caption:n,actions:s}=t;return{type:"crt.MenuItem",name:`${e}_Create_${r}`,icon:a,caption:n,items:this._createQuickSummaryItemMenuItems(e,s,i)}}_createQuickSummaryItemMenuActionItem(e,t,i){const{name:r,icon:a,caption:n,summaryItemOptions:{label:s,expression:c}={}}=t,d=this._summaryItemMetaSettingsCreator.create({label:s,valueExpression:c,modelName:i});return{type:"crt.MenuItem",name:`${e}_Create_${r}`,icon:a,caption:n,clicked:{request:"crt.CreateSummaryItemRequest",params:{resources:d?.resources,summariesName:e,summaryItemViewConfig:d?.viewConfig}}}}_createQuickSummaryItemMenuItemsSection(e){var t=this;return(0,l.Z)(function*(){const{metadata:i,models:r,viewConfig:a}=e,n=a?.name,s=a?._designOptions?.modelName;if(!i||!s||!n)return[];const c=r?.find(I=>I.name===s),d=t._getDataSourceInfo(i,r,s);if(!c||!d)return[];const p=yield(0,_.lastValueFrom)(c.getSchema()),g=t._quickSummaryItemCreationActionsProvider.getActionsGroups(p,d),b=g?.flat()?.length,C=g.map(I=>t._createQuickSummaryItemMenuItems(n,I,s)).filter(I=>I?.length).map((I,E,Nt)=>E===Nt.length-1?I:[...I,Ai]).flat();return b?[{type:"crt.MenuLabel",caption:t._translateService.instant("Summaries.QuickSummaries.QuickSetup")},...C,{type:"crt.MenuDivider"}]:[]})()}_createAdvancedSetupActions(e){const{name:t}=e;return[{type:"crt.MenuLabel",caption:this._translateService.instant("Summaries.AdvancedSetup.Title")},{type:"crt.MenuItem",name:`${t}_AddCustomSummary`,icon:"add-button-icon",caption:this._translateService.instant("Summaries.AdvancedSetup.Actions.AddCustomSummary"),clicked:{request:"crt.AddSummaryItemRequest",params:{summariesName:t}}},{type:"crt.MenuDivider"}]}_getProfileActions(e){var t=this;return(0,l.Z)(function*(){if(!e)return[];const i=[{type:"crt.MenuItem",caption:t._translateService.instant("Summaries.ProfileActions.ResetToDefault"),icon:"reset-summaries",clicked:{request:"crt.ResetSummariesRequest",params:{summariesName:e}}}];return(yield t._rightsService.getCanExecuteOperation(bi))&&i.unshift({type:"crt.MenuItem",caption:t._translateService.instant("Summaries.ProfileActions.SaveForAll"),icon:"save",clicked:{request:"crt.SaveSummariesForAllRequest",params:{summariesName:e}}}),i})()}handle(e){var t=()=>super.handle,i=this;return(0,l.Z)(function*(){const r=e.viewConfig;if(!r?.name||r.actions||r.readonly===!0)return t().call(i,e);const a=yield i._getProfileActions(r.name),n=yield i._createQuickSummaryItemMenuItemsSection(e),s=i._createAdvancedSetupActions(r);return r.actions=[...n,...s,...a],t().call(i,e)})()}static#e=this.\u0275fac=function(t){return new(t||Me)(o.\u0275\u0275inject(M.TranslateService),o.\u0275\u0275inject(u.SummaryItemMetaSettingsCreator),o.\u0275\u0275inject(u.QuickSummaryItemCreationActionsProvider),o.\u0275\u0275inject(h.RightsService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Me,factory:Me.\u0275fac})}class Re extends D.AbstractHandler{constructor(e){super(),this._translateService=e}handle(e){const t=e?.viewConfig;return t?Boolean(t._designOptions?.modelName)?super.handle(e):(typeof t.title=="string"||(t.title=this._translateService.instant("Summaries.Hints.NoDataSource")),typeof t.disabled=="boolean"||(0,A.isBindingExpression)(t.disabled)||(t.disabled=!0),super.handle(e)):super.handle(e)}static#e=this.\u0275fac=function(t){return new(t||Re)(o.\u0275\u0275inject(M.TranslateService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Re,factory:Re.\u0275fac})}class Pe extends D.AbstractHandler{constructor(e,t){super(),this._featureValues=e,this._licenseOperationValues=t}handle(e){const t=e?.viewConfig,i=this._licenseOperationValues[u.CAN_MANAGE_SUMMARIES_LICENSE_OPERATION_CODE];return this._featureValues.DisableSummariesRestrictionsPreprocessing||i||!t?super.handle(e):(t.readonly=!0,super.handle(e))}static#e=this.\u0275fac=function(t){return new(t||Pe)(o.\u0275\u0275inject(m.FEATURE_VALUES),o.\u0275\u0275inject(y.LICENSE_RESTRICTION_OPERATION_VALUES))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Pe,factory:Pe.\u0275fac})}class Oe extends D.AbstractHandler{constructor(e){super(),this._translateService=e}handle(e){const t=e?.viewConfig;return!t?.name||t.actions||t.readonly===!0?super.handle(e):(t.actions=[{type:"crt.MenuItem",name:`${t.name}_EditAction`,caption:this._translateService.instant("SummaryItem.Actions.Edit"),icon:"pen",clicked:{request:"crt.EditSummaryItemRequest",params:{name:t.name}}},{type:"crt.MenuItem",name:`${t.name}_DeleteAction`,caption:this._translateService.instant("SummaryItem.Actions.Delete"),icon:"delete-button-icon",clicked:{request:"crt.RemoveViewElementRequest",params:{name:t.name}}}],super.handle(e))}static#e=this.\u0275fac=function(t){return new(t||Oe)(o.\u0275\u0275inject(M.TranslateService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Oe,factory:Oe.\u0275fac})}const Xt=new o.InjectionToken("Represents a handler to process summaries metadata on metadata init"),Kt=new o.InjectionToken("Represents a handler to process summaries metadata on model init"),ei=new o.InjectionToken("Represents a handler to process summary item metadata on metadata init"),ti=new o.InjectionToken("Represents a factory for creating summary item value format");class Ve extends D.AbstractHandler{constructor(e){super(),this._valueFormatFactory=e}_isValidValueOptions(e){return Boolean(e&&e.attribute&&e.modelName&&e.expression&&e.expression.function&&e.expression.columns)}handle(e){const{metadata:t,viewConfig:i}=e??{};if(!t||!i?.name||i.value!==void 0)return super.handle(e);const r=i._designOptions?.value;if(!this._isValidValueOptions(r))return super.handle(e);const{attribute:a,expression:n,modelName:s}=r,c=(0,u.createSummaryItemTargetAttributeName)(i),d=(0,u.createSummaryItemModelAttributeName)(i),p=n.resultDataValueType??h.DataValueType.Text,g=`${r.attribute}_Format`,b=`${r.attribute}_ExecutionResult`,C=`${r.attribute}_ExecutionError`,I=`${r.attribute}_ExpressionOptions`;return i.value=`$${a}`,i.error=`$${C}`,t.viewModelConfig??={},t.viewModelConfig.attributes={...t.viewModelConfig.attributes??{},[b]:{converter:`crt.SummaryItemToExpressionMetadata : $${d} : $${I} | crt.ToExpressionResult`,triggers:[{request:"crt.UpdateSummaryItemValueRequest",filter:`crt.ToObjectProp : 'target' | crt.IsTargetSummaryItem : $${c}`}],triggersOptions:{debounce:100}},[C]:{from:b,converter:"crt.ToObjectProp: 'errorInfo'"},[a]:{from:b,converter:`crt.ToObjectProp: 'result' | crt.FormatValue : $${g} | crt.ToEmptyPlaceholder : ${p}`},[g]:{value:this._valueFormatFactory.create(p)},[I]:{value:{...n,resultDataValueType:p}},[d]:{value:s},[c]:{value:{modelName:s,viewElementName:i.name}}},super.handle(e)}static#e=this.\u0275fac=function(t){return new(t||Ve)(o.\u0275\u0275inject(ti))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ve,factory:Ve.\u0275fac})}class we extends D.AbstractHandler{constructor(e,t){super(),this._featureValues=e,this._licenseOperationValues=t}handle(e){const t=e?.viewConfig,i=this._licenseOperationValues[u.CAN_MANAGE_SUMMARIES_LICENSE_OPERATION_CODE];return this._featureValues.DisableSummariesRestrictionsPreprocessing||i||!t?super.handle(e):(t.readonly=!0,super.handle(e))}static#e=this.\u0275fac=function(t){return new(t||we)(o.\u0275\u0275inject(m.FEATURE_VALUES),o.\u0275\u0275inject(y.LICENSE_RESTRICTION_OPERATION_VALUES))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:we,factory:we.\u0275fac})}class Ct extends Yt{constructor(e,t,i){super(),this._summariesOnMetadataInitHandler=e,this._summariesOnModelInitHandler=t,this._summaryItemOnMetadataInitHandler=i}_removeSummaryItemsWithoutParent(e){e.viewConfig=(e?.viewConfig||[]).filter(t=>t.type!=="crt.SummaryItem")}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){const i=e;return t._removeSummaryItemsWithoutParent(i),t._summariesOnMetadataInitHandler&&(yield t.processElementsOnMetadataInit("crt.Summaries",t._summariesOnMetadataInitHandler,i)),t._summaryItemOnMetadataInitHandler&&(yield t.processElementsOnMetadataInit("crt.SummaryItem",t._summaryItemOnMetadataInitHandler,i)),Promise.resolve(e)})()}crtOnModelInit(e,t){var i=this;return(0,l.Z)(function*(){const r=e;return i._summariesOnModelInitHandler&&(yield i.processElementsOnModelInit("crt.Summaries",i._summariesOnModelInitHandler,r,t)),Promise.resolve(e)})()}static#e=this.\u0275fac=function(t){return new(t||Ct)(o.\u0275\u0275inject(Xt,8),o.\u0275\u0275inject(Kt,8),o.\u0275\u0275inject(ei,8))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ct,factory:Ct.\u0275fac})}const Ci=D.FactoryProvider.create({token:ti,mappings:[{predicate:T=>(0,S.without)(m.NUMERIC_DATA_VALUE_TYPES,h.DataValueType.Money).includes(T),useFactory:T=>({dataType:T,trimTrailingZeros:!0})}],default:{useFactory:T=>({dataType:T})}});class $e{static#e=this.\u0275fac=function(t){return new(t||$e)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:$e});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Ct,multi:!0},{provide:Xt,useFactory:e=>{const t=e.get(Re);return t.setNext(e.get(Fe)).setNext(e.get(Pe)),t},deps:[o.Injector]},{provide:Kt,useFactory:e=>e.get(Me),deps:[o.Injector]},{provide:ei,useFactory:e=>{const t=e.get(we);return t.setNext(e.get(Ve)).setNext(e.get(Oe)),t},deps:[o.Injector]},Fe,Re,Me,Oe,Ve,Pe,we,Ci],imports:[u.QuickSummaryItemCreationActionsModule]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope($e,{imports:[u.QuickSummaryItemCreationActionsModule]})})();class yt{constructor(e,t){this._featureService=e,this._profileAttributeService=t,this._tabPanelActionsProcessingDisableFeature="DisableTabPanelPreprocessing"}_updateIconPosition(e){if(e.iconPosition)return;const t=!!e.icon;e.iconPosition=t?x.IconPositionEnum.LeftIcon:x.IconPositionEnum.OnlyText}_updateTabIconSource(e){u.TabItem.updateTabIconSource(e)}_updateTabHint(e){e.hint=e.caption}_getTabContainerHeader(e){const t=this._getTabPanelHeaderItemInputs();return{type:"crt.TabPanelHeader",tabs:e.items?.map(i=>({...Object.fromEntries(t.filter(r=>typeof i[r]<"u").map(r=>[r,i[r]])),type:"crt.TabPanelHeaderItem",name:i.name,titleColor:e.tabTitleColor,selectedTitleColor:e.selectedTabTitleColor,styleType:e.styleType}))}}_getTabContainerBody(e){const t=e.allowToggleClose??!0,i=e.mode==="toggle"?t:!1;return{type:"crt.ToggleContainer",preserveContent:e.preserveContent??!0,slidingAnimation:e.slidingAnimation??!1,items:e.items?.map(r=>({...r,type:"crt.ToggleContainerItem",backgroundColor:e.bodyBackgroundColor,isToggleTabHeaderVisible:r.isToggleTabHeaderVisible??!1,allowToggleClose:i})),visibilityStrategyMode:e.visibilityStrategyMode}}_getTabPanelHeaderItemInputs(){return Object.keys(h.ViewElementRegistry.viewElements.get("crt.TabPanelHeaderItem")?.inputs??{})}get isProcessingDisabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(this._tabPanelActionsProcessingDisableFeature))}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){const i=e;if(!(yield t.isProcessingDisabled)){m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TabContainer",i.viewConfig).forEach(n=>{t._updateIconPosition(n.viewConfig),t._updateTabIconSource(n.viewConfig),t._updateTabHint(n.viewConfig)});const a=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TabPanel",i.viewConfig);for(const n of a){const s=n.viewConfig;yield t._profileAttributeService.prepareAttributeWithFeatureCheck(i,s,"selectedTabIndex","","DisableSaveToProfileSelectedTabIndex");const c=t._getTabContainerBody(s),d=t._getTabContainerHeader(s);if(s.mode==="toggle"){const p={...c,name:s.name,visible:s.visible,selectedTab:s.selectedTab,layoutConfig:s.layoutConfig||{},stretch:s.stretch,classes:s.classes,fitContent:s.fitContent},g=s.isToggleTabHeaderVisible??!0;p.items?.forEach(b=>{b.isToggleTabHeaderVisible=g}),Object.keys(s).forEach(b=>delete s[b]),Object.assign(s,p)}else s.items=[d,c]}}return e})()}static#e=this.\u0275fac=function(t){return new(t||yt)(o.\u0275\u0275inject(y.FeatureService),o.\u0275\u0275inject(u.ProfileAttributeService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:yt,factory:yt.\u0275fac})}class yi{constructor(){this._dataSchemaRepository=(0,o.inject)(f.DataSchemaRepositoryService)}setupSelect(e,t){var i=this;return(0,l.Z)(function*(){!i.isCanSetupSelect(e,t)||(yield i.initializeSchemasNames(t),i.isCanRunSetupSelectData(t)&&(yield i.setupDataViewModel(e,t),yield i.setupInputs(t),yield i.setupRequests(t)))})()}isCanSetupSelect(e,t){return!!t.selectSchemaName&&!!t.selectColumnName&&this.isViewModelAttributeExist(e,t.recordId)}isViewModelAttributeExist(e,t){if(!t)return!1;const i=Object.keys(e.viewModelConfig?.attributes||{}),r=this.getAttributeName(t);return i.includes(r)}getAttributeName(e){return(0,A.isBindingExpression)(e)?e.slice(1):e}initializeSchemasNames(e){var t=this;return(0,l.Z)(function*(){yield t.initializeSelectSchemaName(e),yield t.initializeListSchemaName(e)})()}initializeSelectSchemaName(e){}initializeListSchemaName(e){var t=this;return(0,l.Z)(function*(){if(!e.selectColumnName)return;const r=(yield t.getSelectDataSchema(e)).findAttributeByName(e.selectColumnName);e.listSchemaName=r?.referenceSchemaName})()}isCanRunSetupSelectData(e){return!!e.selectSchemaName&&!!e.listSchemaName}setupDataViewModel(e,t){var i=this;return(0,l.Z)(function*(){yield i.createAndAddItemsViewModelAttributeData(e,t),yield i.createAndAddListItemsViewModelAttributeData(e,t)})()}createAndAddItemsViewModelAttributeData(e,t){var i=this;return(0,l.Z)(function*(){yield i.createAndAddItemsViewModelAttribute(e,t),i.createAndAddItemsViewModelSortingAttribute(e,t),i.createAndAddItemsViewModelFilterAttribute(e,t),i.createAndAddItemsViewModelFilterConfigAttribute(e,t)})()}createAndAddItemsViewModelAttribute(e,t){var i=this;return(0,l.Z)(function*(){const r=yield i.getSelectDataSchema(t),a=yield i.getListDataSchema(t),n=i.createItemsAttribute(t,r);i.addItemsAttributeViewModelConfig(n,t,r,a),i.addItemsEmbeddedDataSource(n,t),i.addItemsAttributeToViewModelConfig(e,t,n)})()}createItemsAttribute(e,t){const i=this.getItemsDataSourceName(e),r=this.getItemsFilterAttributeName(e);return(0,S.merge)(this.createCollectionAttribute(i),{modelConfig:{sortingConfig:this.getItemsSortingConfig(e,t),filterAttributes:[{name:r,loadOnChange:!0}]}})}createCollectionAttribute(e){return{isCollection:!0,modelConfig:{path:e}}}getItemsSortingConfig(e,t){return{default:[{columnName:"CreatedOn",direction:"desc"}],attributeName:this.getItemsSortingAttributeName(e)}}addItemsAttributeViewModelConfig(e,t,i,r){const a=this.getItemsDataSourceName(t),n=t.selectColumnName,s=r.primaryAttributeName,c=r.primaryDisplayAttributeName,d=r.primaryColorAttributeName,p={RelationRecordId:{modelConfig:{path:`${a}.${i.primaryAttributeName}`}},[s]:{modelConfig:{path:`${a}.${n}.${s}`}},[c]:{modelConfig:{path:`${a}.${n}.${c}`}}};d&&(p[d]={modelConfig:{path:`${a}.${n}.${d}`}}),e.viewModelConfig={attributes:p}}addItemsEmbeddedDataSource(e,t){const i=this.getItemsDataSourceName(t),r=t.selectSchemaName;e.embeddedModel=this.createEmbeddedDataSource(i,r)}createEmbeddedDataSource(e,t){return{name:e,config:{type:"crt.EntityDataSource",config:{entitySchemaName:t},hiddenInPageDesigner:!1}}}addItemsAttributeToViewModelConfig(e,t,i){this.addViewModelConfigAttribute(e,this.getItemsAttributeName(t),i)}addViewModelConfigAttribute(e,t,i){!e?.viewModelConfig?.attributes||e.viewModelConfig.attributes[t]||(e.viewModelConfig.attributes[t]=i)}createAndAddItemsViewModelSortingAttribute(e,t){const i=this.createSortingAttributeConfig(),r=this.getItemsSortingAttributeName(t);this.addViewModelConfigAttribute(e,r,i)}createAndAddItemsViewModelFilterAttribute(e,t){const i=this.createItemsViewModelFilterAttribute(t),r=this.getItemsFilterAttributeName(t);this.addViewModelConfigAttribute(e,r,i)}createItemsViewModelFilterAttribute(e){const t=this.getAttributeName(e.recordId),i=this.getItemsFilterConfigAttributeName(e);return{from:t,converter:`crt.BaseSelectFilterAttributeConverter: $${i}`}}createAndAddItemsViewModelFilterConfigAttribute(e,t){const i={value:{selectSchemaName:t.selectSchemaName,selectColumnName:t.selectColumnName,recordRelationColumnName:t.recordRelationColumnName}},r=this.getItemsFilterConfigAttributeName(t);this.addViewModelConfigAttribute(e,r,i)}createAndAddListItemsViewModelAttributeData(e,t){var i=this;return(0,l.Z)(function*(){yield i.createAndAddListItemsViewModelAttribute(e,t),i.createAndAddListItemsViewModelSortingAttribute(e,t),i.createAndAddListItemsViewModelFilterAttribute(e,t)})()}createAndAddListItemsViewModelAttribute(e,t){var i=this;return(0,l.Z)(function*(){const r=yield i.getListDataSchema(t),a=i.createListItemsAttribute(t,r);i.addListItemsAttributeViewModelConfig(a,t,r),i.addListItemsEmbeddedDataSource(a,t),i.addListItemsAttributeToViewModelConfig(e,t,a)})()}getSelectDataSchema(e){const t=e.selectSchemaName;return this.getDataSchema(t)}getListDataSchema(e){const t=e.listSchemaName;return this.getDataSchema(t)}getDataSchema(e){return(0,_.lastValueFrom)(this._dataSchemaRepository.get(e))}createListItemsAttribute(e,t){const i=this.getListItemsDataSourceName(e),r=this.getListItemsFilterAttributeName(e),a={sortingConfig:this.getListItemsSortingConfig(e,t),filterAttributes:[{name:r,loadOnChange:!0}],pagingConfig:{rowCount:30}};return(0,S.merge)(this.createCollectionAttribute(i),{isLookup:!0,modelConfig:a})}getListItemsSortingConfig(e,t){return{default:[this.getDefaultSortingColumn(t)],attributeName:this.getListItemsSortingAttributeName(e)}}getDefaultSortingColumn(e){return{columnName:e.primaryDisplayAttributeName,direction:"asc"}}addListItemsAttributeViewModelConfig(e,t,i){const r=this.getListItemsDataSourceName(t),a={value:{modelConfig:{path:`${r}.${i.primaryAttributeName}`}},displayValue:{modelConfig:{path:`${r}.${i.primaryDisplayAttributeName}`}}};i.primaryColorAttributeName&&(a.primaryColorValue={modelConfig:{path:`${r}.${i.primaryColorAttributeName}`}}),e.viewModelConfig={attributes:a}}addListItemsEmbeddedDataSource(e,t){const i=this.getListItemsDataSourceName(t),r=t.listSchemaName;e.embeddedModel=this.createEmbeddedDataSource(i,r)}addListItemsAttributeToViewModelConfig(e,t,i){this.addViewModelConfigAttribute(e,this.getListItemsAttributeName(t),i)}createAndAddListItemsViewModelSortingAttribute(e,t){const i=this.createSortingAttributeConfig(),r=this.getListItemsSortingAttributeName(t);this.addViewModelConfigAttribute(e,r,i)}createSortingAttributeConfig(){return{isCollection:!0,viewModelConfig:{attributes:{columnName:{},direction:{}}}}}createAndAddListItemsViewModelFilterAttribute(e,t){const i=this.createListItemsViewModelFilterAttribute(t),r=this.getListItemsFilterAttributeName(t);this.addViewModelConfigAttribute(e,r,i)}createListItemsViewModelFilterAttribute(e){return{value:null}}setupInputs(e){this.setItemsAttributeValue(e),this.setListItemsAttributeValue(e)}setItemsAttributeValue(e){if(e.items)return;const t=this.getItemsAttributeName(e);e.items=`$${t}`}setListItemsAttributeValue(e){if(e.listItems)return;const t=this.getListItemsAttributeName(e);e.listItems=`$${t}`}setupRequests(e){this.setShowListRequest(e),this.setPaginationChangeRequest(e)}setShowListRequest(e){if(e.showList)return;const t=this.getListItemsDataSourceName(e),i=this.createLoadDataRequestConfig(t);i.params={...i.params,config:{loadType:h.DataSourceLoadType.Reload}},e.showList=i}setPaginationChangeRequest(e){if(e.paginationChange)return;const t=this.getListItemsDataSourceName(e);e.paginationChange=this.createLoadDataRequestConfig(t)}createLoadDataRequestConfig(e){return{request:"crt.LoadDataRequest",params:{dataSourceName:e,primaryDisplayFilterValue:"@event.primaryDisplayFilterValue",parameters:[]},useRelativeContext:!0}}getItemsAttributeName(e){return`${e.name}_Items`}getItemsSortingAttributeName(e){return`${this.getItemsAttributeName(e)}_Sorting`}getItemsFilterAttributeName(e){return`${this.getItemsAttributeName(e)}_Filter`}getItemsFilterConfigAttributeName(e){return`${this.getItemsAttributeName(e)}_Filter_Config`}getItemsDataSourceName(e){return`${this.getItemsAttributeName(e)}_DS`}getListItemsAttributeName(e){return`${e.name}_List_Items`}getListItemsSortingAttributeName(e){return`${this.getListItemsAttributeName(e)}_Sorting`}getListItemsFilterAttributeName(e){return`${this.getListItemsAttributeName(e)}_Filter`}getListItemsDataSourceName(e){return`${this.getListItemsAttributeName(e)}_DS`}}class Be extends yi{constructor(){super(...arguments),this._userInfo=(0,o.inject)(m.UserInfo),this._tagRightsService=(0,o.inject)(u.TagRightsService),this._allowedTagAccessesForTaggingIds=[]}_getTagSelectViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.TagSelect",e.viewConfig).map(t=>t?.viewConfig).filter(Boolean)}_prepareDataForTagSelects(e){var t=this;return(0,l.Z)(function*(){let i=!1;e.forEach(r=>(0,u.isOldStructure)(r)?null:i=!0),i&&(yield t._prepareAllowedTagAccessesForTagging())})()}_processTagSelect(e,t,i){var r=this;return(0,l.Z)(function*(){if(!r._isRecordIdViewModelAttributeExist(e,t)){r._setTagSelectDisabled(t);return}yield r._setTagSelectRecordSchemaName(e,t,i),r._setTagSelectDisabledAttribute(e,t),yield r.setupSelect(e,t)})()}_setTagSelectDisabledAttribute(e,t){if(!this._isTagSelectDisabledAttributeFilled(t)){if(!this._isTagSelectRecordSchemaNameFilled(t)){this._setTagSelectDisabled(t);return}this._createAndAddTagSelectViewModelDisabledAttribute(e,t),t.disabled=`$${this._getTagSelectDisabledAttributeName(t)}`}}_setTagSelectDisabled(e){e.disabled=!0}_isTagSelectDisabledAttributeFilled(e){return"disabled"in e}_createAndAddTagSelectViewModelDisabledAttribute(e,t){const i=this.getAttributeName(t.recordId),r={from:i,converter:`crt.TagSelectDisabledAttributeConverter: '${i}'`},a=this._getTagSelectDisabledAttributeName(t);this.addViewModelConfigAttribute(e,a,r)}_isRecordIdViewModelAttributeExist(e,t){return this.isViewModelAttributeExist(e,t.recordId)}_setCreateTagRequest(e){var t=this;return(0,l.Z)(function*(){if(e.createTag)return;const i=yield t.getListDataSchema(e),r=t.getListItemsAttributeName(e);e.createTag=(0,u.isOldStructure)(e)?t._getCreateTagRequestForOldtructure(e,i):t._getCreateTagRequestForNewStructure(e,i,r)})()}_getCreateTagRequestForOldtructure(e,t){return{request:"crt.OpenOldTagMiniPageRequest",params:{entitySchemaName:e.listSchemaName,action:h.ModelInPageAction.Add,defaultValues:[{attributeName:t.primaryDisplayAttributeName,value:"@event.primaryDisplayFilterValue"}]}}}_getCreateTagRequestForNewStructure(e,t,i){return{request:"crt.CreateRecordRequest",params:{itemsAttributeName:i,defaultValues:[{attributeName:t.primaryDisplayAttributeName,value:"@event.primaryDisplayFilterValue"},{attributeName:u.TAG_ENTITY_SCHEMA_NAME_PAGE_ATTRIBUTE_NAME,value:e.recordSchemaName}],skipUnsavedData:!0}}}_setEditTagRequest(e){e.editTag||(e.editTag=(0,u.isOldStructure)(e)?this._getEditTagRequestForOldStructure(e):this._getEditTagRequestForNewStructure(e))}_getEditTagRequestForOldStructure(e){return{request:"crt.OpenOldTagMiniPageRequest",params:{entitySchemaName:e.listSchemaName,action:h.ModelInPageAction.Edit,recordId:"@event.id"}}}_getEditTagRequestForNewStructure(e){return{request:"crt.UpdateRecordRequest",params:{recordId:"@event.id",itemsAttributeName:this.getListItemsAttributeName(e),trackUnsavedData:!1}}}_setDeleteTagRequest(e){e.deleteTag||(e.deleteTag={request:(0,u.isOldStructure)(e)?"crt.DeleteOldTagRecordRequest":"crt.DeleteRecordRequest",params:{recordId:"@event.id",itemsAttributeName:this.getListItemsAttributeName(e)}})}_setAddTagsInRecordRequest(e){if(e.addTagsInRecord)return;const t=this.getItemsDataSourceName(e);e.addTagsInRecord={request:"crt.AddTagsInRecordRequest",params:{dataSourceName:t,tagIds:"@event.tagIds",recordId:e.recordId,recordSchemaName:e.recordSchemaName,tagInRecordSourceSchemaName:e.tagInRecordSourceSchemaName}}}_setDeleteTagInRecordRequest(e){if(e.deleteTagInRecord)return;const t=this.getItemsDataSourceName(e);e.deleteTagInRecord={request:"crt.DeleteTagInRecordRequest",params:{dataSourceName:t,id:"@event.id"}}}_setTagSelectRecordSchemaName(e,t,i){var r=this;return(0,l.Z)(function*(){if(r._isTagSelectRecordSchemaNameFilled(t))return;const a=yield r._getRecordSchemaName(e,t,i);!a||(t.recordSchemaName=a)})()}_isTagSelectRecordSchemaNameFilled(e){return!!e.recordSchemaName}_getRecordSchemaName(e,t,i){if(!e?.viewModelConfig?.attributes||!i?.length)return Promise.resolve(null);const[r,a]=this._getRecordIdAttributeModelPaths(e.viewModelConfig.attributes,t.recordId);return this._getRecordSchemaNameFromModel(r,a,i)}_getRecordIdAttributeModelPaths(e,t){const i=this.getAttributeName(t),n=e[i]?.modelConfig?.path?.split(".");return!n||n.length<2?["",""]:[n[0],n[1]]}_getRecordSchemaNameFromModel(e,t,i){var r=this;return(0,l.Z)(function*(){if(!e||!t)return null;const a=i.find(p=>p.name===e);if(!a)return null;const n=yield(0,_.lastValueFrom)(a.getSchema()),s=n.findAttributeByName(t);if(!s)return null;const c=s.referenceSchemaName??null,d=n.dataSourceConfig?.config?.entitySchemaName;return c||r._getEntitySchemaNameFromDataSchema(d,s)})()}_getEntitySchemaNameFromDataSchema(e,t){if(t.attributeType===h.DataSchemaAttributeType.OwnAttribute)return Promise.resolve(e);const i=t.path.split(".");return this._findEntitySchemaNameByColumnPath(e,i)}_findEntitySchemaNameByColumnPath(e,t){var i=this;return(0,l.Z)(function*(){if(!e)return null;const r=t.shift();if(!r)return e;const n=(yield i.getDataSchema(e)).attributes.find(s=>s.name===r);return n?.referenceSchemaName?i._findEntitySchemaNameByColumnPath(n.referenceSchemaName,t):e})()}_getTagSelectDisabledAttributeName(e){return`${e.name}_Disabled`}_prepareViewConfig(e){e.selectSchemaName=this._getSelectSchemaName(e),e.selectColumnName=u.DEFAULT_TAG_COLUMN_NAME_TAG_IN_RECORD_SCHEMA,e.recordRelationColumnName=this._getRecordRelationColumnName(e)}_getSelectSchemaName(e){return(0,u.isOldStructure)(e)?e.tagInRecordSourceSchemaName:u.DEFAULT_TAG_IN_RECORD_SOURCE_SCHEMA_NAME}_getRecordRelationColumnName(e){return(0,u.isOldStructure)(e)?u.OLD_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA:u.DEFAULT_RECORD_COLUMN_NAME_TAG_IN_RECORD_SCHEMA}_prepareAllowedTagAccessesForTagging(){var e=this;return(0,l.Z)(function*(){e._allowedTagAccessesForTaggingIds=yield(0,u.getAllowedTagAccessesForTagging)(e._tagRightsService)})()}setupSelect(e,t){var i=()=>super.setupSelect,r=this;return(0,l.Z)(function*(){!r._isTagSelectRecordSchemaNameFilled(t)||(r._prepareViewConfig(t),yield i().call(r,e,t))})()}setupRequests(e){var t=()=>super.setupRequests,i=this;return(0,l.Z)(function*(){yield t().call(i,e),yield i._setCreateTagRequest(e),i._setEditTagRequest(e),i._setDeleteTagRequest(e),i._setAddTagsInRecordRequest(e),i._setDeleteTagInRecordRequest(e)})()}createItemsViewModelFilterAttribute(e){return{from:this.getAttributeName(e.recordId),converter:`crt.TagSelectFilterAttributeConverter: '${e.recordSchemaName}' : ${(0,u.isOldStructure)(e)}`}}createListItemsViewModelFilterAttribute(e){return{value:(0,u.isOldStructure)(e)?(0,u.createOldTagListFilter)(this._userInfo):(0,u.createTagListFilter)([e.recordSchemaName],this._allowedTagAccessesForTaggingIds)}}crtOnModelInit(e,t){var i=this;return(0,l.Z)(function*(){const r=e,a=i._getTagSelectViewConfigs(r);return yield i._prepareDataForTagSelects(a),yield Promise.all(a.map(n=>i._processTagSelect(r,n,t))),e})()}static#e=this.\u0275fac=function(){let e;return function(i){return(e||(e=o.\u0275\u0275getInheritedFactory(Be)))(i||Be)}}();static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Be,factory:Be.\u0275fac})}class It{_modifyInputType(e,t,i){const r=e.control.replace("$",""),a=t.attributes[r]?.modelConfig?.path;if(a){const n=this._getDataSchemaAttributeByPath(a,i);h.DataValueType.WEB_TEXT&&n?.dataValueType===h.DataValueType.WEB_TEXT&&(e.type="crt.WebInput")}}_getDataSchemaAttributeByPath(e,t){const[i,r]=e.split("."),a=t.dataSchemas[i]?.attributes;let n;for(const s in a)if(a[s].path===r){n=a[s];break}return n}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){const a=e,n=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.Input",a.viewConfig),s=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.WebInput",a.viewConfig);return n.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),s.forEach(c=>{r._modifyInputType(c.viewConfig,a.viewModelConfig,i)}),e})()}static#e=this.\u0275fac=function(t){return new(t||It)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:It,factory:It.\u0275fac})}var N=v(78094);const Ii={type:"string",maxLinesCount:2,maxLineLength:10},vi={type:"number",thousandAbbreviation:{enabled:!0}},ii="DISABLE_CHART_WIDGET_AXES_FORMATTING_ADAPTATION";class Ge{constructor(e,t,i){this._entitySchemaService=t,this._entitySchemaProvider=i,this._isAdaptionDisabled=Boolean(e[ii])}_getWidgetViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",["crt.ChartWidget"],e).map(t=>t?.viewConfig)}_adaptAxesFormatting(e){var t=this;return(0,l.Z)(function*(){const{scales:i,series:r}=e?.config??{},a=i?.xAxis??{};!t._isDefaultXAxisFormat(a)||!(yield t._isAllSeriesGroupingByNumericColumn(r))||(a.formatting=vi)})()}_isDefaultXAxisFormat(e){return(0,S.isEqual)(e?.formatting,Ii)}_isAllSeriesGroupingByNumericColumn(e){var t=this;return(0,l.Z)(function*(){if(!e?.length)return!1;for(const i of e)if(!(yield t._isSeriesGroupingByNumericColumn(i)))return!1;return!0})()}_isSeriesGroupingByNumericColumn(e){var t=this;return(0,l.Z)(function*(){const{schemaName:i,grouping:r}=e?.data?.providing??{};if(r?.type!==N.ChartGroupingType.ByValue)return!1;const a=r.column?.expression?.columnPath;if(!i||!a)return!1;const n=yield(0,_.firstValueFrom)(t._entitySchemaProvider.getSchemaByName(i)),s=yield(0,_.firstValueFrom)(t._entitySchemaService.getEntitySchemaColumnsInformationByPath(n.uId,a));return m.NUMERIC_DATA_VALUE_TYPES.includes(s?.dataValueType)})()}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(t._isAdaptionDisabled)return e;const i=e,r=t._getWidgetViewConfigs(i.viewConfig).map(a=>t._adaptAxesFormatting(a));return yield Promise.all(r),e})()}static#e=this.\u0275fac=function(t){return new(t||Ge)(o.\u0275\u0275inject(m.FEATURE_VALUES),o.\u0275\u0275inject(m.EntitySchemaService),o.\u0275\u0275inject(m.EntitySchemaProvider))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Ge,factory:Ge.\u0275fac})}const Gt=new o.InjectionToken("Represents a factory of widget data providing metadata compressors"),ri=new o.InjectionToken("Represents a list of widget element types that support data source");class Le{constructor(e,t,i){this._featureService=e,this._widgetDataProvidingMetadataCompressorFactory=i,this._supportedDataSourceWidgetElementTypes=t??[]}_isWidgetDataSourceSupported(){const e=this._featureService.getFeatureState(N.DISABLE_SUPPORT_WIDGET_DATA_SOURCE_FEATURE_NAME).pipe((0,P.first)(),(0,P.map)(Boolean),(0,P.map)(t=>!t));return(0,_.lastValueFrom)(e)}_getWidgetViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this._supportedDataSourceWidgetElementTypes,e).map(t=>t?.viewConfig).filter(t=>Boolean(t?.name)&&Boolean(t?.config))}_compressWidgetDataProvidingMetadata(e,t){this._widgetDataProvidingMetadataCompressorFactory.create(e.type)?.compress(e.name,t)}crtOnMetaDataChanged(e){var t=this;return(0,l.Z)(function*(){if(!(yield t._isWidgetDataSourceSupported()))return e;const i=e;return t._getWidgetViewConfigs(i.viewConfig).forEach(r=>t._compressWidgetDataProvidingMetadata(r,i)),e})()}static#e=this.\u0275fac=function(t){return new(t||Le)(o.\u0275\u0275inject(y.FeatureService),o.\u0275\u0275inject(ri,8),o.\u0275\u0275inject(Gt))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Le,factory:Le.\u0275fac})}function Ti(){return D.FactoryProvider.create({token:Gt,mappings:[{predicate:N.CHART_WIDGET_VIEW_ELEMENT_TYPE,injectable:N.ChartWidgetDataProvidingMetadataCompressor},{predicate:N.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,injectable:N.IndicatorWidgetDataProvidingMetadataCompressor},{predicate:N.GAUGE_WIDGET_VIEW_ELEMENT_TYPE,injectable:N.IndicatorWidgetDataProvidingMetadataCompressor}]})}class xe{static for(...e){return{ngModule:xe,providers:[{provide:f.CRT_METADATA_POSTPROCESSOR,useFactory:(t,i)=>new Le(t,e,i),deps:[y.FeatureService,Gt],multi:!0}]}}static#e=this.\u0275fac=function(t){return new(t||xe)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:xe});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[Ti()],imports:[N.ChartWidgetDataProvidingMetadataCompressorModule,N.IndicatorWidgetDataProvidingMetadataCompressorModule]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(xe,{imports:[N.ChartWidgetDataProvidingMetadataCompressorModule,N.IndicatorWidgetDataProvidingMetadataCompressorModule]})})();const Lt=new o.InjectionToken("Represents a factory of widget data providing metadata generators");class je{constructor(e,t,i){this._featureService=e,this._widgetDataProvidingMetadataGeneratorFactory=i,this._supportedDataSourceWidgetElementTypes=t??[]}_isWidgetDataSourceSupported(){const e=this._featureService.getFeatureState(N.DISABLE_SUPPORT_WIDGET_DATA_SOURCE_FEATURE_NAME).pipe((0,P.first)(),(0,P.map)(Boolean),(0,P.map)(t=>!t));return(0,_.lastValueFrom)(e)}_getWidgetViewConfigs(e){return m.MetadataSchemaUtils.getViewConfigInfoByPropertyForValues("type",this._supportedDataSourceWidgetElementTypes,e).map(t=>t?.viewConfig).filter(t=>Boolean(t?.name)&&Boolean(t?.config))}_generateWidgetDataProvidingMetadata(e,t){return this._widgetDataProvidingMetadataGeneratorFactory.create(e.type).generate(e,t)}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(!(yield t._isWidgetDataSourceSupported()))return e;const i=e;return t._getWidgetViewConfigs(i.viewConfig).map(r=>t._generateWidgetDataProvidingMetadata(r,i)).forEach(r=>(0,S.defaultsDeep)(i,r)),e})()}static#e=this.\u0275fac=function(t){return new(t||je)(o.\u0275\u0275inject(y.FeatureService),o.\u0275\u0275inject(ri,8),o.\u0275\u0275inject(Lt))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:je,factory:je.\u0275fac})}function Ni(){return D.FactoryProvider.create({token:Lt,mappings:[{predicate:N.CHART_WIDGET_VIEW_ELEMENT_TYPE,injectable:N.ChartWidgetDataProvidingMetadataGenerator},{predicate:N.GAUGE_WIDGET_VIEW_ELEMENT_TYPE,injectable:N.IndicatorWidgetDataProvidingMetadataGenerator},{predicate:N.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,injectable:N.IndicatorWidgetDataProvidingMetadataGenerator}]})}class w{static for(...e){const t=(r,a)=>new je(r,e,a),i=[y.FeatureService,Lt];return{ngModule:w,providers:[{provide:f.CRT_METADATA_PREPROCESSOR,useFactory:t,deps:i,multi:!0},{provide:f.CRT_DESIGN_TIME_METADATA_PREPROCESSOR,useFactory:t,deps:i,multi:!0}]}}static#e=this.\u0275fac=function(t){return new(t||w)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:w});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[Ni()],imports:[N.ChartWidgetDataProvidingMetadataGeneratorModule,N.IndicatorWidgetDataProvidingMetadataGeneratorModule]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(w,{imports:[N.ChartWidgetDataProvidingMetadataGeneratorModule,N.IndicatorWidgetDataProvidingMetadataGeneratorModule]})})();class ke{constructor(e){this._featureService=e,this._chartWidgetName="crt.ChartWidget",this._indicatorWidgetName="crt.IndicatorWidget",this._gaugeWidgetName="crt.GaugeWidget"}_getWidgetsArray(e){const t=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._chartWidgetName,e.viewConfig),i=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._indicatorWidgetName,e.viewConfig),r=m.MetadataSchemaUtils.getViewConfigInfoByProperty("type",this._gaugeWidgetName,e.viewConfig);return[...t,...i,...r]}_getWidgetName(e){return e.name.replace(/\./g,"_")}_getDataSetSortinAttributeName(e){return`${e.split(" ").join("").replace(/\./g,"_")}_ListDataDSSorting`}get _isDrillDownFeatureEnabled(){return(0,_.lastValueFrom)(this._featureService.getFeatureState(N.CHART_WIDGET_DRILLDOWN_FEATURE_NAME))}crtOnModelInit(e,t){var i=this;return(0,l.Z)(function*(){const r=e,a=i._getWidgetsArray(r);for(const n of a){const s=n?.viewConfig;let c=r.viewModelConfig.attributes;c||(c=r.viewModelConfig.attributes={});const d=i._getWidgetName(s),p=`${f.DYNAMIC_DATA_SOURCE_PREFIX}_${d}`,g=i._getDataSetSortinAttributeName(p),b=`${p}_ListConfig`,C=`${p}_ListData`,I=`${C}_SearchValue`,E=`${C}_SearchFilter`;c[b]={value:[]},c[`${p}_UserProfileData`]={value:[]},c[C]={isCollection:!0,modelConfig:{path:`${p}_ListDataDS`,sortingConfig:{attributeName:g},filterAttributes:[{name:E,loadOnChange:!0}]},viewModelConfig:{attributes:{}}},g&&(c[g]={value:[]}),c[I]={value:""},c[E]={from:I,converter:`crt.WidgetSearchFilterAttributeConverter: '${C}' : '${b}'`}}return e})()}crtOnViewModelInit(e,t,i){var r=this;return(0,l.Z)(function*(){const a=e,n=r._getWidgetsArray(a);for(const s of n){const c=s?.viewConfig,d=r._getWidgetName(c),p=`${f.DYNAMIC_DATA_SOURCE_PREFIX}_${d}`,g=`${p}_ListDataDS`,b=`${p}_ListConfig`,C=`${p}_ListData`,I=`${p}_UserProfileData`,E=`${C}_SearchValue`;c.listData=`$${C}`,c.listConfig=`$${b}`,c.userProfileData=`$${I}`,c.searchValue=`$${E}`,c.drillDown={request:"crt.WidgetDrilldownRequest",params:{dataSourceName:g,listConfigAttributeName:b,listDataAttributeName:C,parameters:[],config:{schemaName:"@event.schemaName",groupByValue:"@event.groupByValue",pagingConfig:"@event.pagingConfig",sortingConfig:"@event.sortingConfig",groupBy:"@event.groupBy",aggregateBy:"@event.aggregateBy",columns:"@event.columns",filters:"@event.filters",dependencies:"@event.dependencies"}}},c.paginationChange=wt(g),c.getProfileColumns={request:"crt.AnalyticsDataGridGetColumnsRequest",params:{userProfileDataAttributeName:I,widgetAttributePrefix:p,drilldownConfig:"@event.drilldownConfig",schemaName:"@event.schemaName",isDefault:!1}},c.columnsChange={request:"crt.AnalyticsDataGridSaveToProfileRequest",params:{schemaName:"@event.schemaName",isDefault:!1,dataTableData:"@event.dataTableData",listConfigAttributeName:b}},c.searchFilterChange={request:"crt.SearchFilterRequest",params:{value:"@event.value",searchValueAttributeName:E}}}return e})()}crtOnMetaDataInit(e){var t=this;return(0,l.Z)(function*(){if(!(yield t._isDrillDownFeatureEnabled))return e;const i=e,r=t._getWidgetsArray(i);for(const a of r)!a.viewConfig||a.viewConfig?.pagingConfig||(a.viewConfig.pagingConfig=$t(),a.viewConfig.fullScreenStateChanged??={request:"crt.WidgetFullScreenStateChangesRequest",params:{widgetName:a.viewConfig.name,fullScreenState:"@event"}});return e})()}static#e=this.\u0275fac=function(t){return new(t||ke)(o.\u0275\u0275inject(y.FeatureService))};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:ke,factory:ke.\u0275fac})}class q{static#e=this.\u0275fac=function(t){return new(t||q)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:q});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ke,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Ge,multi:!0}],imports:[w.for(N.CHART_WIDGET_VIEW_ELEMENT_TYPE,N.INDICATOR_WIDGET_VIEW_ELEMENT_TYPE,N.GAUGE_WIDGET_VIEW_ELEMENT_TYPE)]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(q,{imports:[w]})})();const Ei=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u0644\u0627 \u062A\u0648\u062C\u062F \u062A\u0642\u0627\u0631\u064A\u0631 \u0645\u062A\u0627\u062D\u0629","GoToPrintablesSetupCaption":"\u0627\u0630\u0647\u0628 \u0644\u0644\u0625\u0628\u0644\u0627\u063A \u0639\u0646 \u0625\u0639\u062F\u0627\u062F"}}'),Di=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041D\u044F\u043C\u0430 \u043D\u0430\u043B\u0438\u0447\u043D\u0438 \u043E\u0442\u0447\u0435\u0442\u0438","GoToPrintablesSetupCaption":"\u041E\u0442\u0438\u0434\u0438 \u0432 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0430 \u043D\u0430 \u043E\u0442\u0447\u0435\u0442\u0430"}}'),Fi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Mi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Es gibt keine verf\xFCgbaren Berichte","GoToPrintablesSetupCaption":"Zum Berichts-Setup"}}'),Ri=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Pi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"No hay informes disponibles","GoToPrintablesSetupCaption":"Ir a la configuraci\xF3n de reportes"}}'),Oi=JSON.parse(`{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Il n'y a aucun rapport disponible","GoToPrintablesSetupCaption":"Aller \xE0 la configuration du rapport"}}`),Vi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),wi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nema dostupnih izvje\u0161taja","GoToPrintablesSetupCaption":"Idi na postavke izvje\u0161taja"}}'),$i=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nincsenek el\xE9rhet\u0151 jelent\xE9sek","GoToPrintablesSetupCaption":"L\xE9pjen a jelent\xE9s be\xE1ll\xEDt\xE1s\xE1hoz"}}'),Bi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Tidak ada laporan yang tersedia","GoToPrintablesSetupCaption":"Pergi ke pengaturan laporan"}}'),Gi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Non ci sono report disponibili","GoToPrintablesSetupCaption":"Vai alla configurazione del report"}}'),Li=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u5229\u7528\u53EF\u80FD\u306A\u30EC\u30DD\u30FC\u30C8\u306F\u3042\u308A\u307E\u305B\u3093","GoToPrintablesSetupCaption":"\u30EC\u30DD\u30FC\u30C8\u306E\u8A2D\u5B9A\u306B\u79FB\u52D5"}}'),xi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uBCF4\uACE0\uC11C\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4","GoToPrintablesSetupCaption":"\uBCF4\uACE0\uC11C \uC124\uC815\uC73C\uB85C \uC774\uB3D9"}}'),ji=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),ki=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),qi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Brak dost\u0119pnych raport\xF3w","GoToPrintablesSetupCaption":"Przejd\u017A do konfiguracji raportu"}}'),Ui=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"N\xE3o existem relat\xF3rios dispon\xEDveis","GoToPrintablesSetupCaption":"Ir para as configura\xE7\xF5es de relat\xF3rios"}}'),Wi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Zi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nu exist\u0103 rapoarte disponibile","GoToPrintablesSetupCaption":"Merge\u021Bi la configurarea raportului"}}'),Hi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \u043E\u0442\u0447\u0435\u0442\u044B \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u044B\u0435 \u0434\u043B\u044F \u043F\u0435\u0447\u0430\u0442\u0438","GoToPrintablesSetupCaption":"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u043A \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0435 \u043E\u0442\u0447\u0435\u0442\u043E\u0432"}}'),zi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"Nuk ka raporte t\xEB disponueshme","GoToPrintablesSetupCaption":"Shko te krijimi i raportit"}}'),Ji=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Yi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Qi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),Xi=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u041D\u0435\u043C\u0430\u0454 \u0434\u043E\u0441\u0442\u0443\u043F\u043D\u0438\u0445 \u0437\u0432\u0456\u0442\u0456\u0432","GoToPrintablesSetupCaption":"\u041F\u0435\u0440\u0435\u0439\u0442\u0438 \u0434\u043E \u043D\u0430\u043B\u0430\u0448\u0442\u0443\u0432\u0430\u043D\u043D\u044F \u0437\u0432\u0456\u0442\u0443"}}'),Ki=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),er=JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"There are no available reports","GoToPrintablesSetupCaption":"Go to report setup"}}'),tr={"zh-TW":JSON.parse('{"PrintablesMenuItemsPreprocessor":{"NoAvailablePrintablesCaption":"\u6C92\u6709\u53EF\u53D6\u7528\u7684\u5831\u544A","GoToPrintablesSetupCaption":"\u524D\u5F80\u5831\u544A\u8A2D\u5B9A"}}'),"hr-HR":wi,"bg-BG":Di,"zh-CN":er,"vi-VN":Ki,"uk-UA":Xi,"tr-TR":Qi,"th-TH":Yi,"sv-SE":Ji,"sq-AL":zi,"ro-RO":Zi,"pt-PT":Wi,"pt-BR":Ui,"pl-PL":qi,"nl-NL":ki,"lv-LV":ji,"ko-KR":xi,"ja-JP":Li,"it-IT":Gi,"id-ID":Bi,"hu-HU":$i,"he-IL":Vi,"fr-FR":Oi,"es-ES":Pi,"de-DE":Mi,"cs-CZ":Fi,"ar-SA":Ei,"en-US":Ri,"ru-RU":Hi};class vt{static#e=this.\u0275fac=function(t){return new(t||vt)};static#t=this.\u0275mod=o.\u0275\u0275defineNgModule({type:vt});static#i=this.\u0275inj=o.\u0275\u0275defineInjector({providers:[u.DataGridFilterOptionsBackwardCompatibilityModifier,u.FolderTreeFilterOptionsBackwardCompatibilityModifier,R.DATA_GRID_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,R.DATA_GRID_EDITING_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,R.FILE_LIST_CELL_VIEW_CONFIG_CREATOR_FACTORY_PROVIDER,{provide:f.CRT_METADATA_PREPROCESSOR,useClass:G,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:re,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ae,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:oe,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ce,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:te,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ne,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:se,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ie,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:mt,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ft,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Ee,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:de,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:le,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Je,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ze,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Z,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:at,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:yt,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:qe,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:X,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ge,multi:!0},y.DcmSettingsService,ye,B,k,O,y.PrintablesService,m.FileDownloaderService,{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Ue,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ue,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:gt,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:st,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ut,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:pt,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:_t,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:It,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Qe,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:it,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:bt,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Y,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ot,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ct,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Ze,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:We,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:De,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:rt,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:nt,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:Be,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:ht,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:St,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:fi,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:he,multi:!0},{provide:y.LICENSE_RESTRICTION_OPERATION_CODES,useValue:Zt,multi:!0},{provide:y.LICENSE_RESTRICTION_OPERATION_CODES,useValue:Ht,multi:!0},{provide:y.LICENSE_RESTRICTION_OPERATION_CODES,useValue:zt,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:tt,multi:!0},{provide:f.CRT_METADATA_PREPROCESSOR,useClass:At,multi:!0}],imports:[Et.CommonModule,Ne,V.withModifiers([["crt.DataGrid",u.DataGridFilterOptionsBackwardCompatibilityModifier]]),V.withModifiers([["crt.FolderTree",u.FolderTreeFilterOptionsBackwardCompatibilityModifier]]),q,He,Ce,pe,fe,Q,D.CrtLibTranslateModule.forRoot({i18n:tr}),$e,U.ComboboxUtilsModule]})}(function(){(typeof ngJitMode>"u"||ngJitMode)&&o.\u0275\u0275setNgModuleScope(vt,{imports:[Et.CommonModule,Ne,V,V,q,He,Ce,pe,fe,Q,D.CrtLibTranslateModule,$e,U.ComboboxUtilsModule]})})();class Tt{_getHeaders(e){return m.MetadataSchemaUtils.getViewConfigInfoByProperty("type","crt.HeaderContainer",e.viewConfig)}crtOnModelInit(e,t){const i=e,r=i?.viewModelConfig?.attributes,a=this._getHeaders(i)[0];if(a){const n="HeaderCaption";r[n]={value:""},a.viewConfig.title=`$${n}`,a.viewConfig.styles={"border-top-left-radius":"8px","border-top-right-radius":"8px"},i.tag?.includes("BaseGridSectionTemplate")&&(a.viewConfig.styles["margin-bottom"]="0px")}return Promise.resolve(e)}static#e=this.\u0275fac=function(t){return new(t||Tt)};static#t=this.\u0275prov=o.\u0275\u0275defineInjectable({token:Tt,factory:Tt.\u0275fac})}}}]);
