(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[8971],{88971:(lt,_e,v)=>{v.r(_e),v.d(_e,{AppendSchemaStateFromUrlService:()=>W,BaseNavigationOptions:()=>K,CHILD_HISTORY_STATE_BUILDERS:()=>ee,CHILD_NAVIGATION_TARGETS:()=>ae,CanOpenPageHandler:()=>ot,ChildHistoryStateBuilder:()=>ue,Crt7XRequestHandler:()=>ge,CrtNavigationGuardsService:()=>j,CrtNavigationModule:()=>ne,CrtNavigationService:()=>U,CrtRouter:()=>x,CrtRouterMock:()=>rt,CrtUrlSerializer:()=>E,DONT_USE_CHILD_ROUTING:()=>ve,ENTITY_CHILD_HISTORY_STATE_BUILDERS:()=>te,EXECUTION_ZONES_CONTAINER_NAME_FOR_7X:()=>Ie,EntityNavigationOptions:()=>Te,EntityNavigationTransitionConfigBuilder:()=>T,EntityNavigationTransitionConfigBuilderModule:()=>$,HashLocationStrategy:()=>k,HistoryService:()=>M,HistoryWrapper:()=>z,LocationStrategy:()=>N,ModelInitConfigsGeneratorService:()=>Z,ModuleNameReplacer:()=>C,ModuleNavigationOptions:()=>Re,ModuleNavigationTransitionConfigBuilder:()=>P,ModuleNavigationTransitionConfigBuilderModule:()=>G,NAVIGATION_GUARD_TOKEN:()=>de,NAVIGATION_ZONE_NAME:()=>Ne,NavigationMode:()=>_,NavigationOptionsTypeEnum:()=>y,NavigationTransitionLocationUtils:()=>ce,NavigationUtils:()=>d.NavigationUtils,RecordUrlCreatorService:()=>w,SCHEMA_CHILD_HISTORY_STATE_BUILDERS:()=>ie,SHELL_MODULE_ALIASES_FACTORY:()=>le,SchemaAccessGuard:()=>V,SchemaNavigationOptions:()=>Ee,SchemaNavigationTransitionConfigBuilder:()=>A,SchemaNavigationTransitionConfigBuilderModule:()=>F,UITypePriority:()=>d.UITypePriority,crtChildSegmentsEqual:()=>oe,crtStatesEqual:()=>Se,crtUrlSegmentsEqual:()=>se,findChildSegmentsInContextByTarget:()=>re,getLastNestedChildState:()=>Q});var u=v(8239),h=v(97600),l=v(21322),I=v(27049),m=v(75378);const ye="ChainModuleStub",Ne="navigation",Ie="ExecutionZones",ae={Modal:"modal"},L={ClassicUI:"7x",FreedomUI:"8x"};var b=v(33177),g=v(49475),s=v(94450);class C{static#e=this._moduleAliases={CardSchemaViewModule:"Card",PageSchemaViewModule:"Page",SectionSchemaViewModule:"Section"};static getModuleNameByAlias(e){const t=this._moduleAliases;return Object.keys(t).find(i=>t[i]===e)}static replaceModuleNameByAlias(e){const t=e.split("/");return t[0]=this._moduleAliases[t[0]]||t[0],t.join("/")}static#t=this.\u0275fac=function(t){return new(t||C)};static#i=this.\u0275prov=s.\u0275\u0275defineInjectable({token:C,factory:C.\u0275fac,providedIn:"root"})}const Ce="\\[(.+)\\]";class E{static _parseChildRoutes(e,t){const i=[],n=e.match(Ce);if(n?.length>0){const a=n[1],[o,c]=this._getChildRoutesIndexes(a),p=o>=0&&c>0;let f=a,R;p&&(R=a.substring(o,c+1),f=a.replace(R,"")),f.split(",").forEach((me,ct)=>{const X=this._getChildSegmentByPath(me);if(X.contextName=`${t}_${X.target}${ct}`,p){const ut=a.indexOf(me);a.at(ut+me.length)==="["&&(X.children=this._parseChildRoutes(R,X.contextName))}i.push(X)})}return i}static _getChildRoutesIndexes(e){const t=[],i=[],n=[];for(let a=0;a<e.length;a++){const o=e.charAt(a);if(o==="[")t.push(a);else if(o==="]"){const c=t.pop();i.push(c),n.push(a)}}return[i.at(-1),n.at(-1)]}static _getRootSegmentByPath(e){if(!e)return{recordId:void 0,contextName:"root",action:void 0,schemaName:void 0,moduleName:void 0};const t=e.split("/");let i,n,a,o;return t.length===5&&t[0]==="SectionModuleV2"?[i,,n,a,o]=t:[i,n,a,o]=t,{moduleName:C.getModuleNameByAlias(i)||i,schemaName:n,action:a,recordId:o,contextName:"root"}}static _getChildSegmentByPath(e){const t=e.split("=");let i,n;t[1]?(n=t[0],i=t[1]):i=t[0];const[a,o,c]=i.split("/");return{schemaName:a,action:o,recordId:c,target:n}}static parse(e){const i=new URL(e).hash.split("#")[1];return E.parseLocation(i)}static parseLocation(e){const t=e?.indexOf("[");let i,n="";t>=0?(i=e.substring(0,t),n=e.substring(t)):i=e;const a=this._getRootSegmentByPath(i);let o=[];return n&&(o=this._parseChildRoutes(n,a.contextName)),{root:a,children:o}}static getQueryParams(e){const t=e.lastIndexOf("?"),i={};return t<0||e.substring(t+1).split("&").forEach(a=>{const o=a.split("=");i[o[0]]=o[1]}),i}}var d=v(1742);function se(r,e){return r?.moduleName===e?.moduleName&&r?.schemaName===e?.schemaName&&r?.action===e?.action&&r?.recordId===e?.recordId&&r?.contextName===e?.contextName}function oe(r,e){if(!(r?.length===e?.length))return!1;for(let i=0;i<r?.length;i++){const n=se(r[i],e[i]),a=oe(r[i].children,e[i].children),o=r[i].target===e[i].target;if(!(n&&a?o:!1))return!1}return!0}function re(r,e,t,i){let n=[];return(0,h.isEmpty)(t)||t.forEach(a=>{const o=i===r,c=a.target===e;if(o&&c)n.push(a);else{const f=re(r,e,a?.children,a.contextName);n=[...n,...f]}}),n}function fe(r){const e=(0,h.omit)(r,"historyIndex","children");return e.modelInitConfigs=e.modelInitConfigs?.map(t=>(0,h.omit)(t,"name")),e}function Se(r,e){return(0,h.isEqual)(fe(r),fe(e))}function Q(r){const e=r.children||[];return(0,h.isEmpty)(e)?r:Q(e[0])}class ce{static _applyRecordId(e,t,i){return e&&e!==m.ModelInPageAction.Add?t+"/"+i:t}static _getLocationByUrlSegment(e){const t=[e.moduleName,e.schemaName,e.action].filter(i=>i&&i!=="undefined").join("/");return this._applyRecordId(e.action,t,e.recordId)}static _getPrevRootLocation(e){const t=E.parseLocation(e);return this._getLocationByUrlSegment(t.root)}static _getRootLocationSegment(e){return{schemaName:e.schemaName,moduleName:e.moduleName,action:e.modelInitConfigs?.[0]?.action,recordId:e.modelInitConfigs?.[0]?.recordId}}static _getRootLocation(e,t){let i;const n=this._getChildrenState(t),{prevLocation:a,isInChain:o}=e;if(a&&(o||!(0,h.isEmpty)(n)))i=this._getPrevRootLocation(a);else{const c=this._getRootLocationSegment(e);i=this._getLocationByUrlSegment(c)}return i}static _getChildrenState(e){return e.children||[]}static _getChildLocationSegment(e){return{schemaName:e.schemaName,action:e.modelInitConfigs?.[0]?.action,recordId:e.modelInitConfigs?.[0]?.recordId}}static _getChildrenLocation(e){let t="";if((0,h.isEmpty)(e))return t;const i=[...e].sort((a,o)=>a.target.localeCompare(o.target));let n="";return i.forEach(a=>{n===a.target?t+=",":(t+=`${a.target}=`,n=a.target);const o=this._getChildLocationSegment(a);t+=this._getLocationByUrlSegment(o);const c=this._getChildrenLocation(a.children);t=t.concat(`${c}`)}),`[${t}]`}static getLocationByState(e,t){const i=this._getRootLocation(e,t),n=this._getChildrenState(t),a=this._getChildrenLocation(n);return i+a}}class N extends g.RootInjectorGuard{constructor(e){super(),this.window=e,this.state$=new l.Subject,this._indexHistoryStates()}_indexHistoryStates(){const e=()=>{const t=this.getState();if(!t||!("historyIndex"in t)){let i;this.previousState?i=this.previousState?.historyIndex+1:i=this.window.history.length-1;const n={...t,historyIndex:i};this.window.history.replaceState(n,"indexState")}};e(),this.window.addEventListener("popstate",e,!0),this._popstateSubscription=new l.Subscription(()=>this.window.removeEventListener("popstate",e))}replaceAliasWithModuleName(e){const t=e.split("/");return t[0]=C.getModuleNameByAlias(t[0])||t[0],t.join("/")}onPopState(e){}prepareExternalUrl(e){}getBaseHref(){return`${this.window.Terrasoft.workspaceBaseUrl}/Shell`}getRoute(e){const i={...E.parse(this.window.location.href),state:e};return this._applyChildStateToChildSegment(i.children,e.children),i}_applyChildStateToChildSegment(e,t){!e||!t||e.forEach((i,n)=>{const a=t[n];i.parameters=a.parameters,i.defaultValues=a.modelInitConfigs?.[0]?.defaultValues,i.children&&this._applyChildStateToChildSegment(i.children,a.children)})}ngOnDestroy(){this._popstateSubscription.unsubscribe()}static#e=this.\u0275fac=function(t){return new(t||N)(s.\u0275\u0275inject(b.WINDOW_TOKEN))};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:N,factory:N.\u0275fac,providedIn:"root"})}class k extends N{constructor(e,t){super(e),this._ngZone=t}get previousState(){return this._previousState}_splitHistoryState(e){const i=e.split("?")[0].split("/"),n={},o=E.parse(this.window.location.href).root;if(n.moduleName=o.moduleName,n.schemaName=o.schemaName,n.operationType=o.action,i.length<=4&&i[3])return n.recordId=o.recordId,n;let c=3;n.operationType!=="add"&&(c=4,i[3]&&(n.recordId=o.recordId));const p=(i.length-c)/2;n.valuePairs=[];for(let f=0;f<p;f++){const R=c+f*2;n.valuePairs[f]={name:i[R],value:i[R+1]}}return n}_getHash(e=this.window.location.href){const t=e.indexOf("#");return t>=0?e.slice(t):"#"+e}_hasOnlyHistoryState(e){const t=Object.keys(e);return t.length===1&&t.includes("historyIndex")}_toHistoryState(e){const t={recordId:e.recordId,schemaName:e.schemaName,moduleName:e.moduleName,operationType:e.action};return t.modelInitConfigs=[{recordId:e.recordId,action:e.action}],t}_toChildHistoryStates(e){const t=[];return e.forEach(i=>{const n=this._toHistoryState(i);n.target=i.target,n.children=[],(0,h.isEmpty)(i.children)||(n.children=this._toChildHistoryStates(i.children)),t.push(n)}),t}_backToReconstructedState(){const e=E.parse(this.window.location.href),t=this._toChildHistoryStates(e.children);if(t.length>0){t.pop();const i=this._toHistoryState(e.root),n={...this.window.history.state,...i,children:t},a={schemaName:n.schemaName,moduleName:n.moduleName,modelInitConfigs:n.modelInitConfigs},o=ce.getLocationByState(a,n);return this._ngZone.run(()=>{this.replaceState(n,"",o)}),!0}return!1}getActivePathInfo(){let e=this.path();return e.charAt(0)==="/"&&(e=e.slice(1)),e=this.replaceAliasWithModuleName(e),this._splitHistoryState(e)}path(e=!1){const t=this._getHash();return e?t:t.slice(1)}pushState(e,t,i){const n=this.getState()||this._previousState||{historyIndex:0};(e??={}).historyIndex=n.historyIndex+1,this.window.history.pushState(e,t,this._getHash(i)),this._previousState=this.getState(),this.state$.next(e)}replaceState(e,t,i){(e??={}).historyIndex=this.getState().historyIndex,this.window.history.replaceState(e,t,this._getHash(i)),this.state$.next(e)}forward(){this.go(1)}back(){if(this.window.history.length<2){this._backToReconstructedState();return}this._previousState=this.getState(),this.go(-1)}go(e){this.window.history.go(e)}getState(){let e=this.window.history.state;if((0,h.isEmpty)(e))return null;if(this._hasOnlyHistoryState(e)){const t=E.parse(this.window.location.href),i=this._toHistoryState(t.root),n=this._toChildHistoryStates(t.children);e={...e,...i,children:n}}return e}ngOnDestroy(){super.ngOnDestroy()}static#e=this.\u0275fac=function(t){return new(t||k)(s.\u0275\u0275inject(b.WINDOW_TOKEN),s.\u0275\u0275inject(s.NgZone))};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:k,factory:k.\u0275fac,providedIn:"root"})}class K{}var y;(function(r){r.Entity="entity",r.Schema="schema",r.Module="module"})(y||(y={}));class Ee extends K{constructor(e){super(),this.type=y.Schema,this.schemaName=e}}class Te extends K{constructor(){super(...arguments),this.type=y.Entity}}class Re extends K{constructor(){super(...arguments),this.type=y.Module}}var _;(function(r){r.Push="push",r.Replace="replace"})(_||(_={}));class ue{getState(e){var t=this;return(0,u.Z)(function*(){let i={};yield t.enrichState(i,e);const n=e?.state??{};return i={...i,...n},i})()}}var S;(function(r){r.Back="back",r.Forward="forward",r.ExecuteTransition="executeTransition",r.Go="go"})(S||(S={}));class H{static#e=this._backEvent={type:S.Back};_addToBucket(e,t){let i=e[t.type];i||(i=[],e[t.type]=i),i.push(t)}_eventBucketsReducer(e,t){return t.type===S.Go&&t.delta===-1?this._addToBucket(e,H._backEvent):this._addToBucket(e,t),e}_prepareForwardEvents(e,t){let i=[];const n=[];for(const a of e)(a.config.mode===_.Push?n:i).push(a);return i.length===0&&t&&n.length>0&&(n[0].config.mode=_.Replace),i.length>0&&(i=[i[i.length-1]]),[...i,...n]}normalize(e){const t=e.reduce(this._eventBucketsReducer.bind(this),{}),i=t[S.Go],n=t[S.Forward];if(i||n)return[...i||[],...n||[]];const a=t[S.Back],o=t[S.ExecuteTransition];return a&&!o?[a[0]]:this._prepareForwardEvents(o,Boolean(a))}static#t=this.\u0275fac=function(t){return new(t||H)};static#i=this.\u0275prov=s.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac,providedIn:"root"})}const be="navigation";class J{constructor(e,t,i,n){this._zoneService=e,this._normalizer=t,this._logger=i,this._applicationInfo=n,this._queue=[],this._state=g.CrtZoneState.Idle,this.navigationEventsReady$=new s.EventEmitter(!1);const a=e.register(be,g.CrtZoneType.ExecutionTracking);this._stateChangeSubscription=a.onStateChange$.subscribe(this._onStateChange.bind(this))}_onStateChange(e){this._state!==e&&(this._state=e,e===g.CrtZoneState.Idle&&this._execQueue())}_execQueue(){if(!this._queue.length||this._state===g.CrtZoneState.Busy)return;const e=this._normalizer.normalize(this._queue);this._applicationInfo.isDebugEnabled&&this._logger.log(`Executing ${this._queue.length} events as ${e.length}`,this._queue,{sourceEvents:this._queue,normalizedEvents:e}),this._queue=[],this.navigationEventsReady$.next(e)}_push(e){this._queue.push(e),this._execQueue()}pushTransition(e){this._push({type:S.ExecuteTransition,config:e})}push(e,t){this._push({type:e,delta:t})}ngOnDestroy(){this._stateChangeSubscription.unsubscribe()}static#e=this.\u0275fac=function(t){return new(t||J)(s.\u0275\u0275inject(g.CrtZoneService),s.\u0275\u0275inject(H),s.\u0275\u0275inject(b.LoggerService),s.\u0275\u0275inject(g.ApplicationInfo))};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac,providedIn:"root"})}const le=new s.InjectionToken("ShellModuleAliasesFactory"),ve=new s.InjectionToken("DontUseChildRouting"),ee=new s.InjectionToken("CHILD_HISTORY_STATE_BUILDERS"),te=new s.InjectionToken("ENTITY_CHILD_HISTORY_STATE_BUILDERS",{factory:()=>{const r=(0,s.inject)(ee,{optional:!0})||[],e=(0,s.inject)(te)||[];return r.concat(e)}}),ie=new s.InjectionToken("SCHEMA_CHILD_HISTORY_STATE_BUILDERS",{factory:()=>{const r=(0,s.inject)(ee,{optional:!0})||[],e=(0,s.inject)(ie)||[];return r.concat(e)}}),de=new s.InjectionToken("Navigation guard");class M{constructor(e,t,i){this._locationStrategy=e,this._navigationQueue=t,this._moduleAliasesFeatureFactory=i,this._handlerChain=m.HandlerChainService.instance,this._onNavigationEventsReadySubscription=this._navigationQueue.navigationEventsReady$.pipe((0,l.switchMap)(n=>this._handleNavigationEvents(n))).subscribe(),this._moduleAliasesFeatureFactory().then(n=>this._moduleAliasesFeatureEnabled=n)}_handleNavigationEvent(e){switch(e.type){case S.Back:this._locationStrategy.back();break;case S.Forward:this._locationStrategy.forward();break;case S.Go:this._locationStrategy.go(e.delta);break}}_handleNavigationEvents(e){var t=this;return(0,u.Z)(function*(){const i=e.length-1;for(let n=0;n<e.length;n++){const a=e[n];if(a.type===S.ExecuteTransition){const o=n<i;yield t._executeTransition(a.config,o)}else t._handleNavigationEvent(a)}})()}_changeHistoryStateUsing8xRouting({mode:e,state:t,pageTitle:i,location:n}){if(i=i??"",e===_.Replace)return this.replaceState(t,i,n);if(e===_.Push)return this.pushState(t,i,n)}_changeHistoryStateUsing7xRouting({mode:e,state:t,location:i},n){var a=this;return(0,u.Z)(function*(){const o=e===_.Replace?"ReplaceHistoryState":"PushHistoryState";yield a._handlerChain.process({type:"crt.7XRequest",$context:null,action:o,hash:i,stateObj:t,silent:t?.silent??n})})()}_changeHistoryState(e,t,i){var n=this;return(0,u.Z)(function*(){t?n._changeHistoryStateUsing8xRouting(e):yield n._changeHistoryStateUsing7xRouting(e,i)})()}_load7xModule({state:e,moduleConfig:t}){var i=this;return(0,u.Z)(function*(){const n=e.initConfig,o=d.NavigationUtils.isAngularRouting(e.moduleName)?ye:e.moduleName,c={renderTo:"centerPanel",id:t?.moduleId??e?.moduleId,keepAlive:t?.keepAlive??!0,instanceConfig:n,replaceLastModuleInChain:e.replaceLastModuleInChain};yield i._handlerChain.process({type:"crt.7XRequest",$context:null,action:"LoadModule",moduleName:o,moduleParams:c})})()}_executeTransition(e,t){var i=this;return(0,u.Z)(function*(){const n=e.state,a=n.children?.length>0,o=d.NavigationUtils.isAngularRouting(n.moduleName)||a,c=Boolean(n.isInChain);t&&(n.silent=!0,n.moduleId=e.moduleConfig?.moduleId??n?.moduleId),yield i._changeHistoryState(e,o,c),!t&&c&&!a&&(yield i._load7xModule(e))})()}_getProcessedHash(e){return this._moduleAliasesFeatureEnabled?C.replaceModuleNameByAlias(e):e}executeTransition(e){this._navigationQueue.pushTransition(e)}pushState(e,t,i){const n=this._getProcessedHash(i);this._locationStrategy.pushState(e,t,n)}replaceState(e,t,i){const n=this._getProcessedHash(i);this._locationStrategy.replaceState(e,t,n)}go(e){this._navigationQueue.push(S.Go,e)}back(){this._navigationQueue.push(S.Back)}forward(){this._navigationQueue.push(S.Forward)}ngOnDestroy(){this._onNavigationEventsReadySubscription.unsubscribe()}static#e=this.\u0275fac=function(t){return new(t||M)(s.\u0275\u0275inject(N),s.\u0275\u0275inject(J),s.\u0275\u0275inject(le))};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac,providedIn:"root"})}class j{constructor(e,t,i){this._rightsService=e,this._featureService=t,this._navigationGuards=i}canActivate(e){var t=this;return(0,u.Z)(function*(){if(!(yield t._featureService.getFeatureState("EnablePageOpeningRestrictions"))||(yield t._rightsService.getCanExecuteOperation("CanBypassPageOpeningRestrictions")))return Promise.resolve(!0);for(const a of t._navigationGuards){const o=yield a.canActivate(e);if(o!==!0)return Promise.resolve(o)}return Promise.resolve(!0)})()}static#e=this.\u0275fac=function(t){return new(t||j)(s.\u0275\u0275inject(m.RightsService),s.\u0275\u0275inject(m.FeatureService),s.\u0275\u0275inject(de))};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac,providedIn:"root"})}class x{constructor(e,t,i,n){var a=this;this._location=e,this._moduleAliasesFeatureFactory=t,this._historyService=i,this._navigationGuardsService=n,this._popState$=(0,l.fromEvent)(window,"popstate"),this._navigateStart$=new l.Subject,this._navigateEnd$=new l.Subject,this._prevRoute={},this._currentRoute={},this.navigateStart$=this._navigateStart$.asObservable(),this.navigateEnd$=this._navigateEnd$.asObservable(),this.historyState$=(0,l.merge)((0,l.of)(this._location.getState()),this._location.state$.pipe((0,I.mergeMap)(()=>(0,l.of)(this._location.getState()))),this._popState$.pipe((0,I.mergeMap)(()=>(0,l.of)(this._location.getState())))).pipe((0,I.switchMap)(function(){var o=(0,u.Z)(function*(c){const p=yield a._navigationGuardsService.canActivate(a.getActiveRouteInfo());let f=c;if(p===!1)throw new Error("Navigation prevented.");if(p!==void 0&&typeof p!="boolean"){const R=a._location.path();a._historyService.replaceState(p.state,p.title||"",p.path||R),f=p.state}return f});return function(c){return o.apply(this,arguments)}}()),(0,I.tap)(o=>{if(this._moduleAliasesFeatureEnabled){const c=this._location.path();this._shouldReplaceModuleNameByAlias(c)&&this._historyService.replaceState(o,"",c)}}),(0,I.share)()),this.location$=(0,l.merge)((0,l.of)(new URL(window.location.href)),this._location.state$.pipe((0,I.mergeMap)(()=>(0,l.of)(new URL(window.location.href)))),this._popState$.pipe((0,I.mergeMap)(()=>(0,l.of)(new URL(window.location.href))))),this.crtRoute$=this.historyState$.pipe((0,l.map)(o=>this._location.getRoute(o)),(0,I.tap)(o=>{this._prevRoute=this._currentRoute,this._currentRoute=o}),(0,l.filter)(o=>!(0,h.isEqual)(this._prevRoute,o)),(0,l.shareReplay)({bufferSize:1,refCount:!1})),this._moduleAliasesFeatureFactory().then(o=>this._moduleAliasesFeatureEnabled=o)}_shouldReplaceModuleNameByAlias(e){return C.replaceModuleNameByAlias(e)!==e}_filterChildrenRoute(e,t){const i=!se(e,this._prevRoute.root),n=!Se(t,this._prevRoute.state);return i||n}onNavigateStart(){this._navigateStart$.next()}onNavigateEnd(){this._navigateEnd$.next()}getNavigation$(e){return this.crtRoute$.pipe((0,l.filter)(t=>{if(e)throw new Error("Not implemented yet");return!(0,h.isEmpty)(t.state?.children)||!(0,h.isEmpty)(this._prevRoute.state?.children)?this._filterChildrenRoute(t.root,t.state):!0}))}getChildNavigation$(e,t){return this.crtRoute$.pipe((0,l.filter)(i=>!oe(i.children,this._prevRoute.children)),(0,l.map)(i=>re(e,t,i.children,i.root.contextName)))}getActiveRouteInfo(){const e=this._location.getActivePathInfo(),t=this._location.getState(),i={moduleName:t&&t.moduleName||e.moduleName,schemaName:t&&t.schemaName||e.schemaName,operationType:e.operationType||t.operation,recordId:e.recordId};return t&&t.isInChain&&(i.isInChain=!0),i}static#e=this.\u0275fac=function(t){return new(t||x)(s.\u0275\u0275inject(N),s.\u0275\u0275inject(le),s.\u0275\u0275inject(M),s.\u0275\u0275inject(j))};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"})}class z{constructor(e){this._historyService=e}pushState(e,t,i){this._historyService.pushState(e,t,i)}replaceState(e,t,i){this._historyService.replaceState(e,t,i)}go(e){this._historyService.go(e)}back(){this.go(-1)}forward(){this.go(1)}static#e=this.\u0275fac=function(t){return new(t||z)(s.\u0275\u0275inject(M))};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:z,factory:z.\u0275fac,providedIn:"root"})}var Me=v(77207),Pe=v(8785);class q{constructor(e,t,i){this._window=e,this._locationStrategy=t,this._router=i,this._destroyed$=new l.Subject,this._initListenPopStateEvent(),this._initListenNavigationEndEvent()}_initListenNavigationEndEvent(){this.navigateEnd$=this._router.navigateEnd$.pipe((0,l.map)((0,u.Z)(function*(){yield m.HandlerChainService.instance.process({type:"crt.7XRequest",action:"RefreshCacheHash",$context:null})})),(0,l.takeUntil)(this._destroyed$))}_initListenPopStateEvent(){var e=this;this.popState$=(0,l.fromEvent)(this._window,"popstate").pipe((0,l.map)(function(){var t=(0,u.Z)(function*({state:i}){(yield e._isHistoryStateChanged(i))&&(yield m.HandlerChainService.instance.process({type:"crt.7XRequest",action:"8xHistoryStateChanged",$context:null,back:e._isBack(i)}))});return function(i){return t.apply(this,arguments)}}()),(0,l.takeUntil)(this._destroyed$))}_isHistoryStateChanged(e){var t=this;return(0,u.Z)(function*(){const i=t._locationStrategy.getActivePathInfo(),n=e?.schemaName??i.schemaName;if(!(n&&!(yield d.NavigationUtils.isAngularSchema(n)))){const f=e?.moduleName??i.moduleName;if(!(f&&!n&&!d.NavigationUtils.isAngularRouting(f))&&!e?.isInChain)return!1}const c=t._locationStrategy.previousState?.moduleId===e?.moduleId;return!t._wasChildrenRouting()||!c})()}_wasChildrenRouting(){return this._locationStrategy.previousState?.children?.length>0}_isBack(e){return e?.historyIndex<this._locationStrategy.previousState?.historyIndex}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static#e=this.\u0275fac=function(t){return new(t||q)(s.\u0275\u0275inject(b.WINDOW_TOKEN),s.\u0275\u0275inject(N),s.\u0275\u0275inject(x))};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:q,factory:q.\u0275fac,providedIn:"root"})}class O{constructor(e){this.injector=e,this.locationStrategy=e.get(N),this.dontUseChildRouting=(0,s.inject)(ve,{optional:!0}),this._childHistoryStateBuilders=this.getChildHistoryStateBuilders()||[]}_getChildHistoryStates(e){return Promise.all(this._childHistoryStateBuilders.map(t=>t.getState(e)))}_getPrevChildHistoryStates(e){return e}_getState(e,t){var i=this;return(0,u.Z)(function*(){if(yield i.dontUseChildRouting)return i.getRootState(e,t);let a=yield i._getChildHistoryStates(t);a=a.filter(f=>!(0,h.isEmpty)(f));let o;(0,h.isEmpty)(a)?o=i.getRootState(e,t):o=yield i._applyChildrenHistoryStates(e,a);const c=i._getPrevChildHistoryStates(e.prevState);return!(0,h.isEmpty)(c?.children)&&(0,h.isEmpty)(a)&&(o.keepAlive=!0),o})()}_applyChildrenHistoryStates(e,t){const i=(0,h.cloneDeep)(e.prevState)??{},n=Q(i);return this._setChildrenState(n,t),i}_setChildrenState(e,t){e.children=t}_getLocation(e,t){return ce.getLocationByState(e,t)}_getSchemaUIType(e){return(0,u.Z)(function*(){if(!!e.schemaName)return(yield d.NavigationUtils.isAngularSchema(e.schemaName))?L.FreedomUI:L.ClassicUI})()}getChildHistoryStateBuilders(){return(0,s.inject)(ee,{optional:!0})}getModelInitConfigs(e){return[]}getSchemaName(e,t){return Promise.resolve("")}getStateModuleId(e){return""}getModuleName(e,t){const i=e.schemaUIType===L.ClassicUI?t.state?.moduleName:"";return Promise.resolve(i)}getRootState(e,t){const i={...(0,h.cloneDeep)(t?.state??{})};if(i.isInChain=e.isInChain,i.moduleName=e.moduleName,e.isInChain||(i.moduleId=this.getStateModuleId(e)),e.schemaUIType===L.ClassicUI){const n=e.modelInitConfigs?.[0];i.operation=n?.action,i.primaryColumnValue=n?.recordId,i.valuePairs=d.NavigationUtils.getValuePairs(n?.defaultValues),i.isSeparateMode=!0,i.isInChain&&(i.schemaName=e?.schemaName)}else i.schemaName=e.schemaName,i.modelInitConfigs=e.modelInitConfigs;return i}getModuleConfig({isInChain:e,moduleName:t,prevState:i}){return e?{moduleId:(i?.moduleId??"")+d.NavigationUtils.generateChainModuleId(t)}:null}getCommonTransitionInfo(e){var t=this;return(0,u.Z)(function*(){const i=t.locationStrategy.getState(),n={};return n.schemaName=yield t.getSchemaName(n,e),n.schemaUIType=yield t._getSchemaUIType(n),n.navigationState=e.state,n.isInChain=n.navigationState?.isInChain??i?.isInChain,n.modelInitConfigs=t.getModelInitConfigs(e),n.prevState=i,n.prevLocation=t.locationStrategy.path(),n.moduleName=yield t.getModuleName(n,e),n})()}getTransitionConfig(e){var t=this;return(0,u.Z)(function*(){const i=yield t.getCommonTransitionInfo(e);if(!i)return null;const n=yield t._getState(i,e),a=t._getLocation(i,n),o=t.getModuleConfig(i);return{mode:e.mode,location:a,state:n,pageTitle:"",moduleConfig:o}})()}static#e=this.\u0275fac=function(t){return new(t||O)(s.\u0275\u0275inject(s.Injector))};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac})}class T extends O{getChildHistoryStateBuilders(){return(0,s.inject)(te)}getSchemaName(e,t){return(0,u.Z)(function*(){const i=yield d.NavigationUtils.getPageForActionAsync(t.options);return e.page=i,d.NavigationUtils.getCardSchemaName(i)||t.options.entityPageName})()}getModuleName(e,t){var i=()=>super.getModuleName,n=this;return(0,u.Z)(function*(){const a=yield i().call(n,e,t);if(a)return a;const o=e.page?.cardModuleName;if(o)return o;const{uiTypePriority:c,entityName:p}=t.options;return d.NavigationUtils.getEditPageModuleName(p,c)||e.schemaName&&d.NavigationUtils.getModuleName(e.schemaName)})()}getCommonTransitionInfo(e){var t=()=>super.getCommonTransitionInfo,i=this;return(0,u.Z)(function*(){const n=yield t().call(i,e);return n.moduleName?(n?.schemaUIType===L.ClassicUI&&e.options.action!==m.ModelInPageAction.Edit&&(n.isInChain=!0),n):null})()}getModelInitConfigs(e){const{action:t,defaultValues:i,recordId:n}=e.options;if(!t)return null;const a=i?.filter(c=>c.value),o={action:t};return t===m.ModelInPageAction.Add?o.defaultValues=a:o.recordId=d.NavigationUtils.getRecordLookupValue(n),[o]}getStateModuleId(e){const t=e.modelInitConfigs?.[0];return[e.moduleName,t?.recordId,e.schemaName].filter(Boolean).join("_")}static#e=this.\u0275fac=function(){let e;return function(i){return(e||(e=s.\u0275\u0275getInheritedFactory(T)))(i||T)}}();static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac})}class P extends O{getModuleConfig({navigationState:e}){return{keepAlive:e?.keepAlive??!0}}getRootState(e,t){const i=t.options,n={...t?.state??{}};return n.moduleId=i.moduleId,n.moduleName=i.moduleName,n.parameters=i.parameters,n.initConfig=i.initConfig,n.silent??=!1,n}getModuleName(e,t){const i=e.isInChain?e.prevLocation:t.options?.moduleName;return Promise.resolve(i)}static#e=this.\u0275fac=function(){let e;return function(i){return(e||(e=s.\u0275\u0275getInheritedFactory(P)))(i||P)}}();static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac})}class D extends ue{enrichState(e,t){e.target=ae.Modal,e.schemaName=t?.options?.schemaName;const{modelInitConfigs:i,parameters:n}=t.options;return n&&(e.parameters=n),i&&(e.modelInitConfigs=i),Promise.resolve()}getState(e){var t=()=>super.getState,i=this;return(0,u.Z)(function*(){const n=e?.options?.schemaName;return(0,h.isEmpty)(n)||!(yield d.NavigationUtils.isMiniPage(n))?null:t().call(i,e)})()}static#e=this.\u0275fac=function(){let e;return function(i){return(e||(e=s.\u0275\u0275getInheritedFactory(D)))(i||D)}}();static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac})}class A extends O{_getTransitionConfigWithoutSchemaName(e){const t={...(0,h.cloneDeep)(e?.state??{})};return this.locationStrategy.getState()?.isInChain&&(t.isInChain??=!0),t.moduleId=`${t.moduleName}_`,{mode:e.mode,location:t.moduleName,state:t}}getChildHistoryStateBuilders(){return(0,s.inject)(ie)}getSchemaName(e,t){const{schemaName:i}=t.options;return Promise.resolve(i)}getModuleName(e,t){var i=()=>super.getModuleName,n=this;return(0,u.Z)(function*(){return(yield i().call(n,e,t))||d.NavigationUtils.getModuleName(e.schemaName)})()}getRootState(e,t){const i=super.getRootState(e,t),{parameters:n}=t.options;return e.schemaUIType===L.FreedomUI&&n&&(i.parameters=n),i}getModelInitConfigs(e){return e.options.modelInitConfigs}getStateModuleId(e){return[e.moduleName,e.schemaName].filter(Boolean).join("_")}getTransitionConfig(e){if(!e.options.schemaName){const t=this._getTransitionConfigWithoutSchemaName(e);return Promise.resolve(t)}return super.getTransitionConfig(e)}static#e=this.\u0275fac=function(){let e;return function(i){return(e||(e=s.\u0275\u0275getInheritedFactory(A)))(i||A)}}();static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:A,factory:A.\u0275fac})}class F{static#e=this.\u0275fac=function(t){return new(t||F)};static#t=this.\u0275mod=s.\u0275\u0275defineNgModule({type:F});static#i=this.\u0275inj=s.\u0275\u0275defineInjector({providers:[A,{provide:ie,useClass:D,multi:!0}]})}class U{constructor(){this._entityTransitionConfigBuilder=(0,s.inject)(T),this._schemaTransitionConfigBuilder=(0,s.inject)(A),this._moduleTransitionConfigBuilder=(0,s.inject)(P),this._navigationEventNotifier=(0,s.inject)(q),this._router=(0,s.inject)(x),this._historyService=(0,s.inject)(M),this._translateService=(0,s.inject)(Me.TranslateService),this._entitySchemaService=(0,s.inject)(g.EntitySchemaService),this.locationStrategy=(0,s.inject)(N),this.handlerChain=m.HandlerChainService.instance,this._navigationEndEventSubscription=this.subscribeForNavigationEndEvent(),this._navigationPopStateEventSubscription=this.subscribeForNavigationPopStateEvent()}_translate(e){return this._translateService.instant(`Navigation.${e}`)}_getEntityNavigationConfig(e){const t={mode:e?.mode??_.Push,state:e?.state??{},options:e.options};return this._entityTransitionConfigBuilder.getTransitionConfig(t)}_geSchemaNavigationConfig(e){const t={mode:e?.mode??_.Push,state:e?.state??{},options:e.options};return this._schemaTransitionConfigBuilder.getTransitionConfig(t)}_getModuleNavigationConfig(e){const t={mode:e?.mode??_.Push,state:e?.state??{},options:e.options};return this._moduleTransitionConfigBuilder.getTransitionConfig(t)}_showEntityNavigationError(e){console.error(this._translate("DoesntHaveAddPageMessage"));const t=e.options.entityName;this._entitySchemaService.getEntitySchemaByName(t).pipe((0,I.map)(i=>i.entitySchema?.uId),(0,l.take)(1)).subscribe(i=>{if(i){const n=this._translate("GoToEntityDesignerMessage"),c=`${(0,g.getWorkspaceBaseUrl)()}ClientApp/#/EntitySchemaDesigner/${i}?callbackAction=RelatedPage`,p=Pe.String.format(n,c);console.info(p)}})}executeTransition(e){return this._historyService.executeTransition(e),Promise.resolve()}subscribeForNavigationEndEvent(){return this._navigationEventNotifier.navigateEnd$.subscribe()}subscribeForNavigationPopStateEvent(){return this._navigationEventNotifier.popState$.subscribe()}back(){this._historyService.back()}getState(){return this.locationStrategy.getState()}getCurrentState(){const e=this.getState();return Q(e)??e}navigate(e){var t=this;return(0,u.Z)(function*(){t._router.onNavigateStart();let i;switch(e.options.type){case y.Schema:i=yield t._geSchemaNavigationConfig(e);break;case y.Entity:if(i=yield t._getEntityNavigationConfig(e),!i){t._router.onNavigateEnd(),t._showEntityNavigationError(e);return}break;case y.Module:i=yield t._getModuleNavigationConfig(e);break}yield t.executeTransition(i)})()}getActiveRouteInfo(){return this._router.getActiveRouteInfo()}ngOnDestroy(){this._navigationPopStateEventSubscription.unsubscribe(),this._navigationEndEventSubscription.unsubscribe()}static#e=this.\u0275fac=function(t){return new(t||U)};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac,providedIn:"root"})}class B extends ue{_getMiniPageSchemaName(e){return(0,u.Z)(function*(){const t=yield d.NavigationUtils.getPageForActionAsync(e.options),i=t?.schemaGroup==="MiniPage"?t:null;return d.NavigationUtils.getCardSchemaName(i)})()}_getRecordId({options:e}){return typeof e.recordId=="string"?e.recordId:e.recordId?.value}enrichState(e,t){var i=this;return(0,u.Z)(function*(){e.schemaName=yield i._getMiniPageSchemaName(t);const{action:n,messageTags:a}=t.options,o={action:n};n===m.ModelInPageAction.Add?o.defaultValues=t.options?.defaultValues?.filter(c=>c.value):o.recordId=i._getRecordId(t),e.modelInitConfigs=[o],e.messageTags=a,e.target=ae.Modal})()}getState(e){var t=()=>super.getState,i=this;return(0,u.Z)(function*(){return(yield i._getMiniPageSchemaName(e))?t().call(i,e):null})()}static#e=this.\u0275fac=function(){let e;return function(i){return(e||(e=s.\u0275\u0275getInheritedFactory(B)))(i||B)}}();static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:B,factory:B.\u0275fac})}class ${static#e=this.\u0275fac=function(t){return new(t||$)};static#t=this.\u0275mod=s.\u0275\u0275defineNgModule({type:$});static#i=this.\u0275inj=s.\u0275\u0275defineInjector({providers:[T,{provide:te,useClass:B,multi:!0}]})}class G{static#e=this.\u0275fac=function(t){return new(t||G)};static#t=this.\u0275mod=s.\u0275\u0275defineNgModule({type:G});static#i=this.\u0275inj=s.\u0275\u0275defineInjector({providers:[P]})}class Z{_getDefaultValues(e){return e&&e.map(t=>{const i=!(0,h.isUndefined)(t.value)&&!(0,h.isUndefined)(t.displayValue)?t:t.value;return{attributeName:t.name,value:i}})}generate(e){let t=e?.modelInitConfigs;if(!t){const i=e?.operation||e?.operationType;if(i){const n=this._getDefaultValues(e.valuePairs);t=[{action:i,recordId:e.primaryColumnValue||e.recordId,defaultValues:n}]}}return t}static#e=this.\u0275fac=function(t){return new(t||Z)};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:Z,factory:Z.\u0275fac})}class W{constructor(e){this._locationStrategy=e}shouldAppendState(e){return this._locationStrategy.getActivePathInfo().schemaName===e}appendState(e){const t=this._locationStrategy.getActivePathInfo(),i=this._locationStrategy.path().split("/");e.moduleName??=t.moduleName,e.schemaName??=t.schemaName,e.operationType??=t.operationType;let n=3;if(i.length>4&&e?.operationType!=="add"&&(n=4,i[3]&&(e.recordId=t.recordId)),i.length>4){const a=(i.length-n)/2;e.valuePairs=[];for(let o=0;o<a;o++){const c=n+o*2;e.valuePairs[o]={name:i[c],value:i[c+1]}}}else i[3]&&(e.recordId=t.recordId)}static#e=this.\u0275fac=function(t){return new(t||W)(s.\u0275\u0275inject(N))};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:W,factory:W.\u0275fac})}class w{constructor(e,t,i){this._location=e,this._entityTransitionConfigBuilder=t,this._featureService=i}_getRecordUrl(e){var t=this;return(0,u.Z)(function*(){const i={options:{type:y.Entity,action:m.ModelInPageAction.Edit,...e}},n={mode:_.Push,state:{},options:i.options},o=`#${(yield t._entityTransitionConfigBuilder.getTransitionConfig(n)).location}`;return`${t._location.getBaseHref()}/${o}`})()}getUrl(e){var t=this;return(0,u.Z)(function*(){return(yield t._featureService.getFeatureState("DisableEntityRecordUrlCreation"))?yield t._getRecordUrl(e):(0,g.getEntityUrl)(e.entityName,e.recordId)})()}static#e=this.\u0275fac=function(t){return new(t||w)(s.\u0275\u0275inject(N),s.\u0275\u0275inject(T),s.\u0275\u0275inject(m.FeatureService))};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:w,factory:w.\u0275fac})}var he=v(74742);class V{get entityStructure(){return Object.values(window.Terrasoft.configuration.EntityStructure)}get moduleStructure(){return Object.values(window.Terrasoft.configuration.ModuleStructure)}get currentUserWorkplaces(){return window.Terrasoft.configuration.WorkplacesStructure?.CurrentUserWorkplaces}_isSectionExistsInWorkplaces(e){return this.currentUserWorkplaces?.length<1?this.moduleStructure.some(t=>t.sectionSchema===e):this.currentUserWorkplaces.some(t=>t.modules.some(i=>i.sectionName===e))}_isPageAccessible(e){return this.entityStructure.some(t=>t.pages.some(i=>i.cardSchema===e&&(i.isDefault===!0||Object.values(i.actions).some(n=>n===!0))&&i.role!==this._getPageExcludedRole()))}_getPageExcludedRole(){return this._userInfo.isSSP?g.ALL_EMPLOYEES_SYSADMINUNIT_ID:g.ALL_PORTAL_USERS_SYSADMINUNIT_ID}_is7xPageAccessible(e){if(!this._pageExistsInModuleStructure(e)&&!this._userInfo.isSSP)return!0;const t=this.moduleStructure.filter(n=>n.cardSchema===e||n.pages?.some(a=>a.cardSchema===e)).map(n=>n.moduleId);return this.currentUserWorkplaces.flatMap(n=>n.modules).some(n=>t.includes(n.moduleId))}_getRedirectState(){return{state:{moduleName:"Desktop"},path:"Desktop"}}_pageExistsInModuleStructure(e){return this.moduleStructure.some(t=>t.cardSchema===e)}_getRouteTargetType(e){if(e.isInChain)return"ModuleInChain";switch(e.moduleName){case"CardSchemaViewModule":return"FreedomPage";case"CardModuleV2":return"7xPage";case"SectionSchemaViewModule":return"FreedomSection";case"SectionModuleV2":return e.operationType?"7xPage":"7xSection";default:return}}constructor(e){this._injector=e,this._userInfo=this._injector.get(g.UserInfo),this._clientLogService=this._injector.get(g.ClientLogService)}canActivate(e){let t,i;if(this._injector.get(g.ACCESS_CONTROL_WHITELIST)?.includes(e.schemaName))return Promise.resolve(!0);switch(this._getRouteTargetType(e)){case"FreedomSection":case"7xSection":i=g.AclRules.SectionAccess,t=e.schemaName?this._isSectionExistsInWorkplaces(e.schemaName):!0;break;case"FreedomPage":i=g.AclRules.PageAccess,t=this._isPageAccessible(e.schemaName);break;case"7xPage":i=g.AclRules.PageAccess,t=this._is7xPageAccessible(e.schemaName);break;case"ModuleInChain":default:t=!0;break}return t?Promise.resolve(!0):(console.error(new g.AclRightsException().message),this._clientLogService.logError(new g.AclRightsException(e.schemaName,this._userInfo.contactName,i)).subscribe(),Promise.resolve(this._getRedirectState()))}static#e=this.\u0275fac=function(t){return new(t||V)(s.\u0275\u0275inject(s.Injector))};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac})}class Y extends g.SchemaAccessService{constructor(e){super(e),this.injector=e,this._navigationService=this.injector.get(U)}_bypassPageOpeningRestrictions(){return this._navigationService.getState().bypassPageOpeningRestrictions}checkAccess(e){var t=()=>super.checkAccess,i=this;return(0,u.Z)(function*(){e&&!i._bypassPageOpeningRestrictions()&&(yield t().call(i,e))})()}static#e=this.\u0275fac=function(t){return new(t||Y)(s.\u0275\u0275inject(s.Injector))};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:Y,factory:Y.\u0275fac,providedIn:"root"})}const Ae=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u0644\u0627 \u062A\u0648\u062C\u062F \u0635\u0641\u062D\u0629 \u0644\u0633\u062C\u0644\u0627\u062A \u062C\u062F\u064A\u062F\u0629 \u0623\u0648 \u0645\u0648\u062C\u0648\u062F\u0629. \u064A\u062C\u0628 \u0639\u0644\u0649 \u0645\u0633\u0624\u0648\u0644 \u0627\u0644\u0646\u0638\u0627\u0645 \u0627\u0644\u062A\u062D\u0642\u0642 \u0645\u0646 \u0632\u0631 \u0627\u0644\u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0641\u064A \u0648\u0627\u062C\u0647\u0629 \u0627\u0644\u0645\u0633\u062A\u062E\u062F\u0645 \u0627\u0644\u062D\u0631","GoToEntityDesignerMessage":"\u0644\u0625\u0639\u062F\u0627\u062F \u0627\u0644\u0635\u0641\u062D\u0627\u062A\u060C \u0627\u0630\u0647\u0628 \u0625\u0644\u0649 \u0627\u0644\u0631\u0627\u0628\u0637: {0}"}}'),Ue=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u041D\u044F\u043C\u0430 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0430 \u0437\u0430 \u043D\u043E\u0432 \u0438\u043B\u0438 \u0441\u044A\u0449\u0435\u0441\u0442\u0432\u0443\u0432\u0430\u0449 \u0437\u0430\u043F\u0438\u0441. \u0421\u0438\u0441\u0442\u0435\u043C\u043D\u0438\u044F\u0442 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440 \u0442\u0440\u044F\u0431\u0432\u0430 \u0434\u0430 \u043F\u0440\u043E\u0432\u0435\u0440\u0438 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438\u0442\u0435 \u043D\u0430 \u0431\u0443\u0442\u043E\u043D\u0438\u0442\u0435 \u0432 \u043F\u043E\u0442\u0440\u0435\u0431\u0438\u0442\u0435\u043B\u0441\u043A\u0438\u044F \u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441 \u043D\u0430 Freedom","GoToEntityDesignerMessage":"\u0417\u0430 \u0434\u0430 \u043D\u0430\u0441\u0442\u0440\u043E\u0438\u0448 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0438, \u043E\u0442\u0438\u0434\u0438 \u043D\u0430 URL: {0}"}}'),je=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),xe=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Es gibt keine Seite f\xFCr neue oder bestehende Aufzeichnungen. Systemadministrator muss die Einstellungen der Freiheits-Oberfl\xE4che \xFCberpr\xFCfen","GoToEntityDesignerMessage":"Um Seiten einzurichten, gehen Sie zu URL: {0}"}}'),Oe=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),we=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"No hay ninguna p\xE1gina para el registro nuevo o existente. El administrador del sistema debe comprobar la configuraci\xF3n del bot\xF3n en la interfaz de usuario de la Freedom","GoToEntityDesignerMessage":"Para configurar p\xE1ginas vaya a la URL: {0}"}}'),Le=JSON.parse(`{"Navigation":{"DoesntHaveAddPageMessage":"Il n'y a pas de page pour les enregistrements nouveaux ou existants. L'administrateur du syst\xE8me doit v\xE9rifier les param\xE8tres du bouton dans l'interface Freedom UI","GoToEntityDesignerMessage":"Pour configurer les pages, allez \xE0 l'URL : {0}"}}`),ke=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),He=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Ne postoji stranica za nove ili postoje\u0107e zapise. Sistem administrator mora provjeriti postavke tipki u Freedom UI","GoToEntityDesignerMessage":"Za postavljanje stranica idite na URL: {0}"}}'),De=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Nincs oldal \xFAj vagy megl\xE9v\u0151 rekordhoz. A rendszergazd\xE1nak ellen\u0151riznie kell a gombbe\xE1ll\xEDt\xE1sokat a Freedom UI-ban","GoToEntityDesignerMessage":"Az oldalak be\xE1ll\xEDt\xE1s\xE1hoz l\xE9pjen a k\xF6vetkez\u0151 URL-re: {0}"}}'),Fe=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Tidak ada halaman untuk catatan baru atau yang sudah ada. Administrator sistem harus memeriksa pengaturan tombol di Freedom UI","GoToEntityDesignerMessage":"Untuk mengatur halaman, buka URL: {0}"}}'),Be=JSON.parse(`{"Navigation":{"DoesntHaveAddPageMessage":"Non c'\xE8 nessuna pagina per il record nuovo o esistente. L'amministratore di sistema deve controllare le impostazioni del pulsante nella Freedom UI","GoToEntityDesignerMessage":"Per impostare le pagine vai all'URL: {0}"}}`),$e=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u65B0\u898F\u307E\u305F\u306F\u65E2\u5B58\u306E\u30EC\u30B3\u30FC\u30C9\u306E\u30DA\u30FC\u30B8\u306F\u3042\u308A\u307E\u305B\u3093\u3002\u30B7\u30B9\u30C6\u30E0\u7BA1\u7406\u8005\u306FFreedom UI\u306E\u30DC\u30BF\u30F3\u8A2D\u5B9A\u3092\u78BA\u8A8D\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002","GoToEntityDesignerMessage":"\u30DA\u30FC\u30B8\u3092\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3059\u308B\u306B\u306FURL\uFF1A {0} \u306B\u9077\u79FB\u3057\u3066\u304F\u3060\u3055\u3044\u3002"}}'),Ge=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\uC0C8 \uB808\uCF54\uB4DC \uB610\uB294 \uAE30\uC874 \uB808\uCF54\uB4DC\uC5D0 \uB300\uD55C \uD398\uC774\uC9C0\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4. \uC2DC\uC2A4\uD15C \uAD00\uB9AC\uC790\uB294 Freedom UI\uC5D0\uC11C \uBC84\uD2BC \uC124\uC815\uC744 \uD655\uC778\uD574\uC57C \uD569\uB2C8\uB2E4","GoToEntityDesignerMessage":"\uD398\uC774\uC9C0\uB97C \uC124\uC815\uD558\uB824\uBA74 URL\uB85C \uC774\uB3D9\uD569\uB2C8\uB2E4. {0}"}}'),Ze=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),Ve=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),Je=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Nie ma strony dla nowego lub istniej\u0105cego wpisu. Administrator systemu musi sprawdzi\u0107 ustawienia przycisk\xF3w w interfejsie Freedom UI","GoToEntityDesignerMessage":"Aby skonfigurowa\u0107 strony, przejd\u017A do adresu URL: {0}"}}'),ze=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"N\xE3o h\xE1 nenhuma p\xE1gina para os registros novos ou existentes. O administrador do sistema dever\xE1 verificar as configura\xE7\xF5es do bot\xE3o na UI Freedom","GoToEntityDesignerMessage":"Para configurar as p\xE1ginas ir para a URL: {0}"}}'),qe=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),We=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Nu exist\u0103 nicio pagin\u0103 pentru \xEEnregistrarea nou\u0103 sau existent\u0103. Administratorul de sistem trebuie s\u0103 verifice set\u0103rile butonului din Freedom UI","GoToEntityDesignerMessage":"Pentru configurarea paginilor merge\u021Bi la URL: {0}"}}'),Ye=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u0414\u043B\u044F \u0437\u0430\u043F\u0438\u0441\u0438 \u043D\u0435\u0442 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u044B \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F. \u0421\u0438\u0441\u0442\u0435\u043C\u043D\u043E\u043C\u0443 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0442\u043E\u0440\u0443 \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u043F\u0440\u043E\u0432\u0435\u0440\u0438\u0442\u044C \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0443 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u043E\u0432 \u043A\u043D\u043E\u043F\u043A\u0438 \u0432 \u0434\u0438\u0437\u0430\u0439\u043D\u0435\u0440\u0435 Freedom UI","GoToEntityDesignerMessage":"\u0414\u043B\u044F \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 \u0441\u0442\u0440\u0430\u043D\u0438\u0446 \u043F\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u043F\u043E \u0441\u0441\u044B\u043B\u043A\u0435: {0}"}}'),Xe=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"Nuk ka faqe p\xEBr t\xEB dh\xEBna t\xEB reja ose ekzistuese. Administratori i sistemit duhet t\xEB kontrolloj\xEB butonin e konfigurimit n\xEB Freedom Ul","GoToEntityDesignerMessage":"P\xEBr t\xEB konfiguruar faqet shko te URL:{0}"}}'),Qe=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),Ke=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),et=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),tt=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u041D\u0435\u043C\u0430\u0454 \u0441\u0442\u043E\u0440\u0456\u043D\u043A\u0438 \u0434\u043B\u044F \u043D\u043E\u0432\u043E\u0433\u043E \u0430\u0431\u043E \u0456\u0441\u043D\u0443\u044E\u0447\u043E\u0433\u043E \u0437\u0430\u043F\u0438\u0441\u0443. \u0421\u0438\u0441\u0442\u0435\u043C\u043D\u0438\u0439 \u0430\u0434\u043C\u0456\u043D\u0456\u0441\u0442\u0440\u0430\u0442\u043E\u0440 \u043C\u0430\u0454 \u043F\u0435\u0440\u0435\u0432\u0456\u0440\u0438\u0442\u0438 \u043D\u0430\u043B\u0430\u0448\u0442\u0443\u0432\u0430\u043D\u043D\u044F \u043A\u043D\u043E\u043F\u043E\u043A \u0443 Freedom UI","GoToEntityDesignerMessage":"\u0414\u043B\u044F \u043D\u0430\u043B\u0430\u0448\u0442\u0443\u0432\u0430\u043D\u043D\u044F \u0441\u0442\u043E\u0440\u0456\u043D\u043E\u043A \u043F\u0435\u0440\u0435\u0439\u0434\u0456\u0442\u044C \u0434\u043E URL: {0}"}}'),it=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"There is no page for new or existing record. System administrator must check the button settings in the Freedom UI","GoToEntityDesignerMessage":"To set up pages go to URL: {0}"}}'),nt=JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u6CA1\u6709\u65B0\u8BB0\u5F55\u6216\u73B0\u6709\u8BB0\u5F55\u7684\u9875\u9762\u3002\u7CFB\u7EDF\u7BA1\u7406\u5458\u5FC5\u987B\u68C0\u67E5\u81EA\u7531\u754C\u9762\u4E2D\u7684\u6309\u94AE\u8BBE\u7F6E","GoToEntityDesignerMessage":"\u8981\u8BBE\u7F6E\u9875\u9762, \u8BF7\u8BBF\u95EEURL: {0}"}}'),at={"zh-TW":JSON.parse('{"Navigation":{"DoesntHaveAddPageMessage":"\u6CA1\u6709\u65B0\u8BB0\u5F55\u6216\u73B0\u6709\u8BB0\u5F55\u7684\u9875\u9762\u3002\u7CFB\u7EDF\u7BA1\u7406\u5458\u5FC5\u987B\u68C0\u67E5\u81EA\u7531\u754C\u9762\u4E2D\u7684\u6309\u94AE\u8BBE\u7F6E","GoToEntityDesignerMessage":"\u8A2D\u5B9A\u9801\u9762\uFF0C\u8ACB\u524D\u5F80URL: {0}"}}'),"hr-HR":He,"lv-LV":Ze,"hu-HU":De,"zh-CN":nt,"vi-VN":it,"uk-UA":tt,"tr-TR":et,"th-TH":Ke,"sv-SE":Qe,"sq-AL":Xe,"ro-RO":We,"pt-PT":qe,"pt-BR":ze,"pl-PL":Je,"nl-NL":Ve,"ko-KR":Ge,"ja-JP":$e,"it-IT":Be,"id-ID":Fe,"he-IL":ke,"fr-FR":Le,"es-ES":we,"de-DE":xe,"cs-CZ":je,"bg-BG":Ue,"ar-SA":Ae,"en-US":Oe,"ru-RU":Ye};let ne=class pe{static#e=this.\u0275fac=function(t){return new(t||pe)};static#t=this.\u0275mod=s.\u0275\u0275defineNgModule({type:pe});static#i=this.\u0275inj=s.\u0275\u0275defineInjector({providers:[Z,w,{provide:N,useClass:k},j,{provide:de,useClass:V,multi:!0},{provide:g.SchemaAccessService,useClass:Y},b.LoggerService,m.RightsService],imports:[b.CrtLibTranslateModule.forRoot({i18n:at}),$,F,G]})};ne=(0,he.__decorate)([(0,m.CrtModule)({requestHandlers:[]})],ne),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(ne,{imports:[b.CrtLibTranslateModule,$,F,G]})}();let ge=class extends m.BaseRequestHandler{constructor(e,t){super(),this._navigationService=e,this._recordUrlCreator=t}_getEntityPageUITypePriority(e){var t=this;return(0,u.Z)(function*(){const i=t._navigationService.getActiveRouteInfo().schemaName;return i&&(yield d.NavigationUtils.isAngularListPage(i))&&d.NavigationUtils.getSectionEntityName(i)===e?d.UITypePriority.PreferFreedomUI:d.UITypePriority.Auto})()}_openEntityPage(e,t){var i=this;return(0,u.Z)(function*(){const n=t,a=yield i._getEntityPageUITypePriority(n?.entityName);yield i._navigationService.navigate({mode:n.replaceHistoryState?_.Replace:_.Push,options:{type:y.Entity,action:e,uiTypePriority:a,...n}})})()}_openDuplicatesPage(e){var t=this;return(0,u.Z)(function*(){yield t._navigationService.navigate({mode:_.Push,state:{duplicatesSchemaName:e.entityName},options:{type:y.Schema,schemaName:e.schemaName}})})()}_getEntityPageUrl(e){var t=this;return(0,u.Z)(function*(){const i=e,n=yield t._getEntityPageUITypePriority(i?.entityName);return t._recordUrlCreator.getUrl({uiTypePriority:n,...i})})()}handle(e){var t=this;return(0,u.Z)(function*(){const i=e?.payload;switch(e.action){case"BackHistoryState":t._navigationService.back();break;case"AddRecord":yield t._openEntityPage(m.ModelInPageAction.Add,i);break;case"EditRecord":yield t._openEntityPage(m.ModelInPageAction.Edit,i);break;case"CopyRecord":yield t._openEntityPage(m.ModelInPageAction.Copy,i);break;case"OpenDuplicatesPage":yield t._openDuplicatesPage(i);break;case"OpenPage":yield t._navigationService.navigate({mode:_.Push,options:{type:y.Schema,...i}});break;case"HasEntityEditPage":return d.NavigationUtils.hasEntityEditPage(i);case"LoadRightsModule":yield t._navigationService.navigate({mode:_.Push,options:{type:y.Module,initConfig:{moduleConfig:i},moduleId:b.NameGenerator.generateUnique("Rights_module"),moduleName:"Rights"},state:{isInChain:!0,silent:!0,_internalNotSilentIn8x:!0}});break;case"GetRecordUrl":return t._getEntityPageUrl(i);case"IsTelephonyEnabled":case"InitDataViews":break}return t.next?.handle(e)})()}};ge=(0,he.__decorate)([(0,m.CrtRequestHandler)({requestType:"crt.7XRequest",type:"crt.Crt7XRequestHandler"}),(0,he.__metadata)("design:paramtypes",[U,w])],ge);var st=v(41307);class ot extends m.BaseRequestHandler{constructor(e){super(),this._rightsService=e.get(st.RightsService),this._navigationService=e.get(U)}_redirectToMainApplication(){var e=this;return(0,u.Z)(function*(){yield e._navigationService.navigate({mode:_.Push,options:{type:y.Schema},state:{moduleName:"Desktop"}})})()}getOperation(){return""}handle(e){var t=this;return(0,u.Z)(function*(){return(yield(0,l.firstValueFrom)(t._rightsService.getCanExecuteOperation(t.getOperation())))?t.next?.handle(e):t._redirectToMainApplication()})()}}class rt{constructor(){this.navigateStart$=new l.Subject,this.navigateEnd$=new l.Subject,this.historyState$=new l.Subject,this._history=[]}push(e){const t=this._history.length+1;e={...e,historyIndex:t},this._history.push(e),this.historyState$.next(e)}replace(e){const t=this._history.length;e={...e,historyIndex:t},this._history[this._history.length-1]=e,this.historyState$.next(e)}back(){this._history.pop();const e=this._history[this._history.length-1];this.historyState$.next(e)}getNavigation$(e){return this.historyState$.pipe((0,l.map)(t=>({state:t,...E.parse(window.location.href)})))}getChildNavigation$(e,t){return(0,l.of)()}onNavigateEnd(){}getActiveRouteInfo(){const e=this._history.at(-1);return{moduleName:e.moduleName,schemaName:e.schemaName,operationType:e.operation,recordId:e.recordId}}}}}]);
