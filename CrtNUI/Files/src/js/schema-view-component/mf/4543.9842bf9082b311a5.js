(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[4543],{3272:(B,w,i)=>{i.d(w,{A:()=>P});var g=i(94450),n=i.n(g);const P=new g.InjectionToken("ROUTER_OUTLET_HISTORY_VIEW_LIMIT_TOKEN")},15915:(B,w,i)=>{i.d(w,{B:()=>R});var g=i(33177),n=i.n(g),P=i(49475),L=i.n(P),S=i(34617),E=i.n(S),m=i(97600),y=i.n(m),j=i(3272),u=i(32935),p=i(94450),I=i.n(p);class R{get lastTransition(){return this._lastTransition}get length(){return this._items.length}constructor(s,o,r){this._window=s,this._featureValues=r,this._historyLimit=20,this._items=[],this._previous=-1,this._current=-1,o!==null&&(this._historyLimit=o),(this._window.__crtHistory??=[]).push(this)}_assertIndexedState(s){if(!("historyIndex"in s)||isNaN(s.historyIndex))throw new Error("History state should have historyIndex.")}_enforceHistoryLimit(){for(let s=this._current+1;s<this._items.length;s++)this.destroy(s);for(let s=0;s<this._current-this._historyLimit;s++)this.destroy(s)}destroy(s){const o=this._items[s];o?.view&&(o.view.destroy(),o.view=null)}_hasChildrenState(s){const o=s.state;return!(0,m.isEmpty)(o.children)}_getRootViewForChildrenRouting(){let s=!0;const o=this._items[this._current].state;for(let r=this._current-1;r>=0;r--){const c=this._items[r];if((0,m.isEmpty)(c)||!s)return null;if((0,S.crtStatesEqual)(o,c.state)&&s&&!(0,m.isEmpty)(c?.view?.pageRef))return c.view;s=this._hasChildrenState(c)}return null}goTo(s){this._assertIndexedState(s),this._previous=this._current,this._current=s.historyIndex;const o=this._current<this._previous,r=o&&!this._items[this._current],c=this._current===this._previous,d=this._current>this._previous;this._lastTransition={isBack:o,isReplace:c,isPush:d},!(s.silent&&!s._internalNotSilentIn8x&&!o)&&(c&&this.destroy(this._previous),(r||c||d)&&(this._items[this._current]={state:s}),d&&this._items.splice(this._current+1),this._enforceHistoryLimit())}canRestoreView(){const o=this._getCurrentView()?.pageRef;return this._current<this._previous&&Boolean(o)}_getCurrentView(){const s=this._items[this._current],o=this._hasChildrenState(s);let r;return o&&(0,m.isEmpty)(s?.view?.pageRef)&&(r=this._getRootViewForChildrenRouting()),r?new u.f7(r.pageRef,s?.view?.modalRefs,r.schemaState,r.pageRefReusable,r.scrollPositions,this._featureValues):s?.view}getView(){if(!this.canRestoreView())throw new Error("Cannot restore view");return this._getCurrentView()}getViewByOffset(s){return this._items[this._current+s]?.view}validateBeforeStore(s){const o=this._items[this._current].view;if(o?.pageRef&&o?.pageRef!==s.pageRef)throw new Error("This history item already contain another view. If you want to change view, do replace history state first.")}storeView(s){this.validateBeforeStore(s),this._items[this._current].view=s}static#e=this.\u0275fac=function(o){return new(o||R)(p.\u0275\u0275inject(g.WINDOW_TOKEN),p.\u0275\u0275inject(j.A,8),p.\u0275\u0275inject(P.FEATURE_VALUES))};static#t=this.\u0275prov=p.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac})}},85431:(B,w,i)=>{i.d(w,{vq:()=>x,ex:()=>T});var g=i(27049);const n=1;class P{constructor(l,_){this._bindingContext=l,this._dataGridViewConfig=_}getViewModelItemsAttributeName(){const l=this._dataGridViewConfig.items;if(l&&typeof l=="string")return l.substring(n)}getViewModel(){return this._bindingContext.viewModel$.pipe((0,g.take)(1))}getDataSourceName(){return this.getViewModel().pipe((0,g.map)(l=>l.getBoundDataSourceName(this.getViewModelItemsAttributeName())))}}var L=i(41307),S=i(34038);const E="DisableCompiledCellView",m="EnableDataGridColumnEdit";function y(b){return b.getFeatureState(E).pipe((0,g.distinctUntilChanged)(),(0,g.map)(l=>!l))}const j={provide:S.USE_DATA_TABLE_COMPILED_CELLS_VIEW,useFactory:y,deps:[L.FeatureService]};var u=i(94450),p=i(14537);class I{resolve(l){return new P(l.get(p.BINDING_CONTEXT),l.get(p.VIEW_ELEMENT_CONFIG))}static#e=this.\u0275fac=function(_){return new(_||I)};static#t=this.\u0275prov=u.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac,providedIn:"root"})}var R=i(46338),C=i(21322);class s{constructor(l,_){this._featureService=l,this._rightsService=_}getFeatures(){return(0,C.forkJoin)([this._featureService.getFeatureState(R.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE),this._featureService.getFeatureState(m),this._rightsService.getCanExecuteOperation(R.CAN_CREATE_DEFAULT_GRID_SETTING_OPERATION_CODE)]).pipe((0,g.map)(([l,_,M])=>({rows:{toolbar:!0,numeration:!0,selection:{enable:!1,multiple:!1}},columns:{toolbar:!0,sorting:!0,resizing:!0,dragAndDrop:!0,editing:_,adding:!0},cells:{selection:!0},header:{visible:!0},operations:{canCreateDefaultGridSettings:M},editable:!l})))}static#e=this.\u0275fac=function(_){return new(_||s)(u.\u0275\u0275inject(L.FeatureService),u.\u0275\u0275inject(L.RightsService))};static#t=this.\u0275prov=u.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}let o={};const r={provide:S.DATA_GRID_FEATURES,useFactory:()=>o};class c{constructor(l){this._dataGridFeaturesService=l}init(){return this._dataGridFeaturesService.getFeatures().pipe((0,g.tap)(l=>o=l),(0,g.map)(()=>{}))}static#e=this.\u0275fac=function(_){return new(_||c)(u.\u0275\u0275inject(s))};static#t=this.\u0275prov=u.\u0275\u0275defineInjectable({token:c,factory:c.\u0275fac,providedIn:"root"})}var d=i(8239),h=i(49475),v=i(52045),A=i(24709),V=i(97600);class T extends R.BaseDataGridStateHandlerService{constructor(l,_,M,N,D,O,e,t){super(l),this._schemaPartsService=_,this._metadataModifierService=M,this._featureValues=N,this._dataGridDesignSettingsProvider=D,this._dataGridDesignSettingsUpdater=O,this._dataGridActiveFolderDesignSettingsProvider=e,this._dataGridMetadataTransferService=t}_getActiveFolderDataGridDesignSettings(l){return this.viewModel$.pipe((0,g.switchMap)(_=>this._dataGridActiveFolderDesignSettingsProvider.get({viewConfig:l,viewModel:_,metadata:this.schemaService.schema})))}_saveSettingsForFolder(l,_){const{columns:M,viewElementConfig:N}=_,D=(0,V.cloneDeep)(M),O=l.columns?.map(t=>t?.viewMetadata);this._metadataModifierService.revert(D),this._setColumnsCaptionResourceMacros(D,O);const e=this._dataGridDesignSettingsUpdater.updateColumns(l,D,N);return this.viewModel$.pipe((0,g.switchMap)(t=>this._dataGridActiveFolderDesignSettingsProvider.set({viewConfig:N,viewModel:t,metadata:this.schemaService.schema},e)),(0,g.switchMap)(()=>this._schemaPartsService.commit({silent:!1})),(0,g.map)(()=>{}))}_setColumnsCaptionResourceMacros(l,_){(l??[]).filter(M=>M&&!(0,h.isResourceMacros)(M.caption)).forEach(M=>{const N=this._getColumnCaptionResourceKey(M,_);M.caption=(0,h.toResourceMacros)(N)})}_getColumnCaptionResourceKey(l,_){const M=_?.find(O=>O?.id&&O.id===l.id),N=(0,h.extractResourcesKey)(M?.caption),D=(0,S.createDataGridColumnCaptionResourceKey)(l);return N||D}_saveSettingsToProfile(l){var _=this;const{columns:M,viewElementConfig:N}=l,D=(0,V.cloneDeep)(M);let O=D?.some(e=>e.changed);return(0,C.from)(this._schemaPartsService.apply(function(){var e=(0,d.Z)(function*([t,a]){const f=t.getViewConfigInfoByName(N?.name)?.viewConfig;if(!f)return;const F=yield _._dataGridDesignSettingsProvider.get(f,t,a),k=F.columns?.map(z=>z?.viewMetadata).filter(Boolean);_._metadataModifierService.revert(D),_._setColumnsCaptionResourceMacros(D,k),O=O||D?.length!==k?.length;const H=_._dataGridDesignSettingsUpdater.updateColumns(F,D,f);f._designOptions?.designSettings||(yield _._revertDeprecatedMetadata(f.name,H,t,a)),(0,V.set)(f,"_designOptions.designSettings",H)});return function(t){return e.apply(this,arguments)}}())).pipe((0,g.switchMap)(()=>this._schemaPartsService.commit({silent:O===!1})),(0,g.map)(()=>{}))}_revertDeprecatedMetadata(l,_,M,N){var D=this;return(0,d.Z)(function*(){const[O]=yield D._schemaPartsService.use("ALL_EMPLOYERS");yield D._dataGridMetadataTransferService.transfer(O,M,l);const e={localizableStrings:{}};Object.keys(_.resources?.localizableStrings).forEach(t=>e.localizableStrings[t]=void 0),yield N.upsertResources(e)})()}innerHandle(l){return this._featureValues.DisableDataGridSettingsByFolders?this._saveSettingsToProfile(l):this._getActiveFolderDataGridDesignSettings(l.viewElementConfig).pipe((0,g.switchMap)(_=>_?this._saveSettingsForFolder(_,l):this._saveSettingsToProfile(l)))}handle(l,_){return super.handle({...l},_)}static#e=this.\u0275fac=function(_){return new(_||T)(u.\u0275\u0275inject(v.SchemaService),u.\u0275\u0275inject(v.SchemaPartsService),u.\u0275\u0275inject(A.MetadataModifierService),u.\u0275\u0275inject(h.FEATURE_VALUES),u.\u0275\u0275inject(S.DataGridDesignSettingsProvider),u.\u0275\u0275inject(S.DataGridDesignSettingsUpdater),u.\u0275\u0275inject(S.DataGridActiveFolderDesignSettingsProvider),u.\u0275\u0275inject(S.DataGridMetadataTransferService))};static#t=this.\u0275prov=u.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac})}var U=i(74742),K=i(75378);function W(b){return()=>(0,C.lastValueFrom)(b.init(),{defaultValue:null})}let x=class G{static#e=this.\u0275fac=function(_){return new(_||G)};static#t=this.\u0275mod=u.\u0275\u0275defineNgModule({type:G});static#s=this.\u0275inj=u.\u0275\u0275defineInjector({providers:[r,j,{provide:u.APP_INITIALIZER,useFactory:W,deps:[c],multi:!0}],imports:[R.CrtDataGridCdkModule,S.CrtDataGridToolbarModule]})};x=(0,U.__decorate)([(0,K.CrtModule)({includes:[R.CrtDataGridCdkModule]})],x),function(){(typeof ngJitMode>"u"||ngJitMode)&&u.\u0275\u0275setNgModuleScope(x,{imports:[R.CrtDataGridCdkModule],exports:[S.CrtDataGridToolbarModule]})}()},32935:(B,w,i)=>{i.d(w,{aK:()=>n,Hi:()=>g,HO:()=>j,TV:()=>m,pb:()=>E,dh:()=>y,Vr:()=>R,f7:()=>L});class g{constructor(s){s&&(this.title=s.title,this.schemaName=s.schemaName)}}class n{}var P=i(21322);class L{constructor(s=null,o=new Map,r=s?.instance?.schemaState,c=!1,d=s?.instance?.scrollPositions,h={}){this.pageRef=s,this.modalRefs=o,this.schemaState=r,this.pageRefReusable=c,this.scrollPositions=d,this._featureValues=h,this.isDestroyed=!1}_destroyModalViews(){const s=this?.modalRefs;s?.size&&(Array.from(s.values()).forEach(o=>o.close()),this.modalRefs.clear())}_destroyViewModelAsync(s){return this._featureValues.DisableHandleFixedViewModelResumePauseRequest?s?.destroy().pipe((0,P.take)(1)):(0,P.concat)(s?.pause()??(0,P.of)(),s?.destroy()??(0,P.of)()).pipe((0,P.take)(2))}destroy(){if(this._destroyModalViews(),this.pageRefReusable)this.pageRef?.instance?.schemaComponent?.clearResources(this.schemaState.viewModel),this._destroyViewModelAsync(this.schemaState.viewModel).subscribe(),this.schemaState.viewModel=null,this.schemaState.models=null,this.schemaState=null;else{const s=this.pageRef?.instance?.schemaComponent?.schemaState;this._destroyViewModelAsync(s?.viewModel).subscribe(),this.pageRef?.destroy(),this.pageRef?.hostView?.destroy(),this.pageRef=null}this.isDestroyed=!0}get viewModel(){return this._featureValues?.UseSchemaOutletReuseViewStrategy?this?.schemaState?.viewModel:this?.pageRef?.instance?.schemaState?.viewModel}}var S=i(94450),E;(function(C){C.LookupValues="lookupValues",C.Filter="filter"})(E||(E={}));const m=E.LookupValues;var y;(function(C){C[C.Legacy=0]="Legacy",C[C.New=1]="New"})(y||(y={}));const j=new S.InjectionToken("PageLookupDataToken");var u=i(8239),p=i(75378),I=i(97600);class R{get canceled(){return this._canceled}get filter(){return this._filter}constructor(s){this._cachedLookupValues=[],this._entityName=s?.entityName,this._selectionState=s?.selectionState,this._filter=s?.filter,this._cachedLookupValues=s?.cachedLookupValues??[],this._canceled=s?.canceled??!1}_getFilterByPrimaryValues(s,o){const r=new p.EntitySchemaQuery("tempTable"),c=new p.ColumnExpression({columnPath:s}),d=o.map(A=>new p.ParameterExpression({value:A})),h=new p.InFilter(p.ComparisonType.Equal,c,d);return r.filters.add(h),r.getMetadata().filters}_loadLookupValues(s,o,r,c){return(0,u.Z)(function*(){const{primaryAttributeName:d,primaryDisplayAttributeName:h,primaryColorAttributeName:v}=o,A=[d,h,v].filter(Boolean);return(yield s.load({attributes:A,parameters:[{type:p.ModelParameterType.Filter,value:r}],options:c?{pagingConfig:c}:{}})).map(T=>({value:T[d],displayValue:T[h],primaryColorValue:T[v]}))})()}_loadLookupValuesByPrimaryValues(s,o){var r=this;return(0,u.Z)(function*(){if(!o.length)return[];const c=yield p.Model.create(s),d=yield c.getSchema(),h=r._getFilterByPrimaryValues(d.primaryAttributeName,o);return r._loadLookupValues(c,d,h)})()}_isCached(s){return this._cachedLookupValues.some(o=>o.value===s)}getLookupValues(s){var o=this;return(0,u.Z)(function*(){if(!o._selectionState||o.canceled)return[];const r=s?.pagingConfig;if(o._selectionState?.type==="specific"){let c;(0,I.isUndefined)(r?.rowsOffset)||(0,I.isUndefined)(r?.rowCount)?c=[...o._selectionState.selected]:c=o._selectionState.selected.slice(r?.rowsOffset,r?.rowsOffset+r?.rowCount);const d=c.filter(v=>!o._isCached(v)),h=yield o._loadLookupValuesByPrimaryValues(o._entityName,d);return c.map(v=>o._cachedLookupValues.find(A=>A.value===v)||h.find(A=>A.value===v))}else{const c=yield p.Model.create(o._entityName),d=yield c.getSchema();return o._loadLookupValues(c,d,o._filter,r)}})()}}},67483:(B,w,i)=>{i.d(w,{jZ:()=>K,SX:()=>j,j_:()=>c,Tx:()=>M,b:()=>V,zi:()=>r,jW:()=>h,mJ:()=>d,dO:()=>T,am:()=>W.a,Gm:()=>y,F$:()=>x.F,Lu:()=>x.L,Q1:()=>A,bn:()=>D,N1:()=>u,FL:()=>R,Wn:()=>_});var g=i(2876),n=i(94450),P=i(75378),L=i(77207),S=i(49475),E=i(97600),m=i(21322),y;(function(O){O[O.AddRelatedRecords=0]="AddRelatedRecords",O[O.RemoveRelatedRecords=1]="RemoveRelatedRecords"})(y||(y={}));class j{constructor(){this._translateService=(0,n.inject)(L.TranslateService),this._httpClient=(0,n.inject)(g.HttpClient),this._userInfo=(0,n.inject)(S.UserInfo)}get _relatedInMainRecordsServiceEndpoint(){return(this._userInfo.isSSP?"ssp/":"")+`rest/${this.relatedInMainRecordsServiceName}/`}_isInvalidParameters(e){return(0,E.isEmpty)(e.relatedRecordsSchemaName)||(0,E.isEmpty)(e.relatedInMainRecordsSchemaName)||(0,E.isEmpty)(e.relatedRecordColumnName)||(0,E.isEmpty)(e.mainRecordColumnName)||!this._isValidFilters(e.relatedRecordsFilters)||!this._isValidFilters(e.mainRecordsFilters)}_isValidFilters(e){return(0,E.isObject)(e)&&"items"in e&&!(0,E.isEmpty)(e.items)}_catchHttpErrorResponse(e){return(0,m.of)({success:!1,message:e.error?.errorInfo?.message??e.message})}_createEsqWithFilters(e,t){const a=new P.EntitySchemaQuery(e);return this._addFiltersToEsq(a,t),a}_addFiltersToEsq(e,t){Object.entries(t.items).forEach(([a,f])=>{e.filters.add(f,a)})}getServiceResultMessage(e,t,a){if(e.success){const f=this.relatedRecordsActionsNames.get(t);return this._translateService.instant(`${this.relatedInMainRecordsServiceName}.ServiceResult.${f}${a}`,{count:(0,E.get)(e,"processedRecordsCount",null)})}return e.errorInfo?.message||this._translateService.instant("BaseRelatedInMainRecordsService.ServiceResult.ErrorMessage")}executeAction(e,t){return this._isInvalidParameters(t)?(0,m.of)({success:!1,message:this._translateService.instant("BaseRelatedInMainRecordsService.NotValidParametersMessage")}):this.process(e,t)}process(e,t){const a=this.createRelatedRecordsEsq(t),f=this.createMainRecordsEsq(t),F=this.createRequest(a,f,t);return this.callService(e,F,t)}createRelatedRecordsEsq(e){return this._createEsqWithFilters(e.relatedRecordsSchemaName,e.relatedRecordsFilters)}createMainRecordsEsq(e){return this._createEsqWithFilters(e.mainRecordsSchemaName,e.mainRecordsFilters)}callService(e,t,a){const f=this.relatedRecordsActionsNames.get(e);return this._httpClient.post(`${this._relatedInMainRecordsServiceEndpoint}${f}`,{request:t}).pipe((0,m.map)(F=>({success:F.success,message:this.getServiceResultMessage(F,e,"Message")})),(0,m.catchError)(F=>this._catchHttpErrorResponse(F)))}addRelatedRecords(e){return this.executeAction(y.AddRelatedRecords,e)}removeRelatedRecords(e){return this.executeAction(y.RemoveRelatedRecords,e)}}class u extends j{constructor(){super(...arguments),this.relatedInMainRecordsServiceName="StaticFolderService",this.relatedRecordsActionsNames=new Map([[y.AddRelatedRecords,"AddRecords"],[y.RemoveRelatedRecords,"RemoveRecords"]])}createRequest(e,t,a){return{recordsEsqSerialized:JSON.stringify(e.getMetadata()),foldersEsqSerialized:JSON.stringify(t.getMetadata()),recordInFolderRecordsSchemaName:a.relatedInMainRecordsSchemaName,recordColumnName:a.relatedRecordColumnName,folderColumnName:a.mainRecordColumnName,defaultValues:a.defaultValues?JSON.stringify(a.defaultValues):null}}static#e=this.\u0275fac=function(){let e;return function(a){return(e||(e=n.\u0275\u0275getInheritedFactory(u)))(a||u)}}();static#t=this.\u0275prov=n.\u0275\u0275defineInjectable({token:u,factory:u.\u0275fac})}var p=i(41307),I=i(6523);class R extends j{constructor(){super(...arguments),this._featureValues=(0,n.inject)(S.FEATURE_VALUES),this._processEngineService=(0,n.inject)(p.ProcessEngineService),this._queryExecutor=(0,n.inject)(I.QueryExecutor),this._disableAsyncTaggingFeatureName="DisableAsyncTagging",this._taggingProcessName="TaggingProcess",this._syncRequestMaxRecordsCount=200,this.relatedInMainRecordsServiceName="TaggingService",this.relatedRecordsActionsNames=new Map([[y.AddRelatedRecords,"AddTags"],[y.RemoveRelatedRecords,"RemoveTags"]])}_isDisabledAsyncTagging(){return!!this._featureValues[this._disableAsyncTaggingFeatureName]}_callProcess(e,t){const a=this._createProcessParameters(e,t);return this._processEngineService.executeProcessByName(this._taggingProcessName,a).pipe((0,m.map)(f=>({success:f.success,message:super.getServiceResultMessage(f,e,"SuccessfulRunProcess")})))}_createProcessParameters(e,t){return{TaggingAction:this.relatedRecordsActionsNames.get(e),RecordsEsqSerialized:t.recordsEsqSerialized,TagsEsqSerialized:t.tagsEsqSerialized,TagInRecordSchemaName:t.tagInRecordSchemaName,RecordColumnName:t.recordColumnName,TagColumnName:t.tagColumnName,DefaultValues:t.defaultValues}}_getRecordsCount(e){const t=this.createRelatedRecordsEsq(e);this._addRowCountToEsq(t);const a=this.createMainRecordsEsq(e);return this._addRowCountToEsq(a),(0,m.forkJoin)([this._getEsqRecordsCount(t),this._getEsqRecordsCount(a)]).pipe((0,m.map)(([f,F])=>f*F))}_addRowCountToEsq(e){e.rowCount=this._syncRequestMaxRecordsCount+1}_getEsqRecordsCount(e){return this._queryExecutor.executeSelectQuery(e).pipe((0,m.map)(t=>t.length))}_isNeedCallService(e){return this._isDisabledAsyncTagging()?(0,m.of)(!0):this._getRecordsCount(e).pipe((0,m.map)(t=>t<=this._syncRequestMaxRecordsCount))}createRequest(e,t,a){return{recordsEsqSerialized:JSON.stringify(e.getMetadata()),tagsEsqSerialized:JSON.stringify(t.getMetadata()),tagInRecordSchemaName:a.relatedInMainRecordsSchemaName,recordColumnName:a.relatedRecordColumnName,tagColumnName:a.mainRecordColumnName,defaultValues:a.defaultValues?JSON.stringify(a.defaultValues):null}}callService(e,t,a){return this._isNeedCallService(a).pipe((0,m.switchMap)(f=>f?super.callService(e,t,a):this._callProcess(e,t)))}static#e=this.\u0275fac=function(){let e;return function(a){return(e||(e=n.\u0275\u0275getInheritedFactory(R)))(a||R)}}();static#t=this.\u0275prov=n.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac})}var C=i(8239),s=i(27049),o=i(32935);const r="Desktop",c="CrtCurrentDesktop";class d{constructor(e,t,a,f){this._queryExecutor=e,this._sysSettingsService=t,this._rightsService=a,this._userProfileService=f,this._canEditDesktopOperationName="CanManageSolution",this._currentDesktopSchemaNameInitialized=!1,this._canEditDesktopSchemaInitialized=!1,this._canEditDesktopSchema=!1}_convertToDesktops(e,t){const a=t.get("schemaName"),f=t.get("title");return e.map(F=>new o.Hi({schemaName:F[a],title:F[f]}))}_requestDesktopSysSetting(){return(0,m.lastValueFrom)(this._sysSettingsService.getValueByCode(c,""))}_requestDesktopProfileSettings(){return(0,m.lastValueFrom)(this._userProfileService.getProfile(c))}getCurrentDesktopSchemaName(){var e=this;return(0,C.Z)(function*(){if(!e._currentDesktopSchemaNameInitialized){let t=yield e._requestDesktopProfileSettings();(0,E.isEmpty)(t)&&(t=yield e._requestDesktopSysSetting()),e._currentDesktopSchemaName=t,e._currentDesktopSchemaNameInitialized=!0}return e._currentDesktopSchemaName})()}getUserDesktops(){const e=new Map([["schemaName","DesktopSchemaName"],["title","Title"]]),t=new P.EntitySchemaQuery(r);return t.addSchemaColumn(e.get("schemaName")),t.addSchemaColumn(e.get("title")),(0,m.firstValueFrom)(this._queryExecutor.executeSelectQuery(t).pipe((0,m.map)(a=>this._convertToDesktops(a,e))))}setCurrentDesktop(e){var t=this;return(0,C.Z)(function*(){const a=e?e.schemaName:null;t._currentDesktopSchemaName=a,yield(0,m.firstValueFrom)(t._userProfileService.saveProfile(c,a))})()}canEditDesktop(){return this._canEditDesktopSchemaInitialized?Promise.resolve(this._canEditDesktopSchema):(0,m.lastValueFrom)(this._rightsService.getCanExecuteOperation(this._canEditDesktopOperationName).pipe((0,s.tap)(e=>{this._canEditDesktopSchema=e,this._canEditDesktopSchemaInitialized=!0})))}static#e=this.\u0275fac=function(t){return new(t||d)(n.\u0275\u0275inject(I.QueryExecutor),n.\u0275\u0275inject(p.SysSettingsService),n.\u0275\u0275inject(p.RightsService),n.\u0275\u0275inject(p.UserProfileService))};static#t=this.\u0275prov=n.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac,providedIn:"root"})}class h{constructor(){this._repository=new Map}set(e,t){this._repository.set(e,t)}get(e){return this._repository.get(e)}getAll(){return Array.from(this._repository.values())}static#e=this.\u0275fac=function(t){return new(t||h)};static#t=this.\u0275prov=n.\u0275\u0275defineInjectable({token:h,factory:h.\u0275fac,providedIn:"root"})}var v=i(24709);class A extends v.DataSourceFactoryService{constructor(e,t,a){super(t,a),this._dataSourceRepository=e}create(e,t,a){return super.create(e,t,a).pipe((0,s.tap)(f=>{this._dataSourceRepository.set(e,f)}))}static#e=this.\u0275fac=function(t){return new(t||A)(n.\u0275\u0275inject(h),n.\u0275\u0275inject(n.Injector),n.\u0275\u0275inject(v.DataSourceTypeResolver))};static#t=this.\u0275prov=n.\u0275\u0275defineInjectable({token:A,factory:A.\u0275fac})}class V{constructor(e){this._configurationDataService=e}getConfigurationStructure(){return this._configurationDataService.getData(!0).pipe((0,m.map)(e=>{if(!e.success)throw new Error(e.errorInfo.message);return e.data}))}static#e=this.\u0275fac=function(t){return new(t||V)(n.\u0275\u0275inject(p.ConfigurationDataService))};static#t=this.\u0275prov=n.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac,providedIn:"any"})}class T extends S.BaseFileUploadProcessingService{constructor(e,t){super(e,t)}createFileErrorMessageForLogs(e){return super.createFileErrorMessageForLogs(e)}processSelectedFiles(e,t){var a=()=>super.processSelectedFiles,f=this;return(0,C.Z)(function*(){return a().call(f,e,t)})()}static#e=this.\u0275fac=function(t){return new(t||T)(n.\u0275\u0275inject(L.TranslateService),n.\u0275\u0275inject(P.SysSettingsService))};static#t=this.\u0275prov=n.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac,providedIn:"root"})}var U=i(34617);class K{getDefaultAppearanceSettings(e){return(0,m.from)(U.NavigationUtils.isMiniPage(e)).pipe((0,m.map)(t=>({modalSettings:{size:t?S.ModalSize.Small:S.ModalSize.ExtraLarge}})))}}var W=i(39630),x=i(76596),b=i(33177),l=i(15915);class _ extends v.ViewModelDataDelayer{constructor(e,t,a,f){super(),this._crtRouter=e,this._routerOutletHistory=t,this._featureValues=a,this._window=f,this._disableDelayingModelEventsFeatureName="DisableDelayingModelEvents",this._disableDelayingModelsEventFeatureState=!1,this._disableOffsetForDelayingModelEventsFeatureName="DisableOffsetForDelayingModelEvents",this._disableOffsetForDelayingModelEventsFeatureState=!1,this._defaultViewLoadingOffset=-1,this._subscriptions=new m.Subscription,this._loadTriggerSubject=new m.Subject,this.loadTrigger$=this._loadTriggerSubject.asObservable(),this._isAngularHost=(0,E.get)(this._window,"Terrasoft")?.isAngularHost,this._isAngularHost&&(this._initFeatureStates(),this._disableDelayingModelsEventFeatureState||this._subscribeOnNavigation())}setViewModel(e){this._viewModel||(this._viewModel=e)}_initFeatureStates(){this._disableDelayingModelsEventFeatureState=this._featureValues[this._disableDelayingModelEventsFeatureName]??!1,this._disableDelayingModelsEventFeatureState||(this._disableOffsetForDelayingModelEventsFeatureState=this._featureValues[this._disableOffsetForDelayingModelEventsFeatureName]??!1),this._viewLoadingOffset=this._disableOffsetForDelayingModelEventsFeatureState?0:this._defaultViewLoadingOffset}_shouldLoadForModals(e,t){return e&&e.modalRefs?Array.from(e.modalRefs.values()).some(a=>a?.componentInstance?.page?.schemaState?.viewModel===t):!1}_shouldLoadForPage(e,t){return e?.viewModel===t}_getViews(){const e=[];for(let t=this._viewLoadingOffset;t<=0;t++)e.push(this._routerOutletHistory.getViewByOffset(t));return e}_shouldLoadForViews(){const e=(0,v.getRootViewModel)(this._viewModel);return this._getViews().some(a=>{const f=this._shouldLoadForPage(a,e),F=this._shouldLoadForModals(a,e);return f||F})}_shouldLoad(){return this?._routerOutletHistory?this._shouldLoadForViews():!1}_subscribeOnNavigation(){this._subscriptions.add(this._crtRouter?.navigateEnd$.subscribe(()=>{this._shouldLoad()&&this._loadTriggerSubject.next()}))}shouldBeDelayed(){return!this._isAngularHost||this._disableDelayingModelsEventFeatureState?!1:this._viewModel.State===v.ViewModelStates.Paused&&!this._shouldLoad()}setState(e,t){this._disableDelayingModelsEventFeatureState||e._setStateAttribute(t)}destroy(){this._subscriptions.unsubscribe(),this._loadTriggerSubject.complete(),this._viewModel=null}ngOnDestroy(){this.destroy()}static#e=this.\u0275fac=function(t){return new(t||_)(n.\u0275\u0275inject(U.CrtRouter,8),n.\u0275\u0275inject(l.B,8),n.\u0275\u0275inject(S.FEATURE_VALUES),n.\u0275\u0275inject(b.WINDOW_TOKEN))};static#t=this.\u0275prov=n.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac})}class M extends p.BaseCachedHttpService{constructor(){super(...arguments),this.serviceEndpoint="/ServiceModel/ClientUnitSchemaDesignerService.svc"}getParentSchemasLocalizableStrings(e){return this.executePostRequestWithCache("GetParentSchemasLocalizableStrings",{schemaUId:e})}static#e=this.\u0275fac=function(){let e;return function(a){return(e||(e=n.\u0275\u0275getInheritedFactory(M)))(a||M)}}();static#t=this.\u0275prov=n.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac})}var N=i(96923);class D extends N.DataSourceStructureExplorerService{constructor(e,t,a,f){super(),this._dataSourceRepository=e,this._dataSchemaRepository=t,this._entityBackwardReferenceService=a,this._featureValues=f}getDataSchemaAttributeByPath(e){return(0,m.throwError)(new Error("Method not implemented"))}getDataSchemaByName(e){return this._dataSchemaRepository.get(e)}getDataSourceByName(e){return(0,m.of)(this._dataSourceRepository.get(e))}getDataSources(){return(0,m.of)(this._dataSourceRepository.getAll())}getDataSchemaBackReference(e){return this._featureValues.UseBackwardReferencesInStructureExplorer?this._entityBackwardReferenceService.getBackwardReferences(e):(0,m.of)([])}static#e=this.\u0275fac=function(t){return new(t||D)(n.\u0275\u0275inject(h),n.\u0275\u0275inject(v.DataSchemaRepositoryService),n.\u0275\u0275inject(N.EntityBackwardReferenceService),n.\u0275\u0275inject(S.FEATURE_VALUES))};static#t=this.\u0275prov=n.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac})}},39630:(B,w,i)=>{i.d(w,{a:()=>y});var g=i(41307),n=i.n(g),P=i(52045),L=i.n(P),S=i(32935),E=i(94450),m=i.n(E);class y extends P.ProfileSchemaProvider{constructor(u,p){super(u),this._data=p}getProfileKey(u){return super.getProfileKey(u)+"__"+this._data.entitySchemaName}static#e=this.\u0275fac=function(p){return new(p||y)(E.\u0275\u0275inject(g.UserSchemaProfileService),E.\u0275\u0275inject(S.HO))};static#t=this.\u0275prov=E.\u0275\u0275defineInjectable({token:y,factory:y.\u0275fac})}},76596:(B,w,i)=>{i.d(w,{F:()=>C,L:()=>s});var g=i(8239),n=i(94450),P=i.n(n),L=i(34038),S=i.n(L),E=i(49475),m=i.n(E),y=i(24709),j=i.n(y),u=i(21322),p=i.n(u),I=i(27049),R=i.n(I);const C=new n.InjectionToken("SCHEMA_MODAL_COMPONENT_TYPE");class s{constructor(r,c,d,h){this._modalProviderService=r,this._appearanceSettingsService=c,this._schemaModalComponentType=d,this._measurePerformancePageLoadService=h,this._createdModalsMap=new Map,this._modalCreated=new u.Subject,this._modalClosed=new u.Subject,this.modalCreated$=this._modalCreated.asObservable(),this.modalClosed$=this._modalClosed.asObservable()}_getDialogConfig(r){var c=this;return(0,g.Z)(function*(){const d=yield c._appearanceSettingsService.getSchemaModalClasses(r);return{panelClass:["modal-container",...d],maxWidth:0,maxHeight:"90vh",closeOnNavigation:!1}})()}_onModalClose(r){const h=this._createdModalsMap.get(r).componentInstance.schemaOutletComponent.instance.componentRef.instance.schemaState?.viewModel;this._createdModalsMap.delete(r),this._modalClosed.next(r),(0,u.concat)(h?.pause()??(0,u.of)(null),h?.destroy()??(0,u.of)(null)).pipe((0,I.take)(2)).subscribe()}_onModalCreate(r){this._createdModalsMap.set(r.id,r),this._modalCreated.next(r),r.beforeClosed().pipe((0,I.take)(1)).subscribe(()=>this._onModalClose(r.id))}hideModals(r){const c=this._createdModalsMap;for(const d of r){const h=c.get(d);h&&(this._modalProviderService.hideModal(h),h.componentInstance.schemaOutletComponent.instance.componentRef.instance.onDetach(),h.componentInstance.detachContent())}}closeModals(){const r=this._createdModalsMap;for(const c of Array.from(r.keys())){const d=r.get(c);d&&d.close()}}restoreModals(r){const c=this._createdModalsMap;for(const d of r){const h=c.get(d);if(h){this._modalProviderService.restoreModal(h);const v=h.componentInstance.schemaOutletComponent.instance;h.componentInstance.attachContent(),v.componentRef.instance.onAttach()}}}show(r,c){var d=this;return(0,g.Z)(function*(){d._measurePerformancePageLoadService.startPageLoadMeasure(performance.now());const h=yield d._getDialogConfig(r.schemaName);h.injector=c?.injector;const v=d._modalProviderService.open(d._schemaModalComponentType,{data:r,...h});return v.keydownEvents().pipe((0,I.filter)(()=>v.componentInstance.visible),(0,I.switchMap)(A=>{const T=v.componentInstance.page.schemaState.viewModel,U=new y.HandleKeyboardHotkeysRequest(A,T);return T.executeRequest(U)})).subscribe(),v.disableClose=!0,d._onModalCreate(v),v})()}static#e=this.\u0275fac=function(c){return new(c||s)(n.\u0275\u0275inject(L.ModalProvider),n.\u0275\u0275inject(E.AppearanceSettingsService),n.\u0275\u0275inject(C),n.\u0275\u0275inject(E.MeasurePerformancePageLoadService))};static#t=this.\u0275prov=n.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}}}]);
